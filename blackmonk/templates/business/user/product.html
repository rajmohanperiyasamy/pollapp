{% extends "user_base.html" %}
{% load ds_utils %}
{% load tabs %}
{% load i18n %}
{% load thumbnail %}
{% block pagetitle %}{% if category %}{% seo_format_tag module='Business' title=category.seo_title code='LT' category=category.name as seo_meta_title %}{% else %}{% seo_format_tag module='Business' title=seo.seo_title code='MT' as seo_meta_title %}{% endif %}{{seo_meta_title}}{% endblock %}
{% block meta %}
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="description" content="{{seo.seo_description}}" />
{% endblock %}

{% block head %}
	<link type="text/css" rel="stylesheet" href="{{STATIC_URL}}css/bm.jfp.ui.css">
	<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
	<script type="text/javascript" src="{{ STATIC_URL }}js/common_user.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}js/ckeditor4/ckeditor.js"></script>
{% endblock %}

{% block navigation %}
	{% activetab "leftnav" "business" %}
	{{ block.super }}
{% endblock %}

{% block content %}
    	<div class="span10 sP9mX979 sP12mX767">
            <div class="row-fluid">
				<div class="main span9">
					<section class="sCn pD0">
						<div class="cLrFx pD20">
							<div class="pLlT">
								<h3 class="mR0 tRnCt">{{business.name}}</h3>
                                <!--span class="fS11 cLr-gRy">{% for buzaddr in business.getaddress %}{{ buzaddr.address1 }}, {{buzaddr.zip}}{% endfor %}</span-->
							</div>
							<div class="pLrT w100pSmP mRt10SmP"><a href="{% url 'user_manage_business' %}" class="btn btn-small btn-light"><i aria-hidden="true" class="bUi-iCn-aRw-l-16"></i></a></div>
						</div>
                        <div class="row-fluid">
                        	<ul class="nav nav-tabs tB-cStM pLlT pD020 mR0 oVrfLw-vSbL">
                                <li><a href="{% url 'user_update_business' business.id %}">Edit Business</a></li>
                            	<li><a href="{% url 'user_business_images' business.id %}">Images</a></li>
                            	<li class="active"><a href="{% url 'user_business_product' business.id %}">Product</a></li>
								<li><a href="{% url 'user_business_coupon' business.id %}">Coupons</a></li>
                            </ul>	
                        </div>
						<hr class="mRb12 mRt0">
                        <div class="tLbR mRb12 pD015">
                            <span class="help-block">Use this section to promote your products. Post your product name, description, pricing and images.</span>
                            <div class="tLbR-iR">
                                <div class="pLrT">
                                    <a href="{% url 'user_business_product_add' business.id %}" data-id="0" class="btn btn-small btn-danger fW-bLd" data-target="#addProduct"><span id="edit_icon_0">Add new product</span><span id="small_loading_icon_0" style="display: none;">Loading&nbsp;&nbsp;<i alt="Loading icon" class="icon-spinner bUi-iCn-sPnR mRr5 fS16" aria-hidden="true"></i></span></a>
                                </div>
                            </div>
                        </div>
                        <ul class="modulesBrowseData dSrS480 mDa-lT mDa-oT-lT oVrfLw-vSbL">
                            <li class="table-list-row" style="text-align:center;padding:10px;display:none;" id="ajax_content_loading_list">
								<img src="{{STATIC_URL}}ui/images/global/loading-s.gif">
							</li>
						{% if products %}
						  {% for product in products %}
                            <li class="mDa mDa-sTtS-iN" id="li_{{product.id}}">
                                <div class="mDa-iN pDr15">
                                    <div class="mDa-wPr">
                                        <span class="bUi-tMb-wPr tMb-75 dSpD  fLxiMgW bUi-tMb-110">
                                            <span class="bUi-tMb w100pXmP">
                                                <span class="bUi-tMb-pRpL">
                                                    <span class="bUi-tMb-cLp">
                                                        <span class="bUi-tMb-cLp-iN">
                                                            <img class="mDa-oT" src="{% if product.photo %}{% thumbnail product.photo 110x0 %}{% else %}{{STATIC_URL}}themes/green/images/global/nophoto_90.jpg{% endif %}" alt="{{product.title}}">
                                                            <span class="vRtL-aLn">
                                                            </span>
                                                        </span>
                                                    </span>
                                                </span>
                                            </span>
                                        </span>
                                    </div>
                                    <div class="mDa-bDy mRr0mP mRr0">
                                        <h5 class="mDa-hD tRnCt0 mR50 rLvE h65 h65" title="{{product.title}}">
											{{product.title}}
                                            <strong class="pLrT">{% if product.price %}&nbsp;{{globalsettings.currency}}{{product.price}}{% endif %}</strong>
                                        </h5>
                                        <p class="fS12 cLr-gRy">
                                            <span class="fS11 cLr-lTgRy sPrTr">Created On: {{product.created_on}}</span>
                                        </p>
                                        <div class="clearfix">
                                            <div class="btn-group pLlT iM">
                                                <a href="{% url 'user_business_product_update' business.id product.id %}" data-id="{{product.id}}" title="Edit" data-target="#addProduct" class="btn btn-light btn-small"><span id="edit_icon_{{product.id}}"><i aria-hidden="true" class="bUi-iCn-rVeW-12 ib"></i></span><span id="small_loading_icon_{{product.id}}" style="display: none;"><i alt="Loading icon" class="icon-spinner bUi-iCn-sPnR mRr5 fS16" aria-hidden="true"></i></span></a>
                                                <button class="btn btn-light btn-small dropdown-toggle" data-toggle="dropdown">
                                                <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu mNi pLrT dSpL">
                                                    <li>
                                                        <a href="{% url 'user_business_product_update' business.id product.id %}" data-id="{{product.id}}" data-target="#addProduct">Edit</a>
                                                    </li>
                                                    <li>
                                                        <a href="javascript:delete_product({{product.id}})">Delete</a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            {% endfor %}
						{% endif %}
                        </ul>
						<div class="no-data" style="{% if products %}display:none;{% endif %}">
	                       <!-- No data -->
	                        <div class="hT400 rLvE">
	                             <div class="tBl-bLk pDt0">
	                                <div class="tBl-cEl">
	                                    <span class="iCn-bRdR80 oP25"><i aria-hidden="true" class="bUi-iCn-oFr-24 fS42-1 cLr-lTgRy ib"></i></span>
	                                    <p class="bLk mRt20 fS16 cLr-lTgRy oP75">You haven't added any Product yet.</p>
	                                </div>
	                            </div>
	                        </div>
	                        <!-- /No data -->
                        </div>
					</section>
				</div> <!-- /.main -->
				<aside class="sD-bR span3">
					<div>
						<section class="tXt-cTr pD0 bNr-aD"> 
                           
                        </section>
					</div>
				</aside>
			</div>  <!-- /.row-fluid -->
		</div>  <!-- /.span10 -->
		<div id="addProduct" class="modal hide fade mW40" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 id="myModalLabel" class="mR50">Product Form</h4>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary fS12 fW-bLd submit_button" type="button" onclick="save_product()">Save</button>
                <button class="btn btn-primary fS12 fW-bLd hide submit_button" type="button" style="position: relative; pointer-events: none;"><i style="top: 7px; position: absolute;" alt="Loading icon" class="icon-spinner bUi-iCn-sPnR mRr5 fS16" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Please Wait . . .</button>
            </div>
        </div>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.jfp.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.fup.appln.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}ui/js/listing_settings.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/business/staff.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
		$("a[data-target=#addProduct]").click(function(ev) {
           var pid = $(this).attr("data-id");
            clicked_btn = $(this);
            clicked_btn.css('pointer-events','none');
            $('#edit_icon_'+pid).hide();
            $('#small_loading_icon_'+pid).show();
           ev.preventDefault();
		   target = $(this).attr("href");
		
		   // load the url and show modal on success
		   $("#addProduct .modal-body").load(target, function() {
                $('#edit_icon_'+pid).show();
                $('#small_loading_icon_'+pid).hide();
                $('#save_button_save').show(); 
                $('#save_button_loading').hide();
		        $("#addProduct").modal("show");
                clicked_btn.css('pointer-events','auto');
		   });
		});
	});
	function save_product(){
    	var flag = $('#mform').validate().form()
    	if(flag==true){
            $('.submit_button').toggleClass('hide');
            var dataString='&title=' +encodeURIComponent($('#id_title').val());
    		dataString+='&description=' +encodeURIComponent(CKEDITOR.instances.id_description.getData());
    		dataString+='&price=' +encodeURIComponent($('#id_price').val());
    		$('#ajax_content_product').hide();
    		$('#ajax_content_loading_product').show();
    		$.ajax({
    		type: "POST",
    		url: $("#mform").attr("action"),
    		data: dataString,
    		dataType:'JSON',
    		success: function(responseData){
    				try{$('.no-data').hide();$('#add_head').show();}
    				catch(e){}
    				//$('#ajax_content_loading_product').html(responseData.msg);
    				if(responseData.status){
    					$("#product_id").val(responseData.id);
    					if(imageIsThere){$(".start").trigger('click');}
    					$('#addProduct').modal('hide')
						try{$('#li_'+responseData.id).remove();}
						catch(e){}
                        $('#ajax_content_loading_list').show();
                        if(imageIsThere){
        					setTimeout(function(){
                                location.reload(); 
        					},3000);
                        }else{
                                location.reload(); 
                        }
    				}else{
    					$('div#ajax_content_product_outer').replaceWith(responseData.html);
    					$('#addProduct').modal('show');
                        $('.submit_button').toggleClass('hide');
    				}
    			}
    		});
    	}
    }
function delete_product(id){
	if(confirm('Are you sure want to delete this product ?')){
		$.ajax({
			type: "POST",
			url:'{% url 'user_business_product_delete' %}',
			data:'id='+id,
			dataType:'JSON',
			success: function(responseData){
				//show_msg(responseData.msg,responseData.mtype);
				if(responseData.status==1){
					$('#li_'+id).remove();
					if($('#product_list').find('li').length==1){
						$('.no-data').show();
						$('#add_head').hide();
					}
				}
			}
		});
	}
}
	</script>
{% endblock %}