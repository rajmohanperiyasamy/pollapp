{% load i18n %}
<div id="ajax_content_coupon_outer">
<div id="ajax_content_loading_coupon" style="display:none;padding-top:222px;padding-bottom:222px;text-align:center;">
	<img src="{{STATIC_URL}}ui/images/global/loading-s.gif"><br><p>{% trans 'Saving Coupon...' %}</p>
</div>
<div id="ajax_content_coupon" class="modal-form">
	{% if msg %}<div class="message">{{msg}}</div>{% endif %}
	{% if form.errors %}
		<div class="messageerror" >
			<strong>{% trans 'There is a problem with your submission' %}</strong>
            <ul style="list-style:square;margin-left:20px;">
           		{% for field in form %}
           			{% if  field.errors%}<li>{%for error in field.errors%}{{error}}{%endfor%}</li>{% endif %}
          	 	{% endfor %}
			</ul>
	 	</div>
	{% endif %}
     <form id="mform" action="{% if coupon %}{% url 'staff_business_coupon_update' business.id coupon.id %}{% else %}{% url 'staff_business_coupon_add' business.id %}{% endif %}">
    	<div class="fields vform two-col group">
            <div class="field-group" style="width:320px">
            	<div class="field text-field">	
                    <div class="label"><label></label></div>	
                    <div class="value">{{form.type}}</div>
                </div>
                <div class="field text-field">	
                    <div class="label"><label>{% trans 'Title' %}<span class="required-field">*</span></label></div>	
                    <div class="value">{{form.title}}</div>
                </div>
                <div class="field text-field">	
                    <div class="label"><label>{% trans 'Description' %}</label></div>	
                    <div class="value">{{form.description}}</div>
                </div>  
                <div class="field text-field">	
                    <div class="label"><label>{% trans 'Coupon Start/End Date' %}<span class="required-field">*</span></label></div>	
                    <div class="value">
                    	<div class="fd-cols mrb0 group">
                            <span>
                                <span class="has-fd-icon inline-block pdr6">
                                	{{form.start_date}}<img alt="" src="{{ STATIC_URL }}ui/images/icons/b/70.png" style="position: absolute; top: 7px; opacity: 0.5; right: 12px;" class="fd-icon">
                                </span>
                            </span>
                            <span style="display:inline-block; vertical-align:middle;">to</span>
                            <span>
                                <span class="has-fd-icon inline-block">
                                	{{form.end_date}}<img alt="" src="{{ STATIC_URL }}ui/images/icons/b/70.png" style="position: absolute; top: 7px; opacity: 0.5; right: 12px;" class="fd-icon">
                                </span>
                            </span>
                        </div>
                    </div>
                </div>  
            </div> 
            <div class="field-group" style="width:300px">
            	<input type="hidden" name="pr_id" id="coupon_id" value="{% if coupon %}{{coupon.id}}{% endif %}"/>
                <div class="attachment group">
                	<div id="fileupload" >
				 		<div class="fileupload-content">
				    		<ul class="files bm-uploader-list"></ul>
						</div>
						<div class="clear"></div>
		            	{% csrf_token %}
		            	<div class="upload-button-wrapper" id="upload-button-wrapper" style="{% if coupon.photo %}display:none;{% endif %}">
		                	<a class="upload-button" id="upload-button">{% trans 'Attach Photo' %}</a>
							<div class="clear"></div>
		                    <div class="fileinput-button">
		                    	<input type="file" size="1" name="photo" id="id_photo" multiple=""  accept="image/*" tabindex="-1">
							</div>
		                </div>
					</div>
                </div>           
            </div>
		</div>    
        <div class="modal-base form-submit group">
          <button role="button" class="cform-button prime right" onclick="save_coupon()" onmousedown="save_coupon()"  type="button"><span class="cform-button-text">{% if coupon %}{% trans 'update' %}{% else %}{% trans 'SAVE' %}{% endif %}</span></button>
        </div>           
    </form>
</div>
<script type="text/javascript" src="{{ STATIC_URL }}ui/js/inline.js"></script>
<script type="text/javascript">
var imageIsThere=false;
$(document).ready(function(){
	if($("#id_end_date").length){
		$("#id_end_date").datepicker({
            dateFormat: "yy-mm-dd",
            minDate: new Date(),
            onSelect: function() { $(this).valid(); }
        });
	}
	if($("#id_start_date").length){
		$("#id_start_date").datepicker({
            dateFormat: "yy-mm-dd",
            minDate: new Date(),
            onSelect: function(){
                $(this).valid();
                enddate = $(this).val();
                splittedval = enddate.split('-');
                var date = new Date(splittedval[0], splittedval[1]-1, splittedval[2]);
                date.setDate(date.getDate() + 1);
                $("#id_end_date").datepicker( "option", "minDate", date );
            }
        });
	}
    file_upload_buz_product('{% url 'business_ajax_upload_coupon_photo' %}{% if coupon %}?pr_id={{coupon.id}}{% endif %}',1,'template-upload-p','template-download-p');
	$('#fileupload').bind('fileuploadadd', function (e, data) {imageIsThere=true;$('#upload-button-wrapper').hide(); 
		setTimeout(function(){
			$.browser.chrome = /chrome/.test(navigator.userAgent.toLowerCase()); 
			if (!$.browser.chrome && !$.browser.mozilla) {
		    	$('li.bm-uploader-file .img_name').show();
	  		}
		},500);
	});
	$('#fileupload').bind('fileuploadfail', function (e, data) {setTimeout(function(){imageIsThere=false;$('#upload-button-wrapper').show();},500);});
	$('#fileupload').bind('fileuploaddestroy', function (e, data) {setTimeout(function(){$('#upload-button-wrapper').show();},500);});

	$("#mform").validate({
		highlight: function(element, errorClass){$(element).parent().parent().addClass('field-error');$(element).addClass('error');},
		unhighlight: function(element, errorClass){$(element).parent().parent().removeClass('field-error');$(element).removeClass('error');},
		errorPlacement: function(error, element){},
		rules:{
	    	title: "required",
			start_date:"required dateISO",
			end_date:"required dateISO"
	   	}
	});
	try{
		var instance = CKEDITOR.instances['id_description'];
		CKEDITOR.remove(instance);
	}
	catch(e){}
	/*
	CKEDITOR.on( 'instanceCreated', function( e ){
		   e.editor.addCss('body { font-size:12px; font-family:Arial, "Times New Roman", Verdana;}');
   	});
	*/
    setTimeout(function(){
    	CKEDITOR.replace( 'id_description',{					
    		customConfig : '{{ STATIC_URL }}js/ckeditor/custome_config.js',
    		toolbar : 'Basic'
    	});
    },500);
});
</script>
</div>

