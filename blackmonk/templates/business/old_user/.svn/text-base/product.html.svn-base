{% extends "user_base.html" %}
{% load tabs %}
{% load i18n %}
{% load upload_tags %}
{% load thumbnail %}
{% block navigation %}
	{% activetab "selmodule" "business" %}
	{{ block.super }}
{% endblock %}
{% block pagetitle %}{% trans 'Product - Business' %} {% endblock %}
{% block head %}
<link type="text/css" rel="stylesheet" href="{{STATIC_URL}}css/bm.jfp.ui.css">
{% endblock %}
{% block content %}
<div id="userHub-platform" class="group">
  	<div class="header-bar has-preview-head">
        <h2 onclick="window.location.replace('{% url 'user_manage_business' %}')" style="cursor:pointer;">{% trans 'Business' %}</h2>
        <section class="sub-header-bar">
            <div class="preview-head">
            	{% if business.featured_sponsored == 'F' %}
        			<span class="list-type featured-item"><a class="tttxt" original-title="{% trans 'Item listed as featured' %}" href="javascript:void(0);">{% trans 'Featured' %}</a></span>
				{% else %}
					{% if business.featured_sponsored == 'S' %}
	        			<span class="list-type sponsored-item"><a class="tttxt" original-title="{% trans 'Item listed as sponsored' %}" href="javascript:void(0);">{% trans 'sponsored' %}</a></span>
			 		{% endif %}
				{% endif %}
                <div class="item-title">
                    <h1>{{ business }}</h1>
                    <p class="ltxt80">By <a href="#">{{business.created_by.display_name}}</a> <span class="divider12">|</span> {{business.created_on|date:"M d, Y"}}</p>
				</div>                                   
                <ul class="status-tabs group">
                	 <li> <a href="javascript:void(0)">{{business.most_viewed}}<span class="meta">{% trans 'views' %}</span></a> </li>
                    <!--li> <a href="#">4<span class="meta">{% trans 'comments' %}</span></a> </li-->
                </ul>                                
            </div>                                
        </section>                          
    </div>
    <div id="core-wraper" class="group">
        <div class="userHub-main">
            <div class="page-wrap">
                <div id="products" class="preview-center group">
                	<div class="preview-group">
						<div class="preview-items-head" id="add_head" style="{% if not products %}display:none;{% endif %}">
                            <div class="right-item"><div class="cform-button prime bm-add-product" href="{% url 'user_business_product_add' business.id %}" title="{% trans 'Add New Product' %}"><span>{% trans 'Add new product' %}</span></div></div>
                            <h3>{% trans 'Products' %}</h3>
                        </div>
						<ol class="data-table-inset" id="product_list">
							<li class="table-list-row" style="text-align:center;padding:10px;display:none;" id="ajax_content_loading_list">
								<img src="{{STATIC_URL}}ui/images/global/loading-s.gif">
							</li>
							{% if products %}
							{% for product in products %}
                        	<li class="table-list-row manage-items has-thumb90" id="li_{{product.id}}">
                                <div class="table-list-row-inner group">
                                    <div class="item-media">
                                        <span class="item-thumb thumb-90">
                                            <span class="thumb-in">
												<span class="thumb"><img src="{% if product.photo %}{% thumbnail product.photo 110x0 %}{% else %}{{STATIC_URL}}themes/green/images/global/nophoto_90.jpg{% endif %}" alt="{{product.title}}" class="inline-block"><span class="inline-block h100"></span></span>
                                            </span>
                                        </span>
                                    </div>   
									<div class="item-detail">
                                    	<h4>{{product.title}}{% if product.price %}<em class="price">&nbsp;{{globalsettings.currency}}{{product.price}}</em>{% endif %}</h4>
										<p>{% if product.description %}{% autoescape off %}{{product.description}}{% endautoescape %}{% endif %}</p>
                                    </div>
                                   	<div class="action-buttons">
                                        <div>
                                            <a href="{% url 'user_business_product_update' business.id product.id %}" class="tttxt-w bm-add-product" original-title="{% trans 'Edit Product' %} {{product}}"><span class="action-icon icon-edit"></span></a>
                                            <a href="javascript:delete_product({{product.id}})" class="tttxt-w" original-title="Delete"><span class="action-icon icon-delete"></span></a>
										</div>                                                            
                                  	</div>
                                </div>
							</li>
							{% endfor %}
							{% endif %}
                        </ol> <!-- end table --> 
                        <div class="no-data" style="{% if products %}display:none;{% endif %}">
                        	<p>{% trans 'No Products found for this business.Add Now!' %}.</p>
                            <div class="button-insde">
                            	<span class="btn-txt-inline-prime bm-add-product" href="{% url 'user_business_product_add' business.id %}" title="{% trans 'Add new product' %}"><span class="btn-txt">{% trans 'Add new product' %}</span></span>
                            </div>
                        </div>
					</div>
                </div><!-- end table -->
            </div> <!-- end page wrap -->
        </div> <!-- end main-col -->                            
        <div id="aside" class="side-bar">
        	<div class="preview-aside-meta group">
                <ul class="side-navigation">
                    <li><a href="{% url 'user_preview_business' business.id %}">Business Details</a></li>
					<li><a href="{% url 'user_business_images' business.id %}">Images</a></li>
                    <li class="active"><a href="{% url 'user_business_product' business.id %}">Product</a></li>
                    <li><a href="{% url 'user_business_coupon' business.id %}">Coupons</a></li>
                </ul>
				<div class="preview-item-stats">
					<a href="{% url 'user_preview_business' business.id %}" class="btn-txt-blue" style="display:block; text-align:center"><span class="btn-txt">Preview this Business</span></a>
                </div>                              
			</div>    
             {#% include 'business/user/faq.html' %#}    
        </div>                            
    </div>                                                    
</div>
{% endblock %}
{% block footer_include %}
{% upload_js %}
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.jfp.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.fup.appln.js"></script>
<script src="{{ STATIC_URL }}js/ckeditor/ckeditor.js" type="text/javascript"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}ui/js/listing_settings.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/business/staff.js"></script>
<script type="text/javascript">
function save_product(){
	var flag = $('#mform').validate().form()
	if(flag==true){
		var dataString='&title=' +encodeURIComponent($('#id_title').val());
		dataString+='&description=' +encodeURIComponent(CKEDITOR.instances.id_description.getData());
		dataString+='&price=' +encodeURIComponent($('#id_price').val());
		$('#ajax_content_product').hide();
		$('#ajax_content_loading_product').show();
		$.ajax({
		type: "POST",
		url: $("#mform").attr("action"),
		data: dataString,
		dataType:'JSON',
		success: function(responseData){
				try{$('.no-data').hide();$('#add_head').show();}
				catch(e){}
				$('#ajax_content_loading_product').html(responseData.msg);
				if(responseData.status){
					$("#product_id").val(responseData.id);
					if(imageIsThere){$(".start").trigger('click');}
					$('#ajax_content_loading_list').show();
					try{$('#li_'+responseData.id).remove();}
					catch(e){}
					setTimeout(function(){
						load_append_html(responseData.id)
					},2000);
					show_msg(responseData.msg,responseData.mtype);
					$.colorbox.close();
				}else{
					$('div#ajax_content_product_outer').replaceWith(responseData.html);
					$.colorbox.resize();
				}
			}
		});
	}
}
function load_append_html(id){
	$.ajax({
		type: "POST",
		url:'{% url 'user_business_product_load_html' %}',
		data:'id='+id,
		dataType:'JSON',
		success: function(responseData){
			try{$('#li_'+id).remove();}
			catch(e){}
			$('#ajax_content_loading_list').hide();
			$(responseData.html).insertAfter("#ajax_content_loading_list")
			$(".bm-add-product").colorbox({width:"700",height:"560",initialWidth: "700", top:"5%", initialHeight: "200",title:function(){return getLBTitle($(this));}});
		}
	});
}
function delete_product(id){
	if(confirm(gettext('Are you sure want to delete this product ?'))){
		$.ajax({
			type: "POST",
			url:'{% url 'user_business_product_delete' %}',
			data:'id='+id,
			dataType:'JSON',
			success: function(responseData){
				show_msg(responseData.msg,responseData.mtype);
				if(responseData.status==1){
					$('#li_'+id).remove();
					if($('#product_list').find('li').length==1){
						$('.no-data').show();
						$('#add_head').hide();
					}
				}
			}
		});
	}
}
</script>
{% endblock %}