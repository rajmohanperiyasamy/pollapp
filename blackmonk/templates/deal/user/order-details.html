{% extends "user_base.html" %}
{% load tabs %}
{% load i18n %}
{% load currency %}
{% load thumbnail truncate_filter bm_dealtags %}
{% block pagetitle %}{% trans 'Deals' %} {% endblock %}
{% block head %}
	<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}themes/green/css/LE_MetaId99.css">
	<script type="text/javascript" src="{{ STATIC_URL }}themes/js/bootstrap-model.js"></script>
	
{% endblock %}
{% block navigation %}
	{% activetab "leftnav" "deals" %}
	{{ block.super }}
{% endblock %}
{% block content %}
<div class="span10 sP9mX979 sP12mX767">
		                <div class="row-fluid">
							<div class="main span9">
								<section class="sCn pD0">
									<div class="cLrFx pD2015">
										<div class="pLlT w100mP">
											<h3 class="mR0 tRnCt">{% if active == 'purchased' %}Deals I Purchased{% else %}Vouchers List{% endif %} <span class="lBl dRk lRg lRg-bRdR fS12 ib fW-bLd">{{ total }}</span></h3>
										</div>
										{% if active == 'vouchers' %}
                                        <div class="clearfix pLlTmP mRt10mX480">
                                        	<!-- 
                                        	<div class="pLrT w100pSmP mRt10SmP mRl10" style="display:None;">
                                                <a class="btn fS12 btn-danger fW-bLd" data-target="#addArticle" data-toggle="modal" href="article-add-lightbox.html"><i class="bUi-iCn-pLs-12" aria-hidden="true"></i></a>
                                            </div>
                                            <div class="pLrT">
                                                <form action="#" class="form-search mRb0">
                                                    <div class="input-append iNsD">
                                                        <input type="text" maxlength="100" placeholder="Search Voucher" id="movies-search-field" name="" class="search-query fS13 pD510 h34">
                                                        <button role="button" class="btn btn-link pD510 cLr-gRy" type="submit"><i class="bUi-iCn-sRh-16 fS14 ib" aria-hidden="true"></i></button>
                                                    </div>
                                                </form>
                                            </div>
                                        	 -->
                                        </div>
                                        {% endif %}
									</div>
									<div class="pD150">
										<hr class="mRb12 mRt0">	
			                            {% if deal_payment %}
										<ol class="modulesBrowseData dSrS480 mDa-lT mDa-oT-lT oVrfLw-vSbL">
										{% for rel in deal_payment %}
										 <li class="mDa mDa-sTtS-iN">
			                                    <div class="mDa-iN">
			                                    	<!--span class="pLlT iM mRr15 mRt20 mRl15"><input type="checkbox" class="" name="item-select-all" id="item-select-all"></span -->
			                                        <div class="mDa-wPr"> 
			                                        	<a href="{{rel.get_absolute_url}}" class="bUi-tMb-wPr tMb-75 dSpD  fLxiMgW bUi-tMb-110">
			                                                <span class="bUi-tMb w100pXmP">
			                                                    <span class="bUi-tMb-pRpL">
			                                                        <span class="bUi-tMb-cLp">
																	{% if rel.deal.album.album_photos.all.0.photo %}
			                                                            <span class="bUi-tMb-cLp-iN"> <img src="{% thumbnail rel.deal.album.album_photos.all.0.photo 260x0 %}" title="{{rel.deal.title}}" alt="{{rel.deal.title}}" class="mDa-oT" style="width: 111px;">
			                                                                <span class="vRtL-aLn"> </span>
			                                                            </span>
																	{% else %}
					                                                    <span class="iCn-bRdR50 oP25" title="{{rel.deal.title}}"><i aria-hidden="true" class="bUi-iCn-dEaL-24 cLr-gRy ib"></i></span><div class="vRtL-aLn"></div>
					                                                {% endif %}
			                                                        </span>
			                                                    </span>
			                                                </span>
			                                            </a>
			                                        </div>
			                                        <div class="mDa-bDy mRr0mP">
			                                            <h5 title="{{ rel.deal.title }}" class="mDa-hD tRnCt0 mR50 rLvE h65 h65"><a href="{% url 'deal_order_details' rel.id %}" data-target="#myModal">{{ rel.deal.title }}</a></h5>
			                                            <p class="fS12 cLr-lTgRy" style='display: inline;'>
														<span class="fS11 ">{% trans 'Bought On' %} :{% if rel.created_on %} {{ rel.created_on}}{% else %} N/A {% endif %}</span>
														<br>
			                                            <span class="fS11 ">{% trans 'Total Price' %} : {% if rel.total_price %}{{globalsettings.currency}}{{rel.total_price|floatformat:2}}{% else %} N/A {% endif %}</span>
														| <span class="fS11 ">Voucher Code : {{rel.dealkey}}</span>
									                    <div style="cursor:pointer;" class="clearfix pLrT mRr10 iM">
														{% if rel.status == 'D' %}
									                        <i aria-hidden="true" id="statusicon{{rel.id}}" title="Redeemed" class="bUi-iCn-pPiE-24 cLr-pUb"></i>
														{% elif rel.status == 'S' %}
															<i aria-hidden="true" id="statusicon{{rel.id}}" title="Not Redeemed" class="bUi-iCn-pNdG-24 cLr-pEn"></i>
														{% else %}
															<i aria-hidden="true" id="statusicon{{rel.id}}" title="Payment Failed" class="bUi-iCn-rGt-24 cLr-rEj"></i>
														{% endif %}
									                    </div>	
														</p>
														<!--div class="mDa-lT-sTtS aBsLt tR0 StCmP tXt-rTp bGtRp cLr-dRk">
														{% if rel.status == 'D' %}
			                                               <span class="fS11  mRr10 bLk">{% trans 'Redeemed' %}</span>
														{% elif rel.status == 'S' %}
															<span class="fS11 mRr10 bLk">{% trans 'Not Redeemed' %}</span>
														{% else %}
															<span class="fS11 mRr10 bLk">{% trans 'Payment Failed' %}</span>
														{% endif %}
			                                            </div--> 
			                                        </div>
			                                    </div>
			                                </li>
										{% endfor %}
										</ol>
										{% else %}
											<div class="hT400 rLvE sCn">
						                        <div class="tBl-bLk pDt0">
						                            <div class="tBl-cEl">
						                                <span class="iCn-bRdR80 oP25"><i class="bUi-iCn-dEaL-24 fS42-1 cLr-gRy ib" aria-hidden="true"></i></span>
						                                <p class="bLk mRt20 fS16 cLr-lTgRy oP75">{% if active == 'purchased' %}You haven't puchased any deal.{% else %}No voucher found.{% endif %}</p>
						                            </div>
						                        </div>
						                    </div>
	     								{% endif %}	
									</div>
								</section>
							</div> <!-- /.main -->
							<aside class="sD-bR span3">
								<div>
									<section class="tXt-cTr pD0 bNr-aD"> 
			                           
			                        </section>
								</div>
							</aside>
						</div>  <!-- /.row-fluid -->
						<!--ol class="stats-summary" id="id_module_state_listing">
							<li class="published-state"><strong id="id_pub">{{ purchased }}</strong> {% trans 'in' %} <a href="javascript:void(0)">{% trans 'Redeemed' %}</a></li> 
							<li class="pending-state"><strong id="id_pend">{{ pending }}</strong> {% trans 'in' %} <a href="javascript:void(0)">{% trans 'Not Redeemed' %}</a></li>
							<li class="sum"><strong id="id_tot">{{ total }}</strong> {% trans 'total deals bought' %}</li>
						</ol-->
					</div>
					<!--Bootstrap Modal-->
	<div id="myModal" class="modal hide fade mW40" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 id="myModalLabel" class="mR50">Order Details</h4>
        </div>
        <div class="modal-body">
			<div style="text-align: center; width: 100%;">
				<img src="{{STATIC_URL}}ui/images/global/loading.gif" align="...">
			</div>
        </div>
    </div>
					<!--Bootstrap Modal Ended-->
<script type="text/javascript">
function config_edit_product(){
	$("a[data-target=#myModal]").click(function(ev) {
	   ev.preventDefault();
	   target = $(this).attr("href");
	
	   // load the url and show modal on success
	   $("#myModal .modal-body").load(target, function() {
	        $("#myModal").modal("show");
	   });
	});
}
function save_voucher(voucher, status){
	$.ajax({
		type: "POST",
		url: "{% url 'redeem_voucher' %}",
		data: 'voucher='+voucher+'&status='+status,
		dataType:'HTML',
		success: function(data){
			if(status == 'D'){
				$("#statusicon"+voucher).addClass('bUi-iCn-pPiE-24')
				$("#statusicon"+voucher).addClass('cLr-pUb')
				$("#statusicon"+voucher).removeClass('bUi-iCn-pNdG-24')
				$("#statusicon"+voucher).removeClass('cLr-pEn')
				$("#statusicon"+voucher).attr('title', 'Redeemed');
			}else{
				$("#statusicon"+voucher).removeClass('bUi-iCn-pPiE-24')
				$("#statusicon"+voucher).removeClass('cLr-pUb')
				$("#statusicon"+voucher).addClass('bUi-iCn-pNdG-24')
				$("#statusicon"+voucher).addClass('cLr-pEn')
				$("#statusicon"+voucher).attr('title', 'Not Redeemed');
			}
			$("#myModal").modal("hide");
		}
	});
}
$(document).ready(function(){
    config_edit_product();
});
</script>
{% endblock %}			
{% block footer_include%}

{% endblock %}	
