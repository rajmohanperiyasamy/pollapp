{% load i18n %}
<div id="add_business_overall">
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.common.js"></script>
<div id="ajax_content_loading" style="display:none;padding-top:222px;padding-bottom:350px;text-align:center;">
	<img src="{{STATIC_URL}}ui/images/global/loading-s.gif"><br><p>{% trans 'Saving Venue' %}</p>
</div>
<div id="add_business" class="modal-form">
<script type="text/javascript">
	$(document).ready(function(){
		$("#businessform").validate({
			ignore:'',
			highlight: function(element, errorClass){$(element).parent('div').parent('div').addClass('field-error');$(element).addClass('error')},
			unhighlight: function(element, errorClass){$(element).parent('div').parent('div').removeClass('field-error');$(element).removeClass('error')},
			errorPlacement: function(error, element){},
		   	rules:{
				venue: "required",
		    	address1:"required",
				email:{
					required:true,
					email:true
				},
				city:"required",
				zip:"required"
		   	}
		});
		$('.lb_select-menu').bind("change", function(){
			$("#businessform").validate().element($(this));
		});
		$('.select-menu').bind("change", function(){
			$("#businessform").validate().element($(this));
		});
	});
</script>
	{% if msg %}<div class="message">{{msg}}</div>{% endif %}
	{% if aform.errors %}
	<div class="messageerror" style="background:#FCF4F4;padding:10px;color:#FF9902; box-shadow:0 0 2px rgba(0, 0, 0, 0.1);border-bottom:1px solid #e1e1e1">
		<strong style="font-weight:bold;">{% trans 'There is a problem with your submission' %}</strong>
	    <ul style="list-style:square;margin-left:20px;">
			{% for field in aform %}
           		{% if  field.errors%}<li>{%for error in field.errors%}{{field.name|title}}: {{error}}{%endfor%}</li>{% endif %}
          	{% endfor %}
		</ul>
	</div>
	{% endif %}
     <form action="{% url 'staff_deal_add_address' %}{% if business_obj %}?id={{business_obj.id}}{% endif %}" name="businessform"  id="businessform" method="post" class="add_venue">{% csrf_token %}
    	<div class="fields hform">
            <div class="field-group">              
                <div class="fields-head">
                    <p class="ltxt80">{#% trans '' %#}</p> 
                </div> 
                <div class="group">
            		<div class="fields-left col400">
						<div class="field text-field">	
                            <div class="label"><label>{% trans 'Title' %}<span class="required-field">*</span></label></div>	
                            <div class="value">{{aform.venue}}</div>	
                        </div>                    
                        <div class="field text-field">	
                            <div class="label"><label>{% trans 'Address' %}<span class="required-field">*</span></label></div>	
                            <div class="value">{{aform.address1}}</div>	
                        </div>
                        <div class="field text-field">	
                            <div class="value">{{aform.address2}}</div>	
                        </div>
						<div class="field text-field">	
                            <div class="label"><label>{% trans 'City/Town' %}<span class="required-field">*</span></label></div>	
                            <div class="value">{{aform.city}}</div>	
                        </div>
                        <div class="field text-field">	
                            <div class="label"><label>{% trans 'Zip/Postalcode' %}<span class="required-field">*</span></label></div>	
                            <div class="value">{{aform.zip}}</div>	
                        </div>
                        <div class="field text-field">	
                            <div class="label"><label>{% trans 'Main Phone' %}</label></div>	
                            <div class="value">{{aform.telephone1}}</div>	
                        </div>
						<div class="field text-field">	
                            <div class="label"><label>{% trans 'Mobile Phone' %}</label></div>	
                            <div class="value">{{aform.mobile}}</div>	
                        </div>
                        <div class="field text-field">	
                            <div class="label"><label>{% trans 'Email ID' %}<span class="required-field">*</span></label></div>	
                            <div class="value">{{aform.email}}</div>	
                        </div>
						<div class="field text-field">	
						    <div class="label"><label for="">Fax</label></div>	
						    <div class="value">{{aform.fax}}</div>	
						</div>
						<div class="field text-field">	
						    <div class="label"><label for="">Website</label></div>	
						    <div class="value">{{aform.website}}</div>	
						</div>
						<input id="lat_lng" type="hidden" value="">
						<input id="zoom" type="hidden" value="">
					</div> <!--/--> 
                    <div class="map-right col300">
                        <div class="map-container">
                            <div class="map-head">
                                <h4>{% trans 'Change map marker location' %}</h4>
                                <p>{% trans 'Use the mouse to pick up your marker and drag it to your street address.' %} <!-- Use the tools in the upper left corner of the map to pan and zoom for a better view. --></p>
                            </div>                                        
                            <div style="width: 298px; height: 308px;position: relative; background-color: rgb(229, 227, 223);" id="map"></div>
                        </div>                                            
                    </div> <!--/-->
            	</div>            
            </div>                        
		</div>    
        <div class="modal-base form-submit group">
           <button role="button" class="cform-button prime right" onclick="save_business()" type="button"><span class="cform-button-text">{% trans 'Save' %}</span></button>
        </div>           
    </form>
    <script type="text/javascript" src="{{STATIC_URL}}ui/js/inline.js"></script>
</div>
<script type="text/javascript">
$(document).ready(function(){
	$( "#id_zip" ).autocomplete({
			source: '{% url 'staff_common_auto_suggest_zip' %}',
		   	select: function(event, ui) {
     			$("#id_zip").val(ui.item.id);
     	 	}
	});
	setTimeout(function() {
		{% if address %}
			load_for_add('map',{{ address.lat }}, {{ address.lon }}, {{ address.zoom }},"{{ address.venue }}","{{address.address1}}<br>{{ globalsettings.city }} - {{address.zip}}");
		{% elif lat and lon %}
			load_for_add('map',{{ lat }}, {{ lon }}, {{ zoom }},"{{ globalsettings.city }}","{{ globalsettings.city }}");
		{% else %}
			load_for_add('map',{{ globalsettings.google_map_lat }}, {{ globalsettings.google_map_lon }}, {{ globalsettings.google_map_zoom }},"{{ globalsettings.city }}","{{ globalsettings.city }}");
		{% endif %}
	}, 500);
	
});
</script> 
<script type="text/javascript">
function loadsubcategory(){
	var categories = document.getElementById('id_categorys').value;
	var select = document.getElementById('id_categories');
	while(select.hasChildNodes()){
			select.removeChild(select.firstChild);
		}
	{% for cat in category %}
		if (categories == {{ cat.id }}){
			{% for subcat in cat.getChildCategory %}
				var option = document.createElement("option");
	            option.setAttribute("value", "{{subcat.id}}");
	            option.innerHTML = "{{ subcat.name }}";
	            select.appendChild(option);
			{% endfor %}
			 $("#id_categories").trigger("liszt:updated");
		}
	{% endfor %}
}

function get_lat_lang(){
	var lat_lng = marker.getPosition();
	var zoom = map.getZoom();
	$('#lat_lng').val(lat_lng);
	$('#zoom').val(zoom);
}

$(document).ready(function(){
	$('#id_zip').live("keyup",function(){getPin(getaddress(),$('#id_zip').val());});
});

function getaddress(){return $('#id_address1').val()+" "+$('#id_address2').val()}

</script>
</div>     