{% load thumbnail %}
{% load i18n %}
{% load template_loop %}
{% load mptt_comments_tags %}
{% if business %}
<input type="hidden" value="{{view_type}}" name="view_type" id="id_hid_view_type">
<div class="pD20 pDt0 cLrfX">                                                                                     
 	<div class="row-fluid">
     	<div class="tLbR mRb10">
            <div class="tLbR-iR">
				<p class="ib mRb0 mRt4 cLr-lTgRy fS12">{{object_count}} businesses</p>  
                <div class="btn-toolbar pLrT hP">
                    <div id="media-toggle" class="btn-group" data-toggle="buttons-radio">	                                        
                        <button type="button" class="btn btn-link c-gD {% if view_type == 'grid' %}active{% endif %}" onclick="$('#id_hid_view_type').val('grid');"><i aria-hidden="true" class="bUi-iCn-tH-lR-aLt-16"></i></button>
                        <button type="button" class="btn btn-link c-lT mRl5 {% if view_type == 'list' %}active{% endif %}" onclick="$('#id_hid_view_type').val('list');"><i aria-hidden="true" class="bUi-iCn-rE-oDr-aLt-16"></i></button>
                    </div>
                </div>  
            </div>
        </div>
        <ul class="modulesBrowseData tHcL {% if view_type == 'grid' %}mDa-gD mDa-oT-tP pDfX{% else %}mDa-lT mDa-oT-lT{% endif %} ">
			{% for bus in business %}
			{% with bus.address.all.0 as bus_addr %}
        	<li class="mDa">
                <div class="mDa-iN">
                    <div class="mDa-wPr"> 
                    	<a class="bUi-tMb-wPr tMb-100 fLxiMgH bUi-tMb-bSnS" href="{{ bus.get_absolute_url }}">
                            <span class="bUi-tMb">
                                <span class="bUi-tMb-pRpL">
                                    <span class="bUi-tMb-cLp">
                                        <span class="bUi-tMb-cLp-iN"> <img class="mDa-oT" src="{% if bus.album.get_cover_image %}{% thumbnail bus.album.get_cover_image 290x0 %}{% else %}https://maps.googleapis.com/maps/api/staticmap?center={{bus_addr.lat}},{{bus_addr.lon}}&zoom=14&size=450x180&markers={{bus_addr.lat}},{{bus_addr.lon}}&sensor=false{% endif %}" alt="{{ bus.name }}">
                                            <span class="vRtL-aLn"> </span>
                                        </span>
                                    </span>
                                </span>
                            </span>
                        </a> 
                    </div>
                    <div class="mDa-bDy">
                        <h4 class="mDa-hD tRnCt0 rLvE" title="{{ bus.name }}"><a href="{{ bus.get_absolute_url }}" class="tRnCt bLk">{{ bus.name }}</a> 
                            
                            <!-- Star Rating -->
                            <div class="sTr-rT ib mRb0 tXt-rT pDt5"><span class="sTr-wPr sTr-rT-rD iCn16 rEd mRb5" id="id_fb_rating_{{bus.id}}"></span><a href="{{ bus.get_absolute_url }}#comments" class="cLr-lTbLu fS12 bLk iB-gD mRl10">{% get_mptt_comment_count for bus as comment_count %}{{comment_count}} {% trans 'reviews' %}</a></div>
                            <!-- Star Rating -->
                            
                        </h4>
                        <div class="mDa-dTa">
                            <ul class="iCnC-lSt iCn10 iCn-gRy">
                                <li class="iCnC-lSt-iTm">
                                    <i aria-hidden="true" class="bUi-iCn-mP-mKr-12"></i>
                                    <a href="{% url 'events_view_venue_event' bus_addr.slug %}">{% if bus_addr.address1 %}{{ bus_addr.address1 }},{% endif %}{% if bus_addr.address2 %}{{ bus_addr.address2 }},{% endif %}{% if bus_addr.city %}{{ bus_addr.city }},{% endif %}{% if bus_addr.state %}{{ bus_addr.state }},{% endif %}{% if bus_addr.country %}{{ bus_addr.country }}{% endif %}</a>
                                </li>
								{% if bus_addr.telephone1 %}
                                <li class="iCnC-lSt-iTm">
                                    <i aria-hidden="true" class="bUi-iCn-cAl-12"></i>
                                    {{ bus_addr.telephone1 }}
                                </li>
								{% endif %}
								{% if bus.categories.all.0.name %}
                                <li class="iCnC-lSt-iTm">
                                    <i aria-hidden="true" class="bUi-iCn-tAg-12"></i>
                                    <a href="{{bus.categories.all.0.get_absolute_url}}">{{bus.categories.all.0.name}}</a>
                                    <!--span class="sPrTr">$$</span-->
                                </li>
								{% endif %}
                            </ul>
                        </div>
                        <!--div class="mDa-hVr"> <a data-toggle="tooltip" data-placement="right" title="Share" class="iCn-lNk btn btn-mini" href="#">
                                <i class="BUI-icon-63"></i>
                                Share</a> </div-->
                    </div>
                </div>
            </li>
			{% endwith %}
            {% endfor %}
		</ul>
		{% include 'usercp_pagination.html' %}
	</div>
</div>  
{% else %}
<div class="pD20 pDt0 cLrfX">                                                                                     
	<div class="hT600 rLvE">
 		<div class="tBl-bLk pDt0">
			<div class="tBl-cEl">
				<span class="iCn-bRdR80 oP25"><i aria-hidden="true" class="bUi-iCn-bSn--24 fS42-1 cLr-lTgRy ib"></i></span>
				<p class="bLk mRt20 fS16 cLr-lTgRy oP75">You haven't added any businesses yet.</p>
				{% ifequal request.user profile.user %}
				<p class="mRt15"><a href="{% url 'user_add_business' %}" class="btn btn-danger fS12 fW-bLd">Add your business</a></p>
				{% endifequal %}
			</div>
		</div>
	</div>
</div> 
{% endif %} 
<script src="{{ STATIC_URL }}themes/js/jquery.raty.js"></script>
<script>	
$(function(){
   
	{% for b in business %}
	// Star Rate Read Only
	
	$('#id_fb_rating_{{b.id}}').raty({
		readOnly: true, 
		score: {{b.ratings}}, 
		//precision: true,
		//target    : '#rw0001',
		//targetKeep: true,
		size      : 16
	});
		
	{% endfor %}	
})
</script>
<script>
$(document).ready(function(){
	var views = $('#media-toggle');
    var figureItems = $('.main').find('.modulesBrowseData');
    var thumbnaiItem = $('.modulesBrowseData').find('.mDa-oT');
    
    
    function setGridColumn(){        
        $('.mDa-gD').each(function(index, element) {
            if(!$(this).hasClass('dSgDwDt')){
                var gridColumnWidth = $(this).find('.mDa').width();
                $(this).find('.mDa .mDa-oT').css({'width':''+gridColumnWidth+'','height':'auto'}); 
            }
        });    
    }
    
    views.on('click', '.c-lT', function() {
        views.find('.btn').removeClass('active');
        $(this).addClass('active');
        figureItems.removeClass('mDa-gD mDa-oT-tP').addClass('mDa-lT mDa-oT-lT');
        if(figureItems.children('li').hasClass('mDa-gRp')){
            figureItems.find('.mDa-gRp > ul').removeClass('pDfX')
        }
        else{
                figureItems.removeClass('pDfX');    
            }
        thumbnaiItem.css('width','auto');
        $('.fLxiMgH').setrSpVHeight('mDa-lT');
        $('.fLxiMgW').setrSpVWidth(0);
        $('.fLxiMgW30').setrSpVWidth(30);
    });
    views.on('click', '.c-gD', function() {
        views.find('.btn').removeClass('active');
        $(this).addClass('active');
        figureItems.removeClass('mDa-lT mDa-oT-lT').addClass('mDa-gD mDa-oT-tP');
        if(figureItems.children('li').hasClass('mDa-gRp')){
            figureItems.find('.mDa-gRp > ul').addClass('pDfX')
        }
        else{
                figureItems.addClass('pDfX');    
            }
        $('.fLxiMgH').setrSpVHeight('mDa-lT');
        $('.fLxiMgW').setrSpVWidth(0);
        $('.fLxiMgW30').setrSpVWidth(30);
        setGridColumn();
    });
    setGridColumn();
    
    
    $(window).bind("resize orientationchange", (function () {
        setGridColumn();            
    }))    
    
    setTimeout(function(){setGridColumn()});
    
    $('.fLxiMgH').setrSpVHeight('mDa-lT');
});
</script>					                
