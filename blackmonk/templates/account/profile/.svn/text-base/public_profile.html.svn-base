{% extends base %}
{% load tabs %}
{% load thumbnail %}
{% load ds_utils %}
{% load i18n %}
{% block pagetitle %}{{ globalsettings.domain }} {{profile.user}}'s Public Profile{% endblock %}
{% block meta %}
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="description" content=""/>
	<meta name="keywords" content=""/>
{% endblock %}
{% block head %}
{% endblock %}
{% block navigation %}
	{% activetab "topnav" "" %}
	{{ block.super }}
{% endblock %}
{% block content %}
<div id="content-container">
    <div class="container-fluid">
        {% if user.email_isvalid == 'I' %}
        <div class="row-fluid"><div class="alert alert-danger bs-alert-old-docs">
            <strong>Alert!</strong> Your email-id is invalid, please update your email-id.
        </div></div>
        {% endif %}
		<div class="row-fluid">                    
            
            	{% include 'account/profile/profile-block.html' %}
            
            <div class="main span9 pDl0 pLlT iM">
				<section class="sCn pD0">
					<div class="cLrFx pD20">
						<div class="row-fluid hMx979 mRb20">
							<div class="pLlT">
								<h3 class="mR0 tRnCt">{{ profile.display_name }}</h3>
							</div>
							{% comment %}
							{% ifequal request.user profile.user %}
							<div class="pLrT">
								<span class="pLlT fS11 pDt7 cLr-gRy mRr5">View profile as:  </span>
                            	<select class="bUiSlCtbtn-link tXt-sMl pLrT">
                                    <option value="title">Yourself</option>
                                    <option value="releaseDate">Public</option>
                                </select>
							</div>
							{% endifequal %}
							{% endcomment %}
						</div>
						{% include 'account/profile/profile_contribution.html' %}
					</div>
					<div id="content_ajax">
					</div>
				</section>
			</div>
            
		</div>
		                
    </div>
</div>  
<script type="text/javascript">
var scroll = false;
function goto_module(module){
	var view = $('#id_hid_view_type').val();
	if (view) {
	    var view = view;
	} else {
	    var view = 'grid';
	}
	var url = '{% url 'ajax_profile_module_deatils' profile.profile_slug %}'
	$('#content_ajax').addClass('dSbLd oP50');
	$.ajax({
		type: "GET",
		url:url,
		data:'module='+module+'&view_type='+view,
		success: function(data){
			$('#content_ajax').empty().html(data);
			$('#content_ajax').removeClass('dSbLd oP50');
			$('.fLxiMgH').setrSpVHeight('mDa-lT');
			$('.fLxiMgW').setrSpVWidth(0);
			if(scroll){
				$('html,body').animate({ scrollTop: $('#content-container').offset().top }, 'slow');
			}
			scroll = true;
		}
	});	
}

function filter_content(page){
	var view = $('#id_hid_view_type').val();
	if (view) {
	    var view = view;
	} else {
	    var view = 'grid';
	}
	var url = '{% url 'ajax_profile_module_deatils' profile.profile_slug %}'
	if (page == '1') {
	    var page = page;
	} else {
	    var page = $('#id_pagentn').val()
	}
    var module = $('#id_prfl_cntbtn').find('.active a').attr('data-module');
	$('#content_ajax').addClass('dSbLd oP50'); 
	$.ajax({
		type: "GET",
		url: url,
		data: 'module='+module+'&page='+page+'&view_type='+view,
		success: function(data){
			$('#content_ajax').empty().html(data);
			$('#content_ajax').removeClass(' dSbLd oP50');
			$('.fLxiMgH').setrSpVHeight('mDa-lT');
			$('.fLxiMgW').setrSpVWidth(0);
			$('html,body').animate({ scrollTop: $('#content-container').offset().top }, 'slow');
		}
	});
}
</script>
<script type="text/javascript">
;
$.fn.updateTB = function () {
    "use strict";
    var flag = false,
        lastAppendedChildW = 0,
        resize = false,
        $this = $(this);
    var plugin = {
        init: function () {
            plugin.build();
            $(window).on('resize', function () {
                plugin.build();
            });
        },
        build: function () {
            var cWidth = $this.width(),
                itemWidth = 0,
                mN = 0,
                lEn = $this.children().length,
                lastItem,
                dropdownFCWidth,
                itemWidth1;
            for (var i = 0; i < lEn; i++) {
                itemWidth += $this.children().eq(i).outerWidth();
                if (itemWidth >= cWidth) {
                    break;
                }
                mN = i;
                itemWidth1 = itemWidth;
            }
            if (flag == true) {
                var nextuntil = $this.children().eq(mN - 1).nextUntil($this.children().eq(lEn - 1));
                if (nextuntil.width() !== null) {
                    lastAppendedChildW = nextuntil.outerWidth();
                }
                $this.find('.dropdown-menu').prepend(nextuntil);
                resize = true;
                if (!$this.find('.dropdown-menu').find('li').length) {
                    $('#moreTB').remove();
                    flag = false;
                    resize = false;
                }
            }
            if (flag == false && itemWidth >= cWidth) {
                flag = true;
                var nextall = $this.children().eq(mN - 1).nextAll();
                $this.children().eq(mN - 1).after('<li class="rLvE" id="moreTB"><a data-toggle="dropdown" href="#"> More  <span class="caret"></span></a><ul class="dropdown-menu pLrT"> </ul></li>');
                $this.find('.dropdown-menu').append(nextall);
            }
            if (flag == true && resize == true) {
                lastAppendedChildW = parseInt(lastAppendedChildW, 10);
                itemWidth1 = parseInt(itemWidth1, 10);
                var tot = lastAppendedChildW + itemWidth1;
                if (tot < cWidth) {
                    $this.children().eq(mN - 2).after($this.find('.dropdown-menu li:first-child'));
                }
            }
        }
    };
    plugin.init();
    return this;
};
$('#id_prfl_cntbtn').updateTB();

$(document).ready(function(){
	var $cont= $('#id_prfl_cntbtn');
	var firts_module = $cont.find('li:first-child a').attr('data-module');
	$cont.find(' > li:first-child').addClass('active');
	goto_module(firts_module);
	$cont.find('li.tBs a').click(function(){
		var  $this = $(this);
		$cont.find('li.active').removeClass('active');
		$this.parent('li').addClass('active');
		var module= $this.attr('data-module');
		goto_module(module);
    });
	$(document).on('click','#moreTB li.tBs a', function(){
		var fC = $cont.find(' > li:first-child');
		$cont.prepend($cont.find('li.active'));	
		$('#moreTB').find('.dropdown-menu').prepend(fC);
	})

});
</script>
{% endblock %}                                     
         
