{% extends "admin_base.html" %}
{% load ds_utils %}
{% load tabs %}
{% block navigation %}
	{% activetab "selmodule" "pricing" %}
	{{ block.super }}
{% endblock %}
{% block pagetitle %}Admin | Manage Business Price{% endblock %}
{% block head %}
<script type="text/javascript">
function showsubcategory(id){
	if('+' == jQuery('#id_parentcategory'+id).html()){
		jQuery('#id_parentcategory'+id).html('--');
		jQuery('.subcategoycss'+id).show();
	}else{
		jQuery('#id_parentcategory'+id).html('+');
		jQuery('.subcategoycss'+id).hide();
	}
}

function check(){
	$('.subcat').each(function(){
		var category_ids = $(this).attr('id').split('id_')[1];
		var cat_id = category_ids.split('_')[1];
		if ($(this).hasClass('month')){
			if ( parseInt($(this).val()) < parseInt($('#monthly_price_'+cat_id).val()) || $.trim($(this).val()) == "")
				{
					$(this).val($('#monthly_price_'+cat_id).val());
				}
		}
		else if ($(this).hasClass('year')){
			if (parseInt($(this).val()) < parseInt($('#yearly_price_'+cat_id).val()) || $.trim($(this).val()) == "")
				{
					$(this).val($('#yearly_price_'+cat_id).val());
				}
		}
	})
}


function validate(){
 	
	var status = false ;
	
	$('.cat_price').each(function(){
	 if ($.trim($(this).val()) == "")
	  	{
			$(this).addClass('error');
			alert('Please fill in the unfilled boxes');
			return false;
		}
	 else if (isNaN($.trim($(this).val())))	
	 	{
			$(this).addClass('error');
			alert('Please enter numbers');
			return false;
		}
	 else{
			$(this).removeClass('error');
			status = true ;
	 	}
	});
	check();
	return status;
}

</script>
{% endblock %}
{% block content %}

	 
        <div class="container group">
        	<div class="page_title group" style="display:block; overflow:hidden; padding:10px 0 20px 0;">
            	<div class="bread-crumb clearfix">
                    <ul>
                        <li><a href="/admin/users/" style="background:#666;font-size:12px; padding:2px 4px; -moz-border-radius:4px;color:#FFF">Admin Home</a></li>

                        <li style="background:#eee;font-size:12px; padding:2px 4px; -moz-border-radius:4px;color:#666">Pricing</li>
                    </ul>
                </div> 
            </div>
			<div class="page_title group" style="display:block; overflow:hidden;">
                <h2 style="display:block; margin:0; padding-left:10px; line-height:normal">Pricing</h2> 
            </div>            
        	<div class="main" style="margin-bottom:20px;">
            	<div class="left_col">
                	<h3>Sections</h3>
                	<ul class="side_menus">
                        <li><a href="/admin/article_pricing/" class="side_menu">Articles</a></li>  
                        <li><a href="/admin/event_pricing/" class="side_menu">Events</a></li>  
                        <li><a href="/admin/business_pricing/" class="side_menu">Business</a></li> 
						<ul class="sub">
							<a href="/admin/business_sponsored/" class="side_menu on">Sponsord Price</a></li> 
						</ul>  
                        <li><a href="/admin/classified_pricing/" class="side_menu">Classifieds</a></li>                                                                       
                    </ul>
                </div> 	
            	<div class="main_col" style="float:left; width:740px;">
            	{% if message %}                         
                  <div class="message" >{{message}}</div>
            	{% endif %}
					<!--div class="page_title group" style="display:block; overflow:hidden; padding-top:10px;">
                        <div class="quick_nav">							
                            <a href="/staff/business/addcategory/" class="thick_link_plus">Add New Category</a>
                        </div>
           			</div-->
           			<form name="bus_spon_price_form" id="id_bus_price_form" method="post" action="/admin/business_sponsored/" onsubmit="return validate();return false;">
					<table class="staff_ctg content" align="center" cellpadding="0" cellspacing="0" width="740">
							<colgroup>
								<col width="550">							
								<col width="60">
                                <col width="130">
							</colgroup>				
							<tbody>
								<tr class="head" style="">
									<th class=""><div>Category</div></th>
									<th class="posted_by"><div>Price/Month</div></th>
									<th class="action" style="text-align: left;"><div>Price/Year</div></th>
								</tr>
								{% for category in parentcategoryes %}
									<tr class="row">
										<td class="category" style="width:300px;">
											<div class="main_category_title">
												<h5 style="margin:0; padding:0;" onclick="showsubcategory({{ category.id }});"><b id="id_parentcategory{{ category.id }}">+</b> <a href="#" onclick="return false;">{{ category.name }}</a></h5>
											</div>
										</td>
										<td class="posted_by" style="">
											Starts at
											<div>
	                                            {{ globalsettings.currency }} <input type="text"  class="cat_price" id="monthly_price_{{category.id}}" name="monthly_price_{{category.id}}" value="{% if category.price_month %}{{category.price_month}}{% endif %}"  onkeyup="check()" size="7"/>   
											</div>											
										</td>
										<td class="posted_by" style="">
											Starts at
											<div >
												 {{ globalsettings.currency }} <input type="text" class="cat_price" id="yearly_price_{{category.id}}" name="yearly_price_{{category.id}}" value="{% if category.price_year %}{{category.price_year}}{% endif %}" onkeyup="check()" size="7"/>
											</div>
										</td>
									</tr>
									{% for subcat in category.getChildCategory %}
										<tr class="row sub subcategoycss{{ category.id }}">
											<td class="category" style="width:300px;">
												<div class="sub_category_title">
													<h5>{{ subcat.name }}</h5>
												</div>
											</td>
											<td class="posted_by" style="width:120px;">
												<div>
		                                            {{ globalsettings.currency }} <input type="text" id="id_{{ subcat.id }}_{{category.id}}" class="subcat month" name="monthly_price_{{subcat.id}}" value="{% if subcat.price_month %}{{ subcat.price_month }}{% endif %}" size="7"/>  
												</div>											
											</td>
											<td class="action" style="">
												<div >
													{{ globalsettings.currency }} <input type="text" id="id_{{ subcat.id }}_{{category.id}}" class="subcat year" name="yearly_price_{{subcat.id}}" value="{% if subcat.price_year %}{{ subcat.price_year }}{% endif %}" size="7"/>
												</div>
											</td>
										</tr>
									{% endfor %}
								{% endfor %}				
                                </tbody>
						</table>
					<input type="submit"  value="submit">
                </div> 
                <hr />
            </div>
<script type="text/javascript">
{% for category in parentcategoryes %}
	jQuery('.subcategoycss{{ category.id }}').hide();
{% endfor %}
</script>
{% endblock %}
				