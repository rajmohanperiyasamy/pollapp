{% extends "user_base.html" %}
{% load i18n %}
{% load upload_tags %}
{% load ds_utils %}
{% load tabs %}

{% block pagetitle %}{% if category %}{% seo_format_tag module='Events' title=category.seo_title code='LT' category=category.name as seo_meta_title %}{% else %}{% seo_format_tag module='Events' title=seo.seo_title code='MT' as seo_meta_title %}{% endif %}{{seo_meta_title}}{% endblock %}
{% block meta %}
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="{{seo.seo_description}}" />
{% endblock %}

{% block head %}
    <link type="text/css" rel="stylesheet" href="{{STATIC_URL}}css/bm.jfp.ui.css">
	<script type="text/javascript" src="{{ STATIC_URL }}js/ckeditor4/ckeditor.js"></script>
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}themes/green/css/LE_MetaId99.css">
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.ui.datepicker.js"></script>
	<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/bm.common.js"></script>
	<script type="text/javascript" src="{{STATIC_URL}}js/date.format.js"></script>
	<script type="text/javascript">
		var mySource = [{ id: 1, name: '12:00 AM'}, { id: 2, name: '12:30 AM'}, { id: 3, name: '01:00 AM'}, { id: 3, name: '01:30 AM'}, { id: 3, name: '02:00 AM'}, { id: 3, name: '02:30 AM'}, { id: 3, name: '03:00 AM'}, { id: 3, name: '03:30 AM'}, { id: 3, name: '04:00 AM'}, { id: 3, name: '04:30 AM'}, { id: 3, name: '05:00 AM'}, { id: 3, name: '05:30 AM'}, { id: 3, name: '06:00 AM'}, { id: 3, name: '06:30 AM'}, { id: 3, name: '07:00 AM'}, { id: 3, name: '07:30 AM'}, { id: 3, name: '08:00 AM'}, { id: 3, name: '08:30 AM'}, { id: 3, name: '09:00 AM'}, { id: 3, name: '09:30 AM'}, { id: 3, name: '10:00 AM'}, { id: 3, name: '10:30 AM'}, { id: 3, name: '11:00 AM'}, { id: 3, name: '11:30 AM'},{ id: 1, name: '12:00 PM'}, { id: 2, name: '12:30 PM'}, { id: 3, name: '01:00 PM'}, { id: 3, name: '01:30 PM'}, { id: 3, name: '02:00 PM'}, { id: 3, name: '02:30 PM'}, { id: 3, name: '03:00 PM'}, { id: 3, name: '03:30 PM'}, { id: 3, name: '04:00 PM'}, { id: 3, name: '04:30 PM'}, { id: 3, name: '05:00 PM'}, { id: 3, name: '05:30 PM'}, { id: 3, name: '06:00 PM'}, { id: 3, name: '06:30 PM'}, { id: 3, name: '07:00 PM'}, { id: 3, name: '07:30 PM'}, { id: 3, name: '08:00 PM'}, { id: 3, name: '08:30 PM'}, { id: 3, name: '09:00 PM'}, { id: 3, name: '09:30 PM'}, { id: 3, name: '10:00 PM'}, { id: 3, name: '10:30 PM'}, { id: 3, name: '11:00 PM'}, { id: 3, name: '11:30 PM'}];
	    $(document).ready(function(){
			$('#id_event_venue').typeahead({
        		ajax: { url: '{% url 'auto_suggest_venue' %}',type: "GET",
                triggerLength: 1 },
				itemSelected: function(item){display_auto_sgtd_addres($(".typeahead.dropdown-menu .active").attr("data-value"));},
    		});
			$('#id_start_time').typeahead({
				source: mySource
			});
			$('#id_end_time').typeahead({
				source: mySource
			});
		});
    </script>
	
{% endblock %}

{% block navigation %}
    {% activetab "leftnav" "events" %}
    {{ block.super }}
{% endblock %}

{% block content %}
{{form.errors}}
            <div class="span10 sP9mX979 sP12mX767">
                <div class="row-fluid">
                    <div class="main span9">
                        <section class="sCn pD0">
                            <div class="cLrFx pD20">
                                <div class="pLlT">
                                    <h3 class="mR0 tRnCt">{% if not event %}Create{% else %}Edit{% endif %} Event</h3>
                                </div>
                            </div>
                            <hr class="mRb12 mRt0">
                            <div class="pD20">
                                <form action="{% url 'events_addevent' %}{%if event%}?eid={{event.id}}{%endif%}" name="mform1" id="mform1" method="post" class="form-horizontal uSr-aCnT mRb0">{% csrf_token %}
                                    <div class="control-group">
                                        <label class="control-label" >Event Name<em class="cLr-rEd">*</em></label>
                                        <div class="controls">
                                            {{form.title}}
                                            <a href="javascript:void(0);" class="cLr-gRy tIp" data-toggle="popover" data-placement="left" data-content="Make it descriptive! It should be clean and understandable. (This title shows in the search results)" title="Event Title"><i aria-hidden="true" class="bUi-iCn-qSt-16 ib lH1"></i></a>
                                        </div>
                                    </div>
                                    {% include 'common/coverphoto_form_user.html' %}
                                    <div class="control-group">
                                        <label class="control-label" >Event Categories<em class="cLr-rEd">*</em></label>
                                        <div class="controls">
                                            {{ form.category }}
                                        </div>
                                    </div>
                                    <div class="control-group mRb10" id='date_time'>
                                        <label class="control-label" >Date &amp; Time<em class="cLr-rEd">*</em></label>
                                        <div class="controls">
                                            <div class="span2 sP6mP pLlTmP mRb6Mp">{{ form.start_date }}</div>
                                            <div class="span2 sP6mP pLlTmP mRb6Mp pDl6mP">{{ form.start_time }}</div>
                                            <div class="span2 sP6mP pLlTmP mRb6Mp pDl6mP">{{ form.end_time }}</div>
                                            <div class="span2 sP6mP pLlTmP mRb6Mp">{{ form.end_date }}</div>
                                        </div>
                                    </div>
                                    <div class="control-group">
                                        <div class="controls">
                                            <label class="checkbox inline fW-nRmL">
                                                <input type="checkbox" onclick="enble_dsble_timing();$('#id_start_time').removeClass('error');$('#id_end_time').removeClass('error');$('#date_time').removeClass('error');" name="event_timing" id="id_all_day"> All Day
                                            </label>
                                            <label class="checkbox inline fW-nRmL">
                                                <a data-toggle="modal" data-target="#repeat" class="cLr-dRkR">
                                                    <input type="checkbox" name="event_timing_repeat" id="id_repeat" {% if event.is_reoccuring %}checked="checked"{% endif %}> Repeat
													<input type="hidden" id="is_reoccuring" value="{% if event.is_reoccuring %}yes{% else %}no{% endif %}">
                                                </a>
                                            </label>
                                        </div>
										<div class="controls">
											<label class="inline fW-nRmL">
												<span id="display_repeat_smry" style="font-weight:bold;{% if not event.is_reoccuring %}display:none;{% endif %}">{% if event.repeat_summary %}{{event.repeat_summary}}{% endif %}</span>
												<span id="id_edit_btn" style="{% if not event.is_reoccuring %}display:none;{% endif %}"><a href="javascript:void(0);" data-toggle="modal" data-target="#repeat">Edit</a></span>
												<input type="hidden" value="{% if event.repeat_summary %}{{event.repeat_summary}}{% endif %}" name="repeat_summary" id="id_repeat_summary">
												<input type="hidden" value="{% if event.rule.repeat %}{{event.rule.repeat}}{% endif %}" name="repeat_store" id="id_repeat_store">
												<input type="hidden" value="{% if event.rule.repeat_every %}{{event.rule.repeat_every}}{% endif %}" name="repeat_every_store" id="id_repeat_every_store">
												<input type="hidden" value="{% if event.rule.repeat_on_wk %}{{event.rule.repeat_on_wk}}{% endif %}" name="repeat_on_wk_store" id="id_repeat_on_wk_store">
												<input type="hidden" value="{% if event.rule.repeat_on_mnth %}{{event.rule.repeat_on_mnth}}{% endif %}" name="repeat_on_mnth_store" id="id_repeat_on_mnth_store">
												<input type="hidden" value="{% if event.rule.ends %}{{event.rule.ends}}{% endif %}" name="ends_store" id="id_ends_store">
												<input type="hidden" value="{% if event.rule.ends_occurence %}{{event.rule.ends_occurence}}{% endif %}" name="ends_occurence_store" id="id_ends_occurence_store">
												<input type="hidden" value="{% if event.rule.ends_on %}{{event.rule.ends_on|date:"m/d/Y"}}{% endif %}" name="ends_on_store" id="id_ends_on_store">
											</label>
										</div>
                                    </div>
                                    <div class="control-group">
                                        <label class="control-label">Where<em class="cLr-rEd">*</em></label>
										<div class="controls" id="evnt_vnu" {% if venue %}style="display: none;"{% endif %}>
                                            <input type="text" autocomplete='off' id="id_event_venue" name="event_venue" class="iSp8 typeahead" placeholder="Type venue name to search." value="{{venue}}">
										    <!--span class="help-block bm-error-txt-spn fS12">Please enter venue name to search.</span-->
										    <span class="help-block pDt10 mRt-4">
										        <a class="btn btn-link pD0 fS12" data-target="#addVenue" data-toggle="modal">Add new venue</a>
										    </span>
                                        </div>
                                        <div class="controls" id="address_info">
											{% if venue %}
                                            	{% include 'events/user/part_address.html' %}
											{% endif %}
                                        </div>
										<div class="controls" style="display: none"  id="ajax_venue_loading">
											<img src="{{STATIC_URL}}ui/images/global/loading-s.gif">
										</div>
                                	</div>

                                    <div class="control-group">
                                        <label class="control-label" >Email & Phone </label>
                                        <div class="controls">
                                            <div class="span4 sP6mP pLlTmP">{{form.contact_email}}</div>
                                            <div class="span4 sP6mP pLlTmP pDl6mP">{{form.phone}}</div>
                                        </div>
                                    </div>
                                    <div class="control-group">
                                        <label class="control-label" >Website</label>
                                        <div class="controls">
                                            {{form.event_website}}
                                        </div>
                                    </div>
                                    <div class="control-group mRb0">
                                        <label class="control-label pDt0">Networks</label>
                                        <div class="controls mRb20">
                                            <label class="fW-nRmL">Facebook</label>
                                            {{form.facebook}}
                                        </div>
                                        <div class="controls mRb20">
                                            <label class="fW-nRmL">Google Plus</label>
                                            {{form.googleplus}}
                                        </div>
                                    </div>
                                    <div class="control-group">
                                        <label class="control-label" >Price</label>
                                        <div class="controls">
                                            <div class="span4 sP6mP pLlTmP">
                                                {{ form.tkt_prize }}
                                            </div>
                                            <div class="span4 sP6mP pLlTmP pDl6mP pDt8">
                                                <label class="checkbox inline fW-nRmL">
                                                    <input type="checkbox" name="free_event" onclick="free_event1();" id="id_free_Event" {% ifequal event.tkt_prize "FREE" %}checked{% endifequal %}{{free_event_checked}}> Is this a FREE event?
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="control-group">
                                        <label class="control-label" >Online Ticket</label>
                                        <div class="controls">
                                            <div class="span4 sP6mP pLlTmP">{{ form.ticket_site }}</div>
                                            <div class="span4 sP6mP pLlTmP pDl6mP">{{ form.tkt_phone }}</div>
                                        </div>
                                    </div>
                                    <div class="control-group">
                                        <label class="control-label" >Description<em class="cLr-rEd">*</em></label>
                                        <div class="controls">
                                            {{ form.event_description }}
                                        </div>
                                    </div>
                                    <div class="control-group">
                                        <label class="control-label">Tags</label>
                                        <div class="controls">
                                            <input type="text" name="tags" value="{% for tag in event_tags %}{{tag}}{% if not forloop.last %},{% endif %}{% endfor %}" class="iSp8 tagsinput" placeholder="tags">
                                        </div>
                                    </div>
                                    <div class="control-group">
                                        <label class="control-label"></label>
                                        <div class="controls">
                                            <div id="fileupload" >
                                                <div class="fileupload-content">
                                                    <ul class="files bm-uploader-list"></ul>
                                                </div>
                                                <div class="clear"></div>
                                                <div id="bm-dropzone_area" class="dropzone">{% trans 'Drop the files here' %}</div>
                                                {% csrf_token %}<div class="clear"></div>
                                                <div class="upload-button-wrapper">
                                                    <a class="btn btn-primary fS12 fW-bLd">{% trans 'Add Images' %}</a>
                                                    <div class="fileinput-button">
                                                        <input type="file" style="cursor:pointer;" title="Add Images" name="photo" id="id_photo" multiple=""  accept="image/*" tabindex="-1">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <hr class="oTsT-hRz20 mRb0">
                                    <div class="row-fluid">
                                        <div class="form-actions pD0 pLrT">
                                            {% if event.is_paid %}<a href="{% url 'events_dash_board' %}" class="btn btn-light fS12 fW-bLd ">Cancel</a>{% endif %}
                                            <button type="submit" id="id_event_submit" class="btn btn-danger fS12 fW-bLd">{% if event.is_paid %}Save{% else %}Next{% endif %}</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </section>
                    </div> <!-- /.main -->
                    <aside class="sD-bR span3">
                        <div>
                            <section class="tXt-cTr pD0 bNr-aD"> 

                            </section>
                        </div>
                    </aside>
                </div>  <!-- /.row-fluid -->
            </div>
{% endblock %}

{% block footerarea %}
	<!-- POPUP FORMS HOLDER STARTS -->
	<div id="update_caption" class="modal hide fade mW50" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 id="myModalLabel" class="mR50">Update Caption</h4>
        </div>
        <div class="modal-body">
			<div style="text-align: center; width: 100%;">
				<img src="{{STATIC_URL}}ui/images/global/loading.gif" align="...">
			</div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-light" type="submit" data-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" type="submit" onclick="update_caption();">Done</button>
        </div>
   	</div>
	<div id="repeat" class="modal hide fade mW50" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 id="myModalLabel" class="mR50">Event Repeat Timing</h4>
        </div>
        <div class="modal-body">
			<div style="text-align: center; width: 100%;">
				<img src="{{STATIC_URL}}ui/images/global/loading.gif" align="...">
			</div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-light" type="submit" data-dismiss="modal" onclick="cancel_repeat_timing();">Cancel Repeat</button>
            <button class="btn btn-primary" type="submit" onclick="save_repeat();">Save Repeat</button>
        </div>
    </div>
    <div id="addVenue" class="modal hide fade mW70" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 id="myModalLabel" class="mR50">Venue Form</h4>
        </div>
        <div class="modal-body">
			<div style="text-align: center; width: 100%;">
				<img src="{{STATIC_URL}}ui/images/global/loading.gif" align="...">
			</div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-light" type="submit" data-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" type="submit" onclick="save_venue()">Done</button>
        </div>
    </div>
	<!-- POPUP FORMS HOLDER ENDS -->
    
    {% upload_js %}
    <script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.jfp.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.fup.appln.js"></script>
    
	<script src="http://maps.googleapis.com/maps/api/js?v=3&sensor=false{% if globalsettings.google_map_key %}&key={{ globalsettings.google_map_key }}{% endif %}" type="text/javascript"></script>
	<script type="text/javascript" src="{{STATIC_URL}}js/general/google_map.js"></script>
    <script>
		var edt;
		function resizeEditor() {
  			edt.resize('100%',edt.config.height+50);
		}
        $(document).ready(function(){
			{% if event %}
				if($('#id_start_time').val()==''||$('#id_end_time').val()==''){
					$('#id_start_time').attr('disabled','disabled');
					$('#id_end_time').attr('disabled','disabled');
					$("#id_all_day").prop('checked', true);
				}
			{% endif %}
                                     
            file_upload('{% url 'events_ajax_upload_photos' %}{%if event.id%}?id={{event.id}}{%endif%}',20);
            {% with form.instance|content_type as ctype %}
    		cover_photo_upload("{% url 'common_upload_cover_photo' %}?ctype={{ctype.pk}}&cobj={{form.instance.id}}", 100/70);
    		{% endwith %}
            {% if not event %}
            {% if new_pic %}
                get_images('{% url 'events_ajax_get_default_photos' %}?ids={% for np in new_pic %}{{np}}{% if not forloop.last %},{% endif %}{% endfor %}')
            {% endif %}
            {% endif %}
            
			$('#id_event_website').focusin(function(){
				if($('#id_event_website').val()==""){
					$('#id_event_website').val('http://www.');
				}
			});
			$('#id_event_website').focusout(function(){
				if($('#id_event_website').val()=='http://www.'){
					$('#id_event_website').val('');
				$(this).parent('div').parent('div').removeClass('field-error');$('#id_event_website').removeClass("error");	
				}
			});

            $.validator.addMethod("time_format_required", function(value, element) {
                var match = false;
                for (var i=0;i<mySource.length;i++){
                    if(mySource[i].name == element.value){
                        match = true;
                    }
                }
                return match;
            },"Please enter a description.");
			$.validator.addMethod(
			    "hasDatepicker",
			    function(value, element) {
			        var re = /^(0[1-9]|1[0-2])\/(0[1-9]|1\d|2\d|3[01])\/(19|20)\d{2}$/;
			        // valid if optional and empty OR if it passes the regex test
					return re.test(value);
			    }
			);
			$("#mform1").validate({
    			ignore:'',
    			highlight: function(element, errorClass){
    				if(element.id == 'id_end_date' || element.id == 'id_start_date' || element.id == 'id_start_time' || element.id == 'id_end_time'){
    					$(element).parent('div').parent('div').parent('div').addClass('error');
    				}
    				else{
    					$(element).parent('div').parent('div').addClass('error');
    					$(element).parent('div').addClass('error');
    				}
    				//$(element).parent('div').parent('div').addClass('error');
    				$(element).addClass('error');
    			},
    			unhighlight: function(element, errorClass){
    				if(element.id == 'id_end_date' || element.id == 'id_start_date' || element.id == 'id_start_time' || element.id == 'id_end_time'){
    					var stdt = false;
    					var endt = false;
    					for (var i=0;i<mySource.length;i++){
    	                    if(mySource[i].name == $('#id_start_time').val()){
    	                        stdt = true;
    	                    }
    						if(mySource[i].name == $('#id_end_time').val()){
    	                        endt = true;
    	                    }
    	                }
    					if($('#id_all_day').is(':checked')){
    						stdt = true;
    						endt = true;
    					}
    					if($('#id_start_date').val() && $('#id_end_date').val() && stdt && endt){
    						$(element).parent('div').parent('div').parent('div').removeClass('error');
    					}
    				}
    				else{
    					$(element).parent('div').parent('div').removeClass('error');
    					$(element).parent('div').removeClass('error');
    				}
    				$(element).removeClass('error');
    			},
    			errorPlacement: function(error, element){},
				invalidHandler: function(event, validator) {
					try{ 
					var id = $(validator.errorList[0].element).parent('div');
					$('html,body').animate({ scrollTop: $(id).offset().top }, 'slow');
					}catch(e){}
				},
    		   	rules:{
    		    	title: "required",
    		    	category: "required",
    		    	event_description: "required",
    				start_date: "required",
    				end_date: "required",
    		    	{% if not venue %}event_venue:"required",{% endif %}
    		    	ticket_site: {url: true},
    				event_website: {url: true},
    				facebook: {url: true},
    				googleplus: {url: true},
    		    	contact_email: {email: true},
                    start_time: "time_format_required",
                    end_time: "time_format_required",
    				tkt_prize:{required:false,number:true},
    		   	},
				submitHandler: function(form) {
					$('#id_event_submit').attr('disabled','disabled');
					form.submit();
				}
			});
			$('.select-menu').bind("change", function(){
				$("#mform1").validate().element($(this));
			});
			$('#id_start_time').bind("change", function(){
				$("#mform1").validate().element($(this));
			});
			$('#id_end_time').bind("change", function(){
				$("#mform1").validate().element($(this));
			});
			$('#id_category').bind("change", function(){
				$("#mform1").validate().element($(this));
			});
			
			$("#id_event_submit").click(function(event){
				setTimeout(function(){
					$('#id_event_submit').removeAttr('disabled'),event.preventDefault();
				},3000);
			});
			/*
			CKEDITOR.on( 'instanceCreated', function( e ){
				e.editor.addCss('body { font-size:12px; font-family:Arial, "Times New Roman", Verdana;}');
			});
			*/
			edt=CKEDITOR.replace( 'id_event_description',{                   
	            customConfig : '{{ STATIC_URL }}js/ckeditor/custome_config.js',
	            toolbar : 'Basic',
	           	width:500,height:200
			});
			edt.on('key', function(event) {updateTextArea();});


			{% if not event %}
	            var today = new Date();
	            m = today.getMonth() + 1;
	            if(m < 10){m = "0"+m;}
	            d = today.getDate();
	            if(d < 10){d = "0"+d;}
	            y = today.getFullYear();
            	$("#id_start_date").val(m+"/"+d+"/"+y);
			{% endif %}

            if ($("#id_start_date").length) {
                $("#id_start_date").datepicker({
                    dateFormat: "mm/dd/yy",
                    minDate: new Date(),
                    onSelect: function(){
                        $(this).valid();
                        enddate = $(this).val();
                        splittedval = enddate.split('/');
                        var date = new Date(splittedval[2], splittedval[1]-1, splittedval[0]);
                        //date.setDate(date.getDate() + 1);
                        $("#id_end_date").datepicker( "option", "minDate", date );
                    }
                });
            }
            if ($("#id_end_date").length) {
                $("#id_end_date").datepicker({
                    dateFormat: "mm/dd/yy",
                    minDate: new Date(),
                    onSelect: function() { $(this).valid(); }
                });
            }
			$('#addVenue').on('show.bs.modal', function () {
			  	$("#addVenue .modal-body").html($("#loading_image").html());
				$.ajax({
	                type: "GET",
	                url: '{% url 'events_ajax_add_venue' %}',
	                data: 'vid='+$("#id_venue").val(),
	                dataType: 'JSON',
	                success: function(data){    
	                    if(data.status){
							$("#addVenue .modal-body").html(data.html);
	                    }else{show_msg(data.msg,data.mtype);}
	                }
	            }); 
			})
			$('#repeat').on('show.bs.modal', function () {
				$('html,body').animate({scrollTop: $('body').offset().top},'slow');
			  	$("#repeat .modal-body").html($("#loading_image").html());
				$.ajax({
	                type: "GET",
	                url: "{% url 'events_time_repeat' %}",
	                data: "edit="+$("#is_reoccuring").val()+"&rule={{event.rule.id}}",
	                dataType: 'HTML',
	                success: function(data){    
	                    $("#repeat .modal-body").html(data);
						initapp();
	                }
	            }); 
			})
        });
		$('#repeat').on('shown.bs.modal', function (e) {
               $("body").css("overflow", "hidden");
       })
       $('#repeat').on('hidden.bs.modal', function (e) {
               $("body").css("overflow", "auto");
       })
		function updateTextArea(){
		    CKEDITOR.tools.setTimeout( function(){ 
		        $('#id_event_description').val(edt.getData());
		        $("#id_event_description").trigger('keyup');
		    }, 0);  
		}
		function save_venue(){
			var flag = $('#mform').validate({
				ignore:'',
				highlight: function(element, errorClass){
					$(element).parent('div').parent('div').addClass('error');
					$(element).parent('div').addClass('error');
					$(element).addClass('error');
				},
				unhighlight: function(element, errorClass){
					$(element).parent('div').parent('div').removeClass('error');
					$(element).removeClass('error');
				},
				errorPlacement: function(error, element){},
				rules:{
			    	venue: "required",
			    	address1: "required",
					city: "required",
					type:"required"
			   	}
			}).form();
			var id=0;
			if(flag==true){
				var lat_lng = marker.getPosition();
				var zoom = map.getZoom();
				var vid = $("#venue_id").val();
				$('#lat_lng').val(lat_lng);
				$('#zoom').val(zoom);
				var dataString = 'vid='+ vid + '&venue=' + encodeURIComponent($('#id_venues').val());
				dataString += '&lat_lng=' + encodeURIComponent($('#lat_lng').val());
				dataString += '&zoom=' + encodeURIComponent($('#zoom').val());
				dataString += '&address1=' + encodeURIComponent($('#id_address1').val());
				dataString += '&address2=' + encodeURIComponent($('#id_address2').val());
				dataString += '&city=' + encodeURIComponent($('#id_city').val());
				dataString += '&zip=' + encodeURIComponent($('#id_zip').val());
				dataString += '&type=' + encodeURIComponent($('#id_type').val());
				dataString += '&telephone1=' + encodeURIComponent($('#id_telephone1').val());
				dataString += '&email=' + encodeURIComponent($('#id_email').val());
				dataString += '&website=' + encodeURIComponent($('#id_website').val());
				dataString += '&description=' + encodeURIComponent($('#id_descriptions').val());
				$.ajax({
					type: "POST",
					url: '{% url 'events_ajax_add_venue' %}',
	                data: dataString,
					dataType:'JSON',
					success: function(data){
							if(data.status){
								$('#evnt_vnu').hide();
								$('#address_info').html(data.html);
								$('#id_event_venue').val(data.id);
								$('#addVenue').modal('hide');
							}else{
								$("#addVenue .modal-body").html(data.lightbox_html);
							}
					}
				});
			}
		}


		function showhttp(vl){
			if(vl=='f'){if($('#id_facebook').val()==""){$('#id_facebook').val('http://www.facebook.com/');}}
			else {if($('#id_googleplus').val()==""){$('#id_googleplus').val('http://plus.google.com/');}}
			//else if(vl=='tw'){if($('#id_twitter_url').val()==""){$('#id_twitter_url').val('http://www.twitter.com/');}}
		}
		function hidehttp(vl){
			if(vl=='f'){
				if($('#id_facebook').val()=='http://www.facebook.com/'){
					$('#id_facebook').val('');
					var element=$('#id_facebook');
					$(element).parent('div').parent('div').removeClass('field-error');$(element).removeClass("error");
				}
			}
			else {
				if($('#id_googleplus').val()=='http://plus.google.com/'){
					$('#id_googleplus').val('');
					var element=$('#id_googleplus');
					$(element).parent('div').parent('div').removeClass('field-error');$(element).removeClass("error");
				}
			}
			/*else if(vl=='tw'){
				if($('#id_twitter_url').val()=='http://www.twitter.com/'){
					$('#id_twitter_url').val('');
					var element=$('#id_twitter_url');
					$(element).parent('div').parent('div').removeClass('field-error');$(element).removeClass("error");
				}
			}*/
		}


		function clear_venue() {
			$('#id_event_venue').val('');
			$('#id_ven_address').remove();
			$('#evnt_vnu').fadeIn();
		}
        function display_auto_sgtd_addres(ven){
            $('#evnt_vnu').hide();
            $('#ajax_venue_loading').show();
            $.ajax({
                type: "GET",
                url: '{% url 'user_events_display_address' %}',
                data:'venue_id=' + ven,
                dataType:'JSON',
                success: function(data){    
                    if(data.status){
                        $('#ajax_venue_loading').hide();
                        $('#address_info').html(data.html);
                    }else{show_msg(data.msg,data.mtype);}
                }
            });    
        }    
		function free_event1()
		{	
			if($('#id_free_Event').attr('checked')){
				$('#id_tkt_prize').attr('disabled','disabled');
				$('#id_tkt_prize').val('');
				$('#id_ticket_site').attr('disabled','disabled');
				$('#id_ticket_site').val('');
				$('#id_tkt_phone').attr('disabled','disabled');
				$('#id_tkt_phone').val('');
		
			}
			else{
				$('#id_tkt_prize').removeAttr('disabled');
				$('#id_ticket_site').removeAttr('disabled','disabled');
				$('#id_tkt_phone').removeAttr('disabled','disabled');
			}		
		}
		function enble_dsble_timing(){
			if($("#id_all_day").prop("checked")){
				$('#id_start_time').attr('disabled','disabled');
				$('#id_start_time').val('');
				$('#id_end_time').attr('disabled','disabled');
				$('#id_end_time').val('');
			}else{
				$('#id_start_time').removeAttr('disabled','disabled');
				$('#id_end_time').removeAttr('disabled','disabled');
			}
		}
		function save_repeat(){
			var chkkk_days = []
			var dataString = 'repeat='+$('#id_repeats').val();
			$('#id_repeat_store').val($('#id_repeats').val());
			dataString+= '&rpt_evry='+$('#id_repeat_every').val();
			$('#id_repeat_every_store').val($('#id_repeat_every').val());
			if($('#id_repeats').val()=='2'){
				$('#id_repeat_on_wk_store').val('');
				if($('#id_repeat_on_monthly_:checked').val()=='M'){
					dataString+='&rpt_on=M'
					$('#id_repeat_on_mnth_store').val('M');
				}else{
					dataString+='&rpt_on=W'
					$('#id_repeat_on_mnth_store').val('W');
				}
			}else if($('#id_repeats').val()=='1'){
				$('#id_repeat_on_mnth_store').val('');
				$('.repeat_chkbx:checked').each(function(){
					chkkk_days.push($(this).attr('name'));
				});
				if(chkkk_days.length=='0'){
					dataString+='&rpt_dates='+blank_day();
					$('#id_repeat_on_wk_store').val(blank_day());
				}else{
					dataString+='&rpt_dates='+chkkk_days
					$('#id_repeat_on_wk_store').val(chkkk_days);
				}
			}else{
				$('#id_ends_occurence_store').val('');
				$('#id_repeat_on_wk_store').val('');
			}
			dataString+= '&ends='+$('.chk_ends:checked').val();
			$('#id_ends_store').val($('.chk_ends:checked').val());
			if($('.chk_ends:checked').val()=='AFT'){
				//$('#id_ends_on_store').val('');
				dataString+='&ends_occurence='+$('#id_ends_occurences').val();
				$('#id_ends_occurence_store').val($('#id_ends_occurences').val());
			}else{
				$('#id_ends_occurence_store').val('');
				dataString+='&ends_date='+$('#id_ends_on_date').val();
				$('#id_ends_on_store').val($('#id_ends_on_date').val());
				$('#id_end_date').val($('#id_ends_on_date').val());
			}
			
			$('#id_repeat_timing_ids').val(dataString);
			$('#display_repeat_smry').text($('#id_display_summary').text());
			$('#id_repeat_summary').val($('#id_display_summary').text());
			
			$('#display_repeat_smry').show();
			$('#id_edit_btn').show();
			$("#is_reoccuring").val("yes");

			$("#id_repeat").attr('checked','checked');
			$('#repeat').modal('hide');
			$("body").css("overflow", "auto");
			
		}
		function blank_day(){
			var start_date=$('#id_start_date').val();
			var mydates = start_date.split('/')
			var mynewdate = new Date(mydates[2],mydates[1]-1,mydates[0])
			each_day=mynewdate.getDay()
			return $('#id_'+each_day).val();
		}
		function cancel_repeat_timing(){
			$("body").css("overflow", "auto");
			$("#id_repeat").removeAttr('checked','checked');
			$('#display_repeat_smry').hide();
			$("#is_reoccuring").val("no");
			$('#id_edit_btn').hide();
		}
		function show_update_caption_lb(url) {
			target = url+'?user="true"';
		   // load the url and show modal on success
		   $("#update_caption .modal-body").load(target, function() {
		        $("#update_caption").modal("show");
		   });
		}
	
		function update_caption(){
			$.ajax({
			    type: "POST",
			    url: $('#id_form_update_caption').attr('action'),
			    data: 'caption='+encodeURIComponent($('#id_caption').val()),
			    dataType:'JSON',
			    success: function(data){
		            if(data.status){
		                $('#update_caption').modal('hide');
		            }
		            else{
						$("#update_caption .modal-body").html(data.html);
		            }
		        }
		    });
		}
    </script>
{% endblock %}