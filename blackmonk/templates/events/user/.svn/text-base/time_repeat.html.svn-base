<script>
	$(function() {$('.bM-sLt').bUiSlCt();}) 
</script>
<script type="text/javascript">
	function weekAndDay(dte) {
		var res = Math.floor(dte.getDate()/7)
        days = ['Sunday','Monday','Tuesday','Wednesday',
                'Thursday','Friday','Saturday'],
        prefixes = ['','first', 'second', 'third', 'fourth', 'fifth'];
        
		if( dte.getDate() % 7 )
		{
		res = res + 1;
		   }
    return prefixes[res] + ' ' + days[dte.getDay()];

	}
</script>
<script>
function initapp(){
	$('#id_repeats').change(function() {
			var val = $('#id_repeats').val();
			if(val=='0' || val=='3'){
				$('#id_repeat_on_weekly').hide();
				$('#id_repeat_on_monthly').hide();
				}
			if(val=='1'){
				$('#id_repeat_on_weekly').show();
				$('#id_repeat_on_monthly').hide();
				}
			if(val =='2' ){
				$('#id_repeat_on_weekly').hide();
				$('#id_repeat_on_monthly').show();
				}
			create_summery(true);
	});
	if($("#id_ends_on_date").length){
		$("#id_ends_on_date").datepicker({ 
			dateFormat: "mm/dd/yy", 
			minDate: new Date(), 
			onSelect: function() { create_summery(true); } 
		});
	}
	{% if edit %}
		edit_display();
	{% else %}
		add_display();
	{% endif %}
}
function ends_manage()
{	
	$('.chk_ends:checked').each(function(){
		if($(this).val()=='AFT'){
			$('#id_ends_on_date').attr('disabled','disabled');
			$('#id_ends_occurences').removeAttr('disabled','disabled');
		}
		else{
			$('#id_ends_occurences').attr('disabled','disabled');
			$('#id_ends_on_date').removeAttr('disabled','disabled');
			if($('#id_ends_on_date').val()==''){
				end_default_dat();
			}
		}
	});
	create_summery(false);
}	
function create_summery(init){
  var summary = ""
	var chkk_days = []
	
  if($('#id_repeat_every').val()=='1'){
		summary+="Repeat every " + $('#id_repeats option:selected').text();
		if($('#id_repeats').val()=='1'){
			$('.repeat_chkbx:checked').each(function(){
				chkk_days.push($(this).val());
			});
			if(chkk_days.length=='7'){
				summary+=' on all days '
			}else if(chkk_days.length=='0'){
				summary+=' on '+blank_days();
			}
			else{summary+=' on '+chkk_days}
		}else if($('#id_repeats').val()=='2'){
			if($('.repeat_on:checked').val()=='M'){
				var rept_by_sd=$('#id_start_date').val();
				var rept_by_sd_splt = rept_by_sd.split('/')
				var endnewdate = new Date(rept_by_sd_splt[2],rept_by_sd_splt[0]-1,rept_by_sd_splt[1])
				var rept_by_splt_cnvrtd = dateFormat(endnewdate, "d");	
				summary+=' on day '+rept_by_splt_cnvrtd
			}else{
				var rept_by_sd=$('#id_start_date').val();
				var rept_by_sd_splt = rept_by_sd.split('/')
				var endnewdate = new Date(rept_by_sd_splt[2],rept_by_sd_splt[0]-1,rept_by_sd_splt[1])
				var wkd = weekAndDay(endnewdate);
				summary+=' on the '+wkd
			}
		}else if($('#id_repeats').val()=='3'){
			var rept_by_yr=$('#id_start_date').val();
			var rept_by_yr_splt = rept_by_yr.split('/')
			var endnewyr = new Date(rept_by_yr_splt[2],rept_by_yr_splt[0]-1,rept_by_yr_splt[1])
			var new_mnth_dte = dateFormat(endnewyr, "mmmm d");
			summary+=' on '+new_mnth_dte	
		}else{}
		if($('.chk_ends:checked').val()=='AFT'){
			summary+=', for '+$('#id_ends_occurences').val()+' occurence'
		}else{
			var enton_date=$('#id_ends_on_date').val();
			var enton_mydates = enton_date.split('/')
			var endnewdate = new Date(enton_mydates[2],enton_mydates[0]-1,enton_mydates[1])
			var new_date = dateFormat(endnewdate, "mmmm d yyyy");	
			summary+=', until '+new_date
		}
  }else{
		var num = $('#id_repeat_every').val();
		summary = 'Repeat every ' + num;
		if($('#id_repeats').val()=='0'){
			summary+= ' Days'
		}
		else if($('#id_repeats').val()=='1'){
			$('.repeat_chkbx:checked').each(function(){
				chkk_days.push($(this).val());
			});
			if(chkk_days.length=='7'){
				summary+=' weeks on all days '
			}else if(chkk_days.length=='0'){
				summary+=' weeks on '+blank_days();
			}else{summary+=' weeks on '+chkk_days}
		}
		else if($('#id_repeats').val()=='2'){
			summary+=' months'
			if($('.repeat_on:checked').val()=='M'){
				var rept_by_sd=$('#id_start_date').val();
				var rept_by_sd_splt = rept_by_sd.split('/')
				var endnewdate = new Date(rept_by_sd_splt[2],rept_by_sd_splt[0]-1,rept_by_sd_splt[1])
				var rept_by_splt_cnvrtd = dateFormat(endnewdate, "d");	
				summary+=' on day '+rept_by_splt_cnvrtd
			}else{
				var rept_by_sd=$('#id_start_date').val();
				var rept_by_sd_splt = rept_by_sd.split('/')
				var endnewdate = new Date(rept_by_sd_splt[2],rept_by_sd_splt[0]-1,rept_by_sd_splt[1])
				var wkd = weekAndDay(endnewdate);
				summary+=' on the '+wkd
			}
		}else{
			summary+=' years'
			var rept_by_yr=$('#id_start_date').val();
			var rept_by_yr_splt = rept_by_yr.split('/')
			var endnewyr = new Date(rept_by_yr_splt[2],rept_by_yr_splt[0]-1,rept_by_yr_splt[1])
			var new_mnth_dte = dateFormat(endnewyr, "mmmm d");
			summary+=' on '+new_mnth_dte	
		}
		if($('.chk_ends:checked').val()=='AFT'){
			summary+=', for '+$('#id_ends_occurences').val()+' occurence'
		}else{
			var enton_date=$('#id_ends_on_date').val();
			var enton_mydates = enton_date.split('/')
			var endnewdate = new Date(enton_mydates[2],enton_mydates[0]-1,enton_mydates[1])
			var new_date = dateFormat(endnewdate, "mmmm d yyyy");	
			summary+=', until '+new_date
		}
	}
	$('#id_display_summary').text(summary);
}	
function repeat_days(){
	var start_date=$('#id_start_date').val();
	var mydates = start_date.split('/')
	var mynewdate = new Date(mydates[2],mydates[0]-1,mydates[1])
	each_day=mynewdate.getDay()
	try{$('#id_'+each_day+'.repeat_chkbx').prop('checked',true);}
	catch(e){}
}
function blank_days(){
	var start_date=$('#id_start_date').val();
	var mydates = start_date.split('/')
	var mynewdate = new Date(mydates[2],mydates[0]-1,mydates[1])
	each_day=mynewdate.getDay()
	return $('#id_'+each_day).val();
}
function end_default_dat(){
	if($('#id_end_date').val()!=''){
		try{$('#id_ends_on_date').val($('#id_end_date').val());}
		catch(e){}
	}else{
		var evnt_end_date=$('#id_start_date').val();
		var ent_mydates = evnt_end_date.split('/')
		var mynewdate = new Date(ent_mydates[2],ent_mydates[0]-1,ent_mydates[1])
		var toDate = new Date(new Date(mynewdate).setMonth(mynewdate.getMonth() + 1));
		var toDate_new = dateFormat(toDate, "mm/dd/yyyy");	
		try{$('#id_ends_on_date').val(toDate_new);}
		catch(e){}
	}	
}
function add_display(){
	$('.chked_ends_CHK_ON').prop('checked',true);
	$('.setwk_FR').prop('checked',true);
	$('#id_ends_occurences').val(5);
	end_default_dat();
	repeat_days();
	ends_manage();
}
function edit_display(){
	$('#id_repeats option:selected').removeAttr('selected','selected');
	$('#id_'+$('#id_repeat_store').val()+'_rp').attr('selected','selected');
	$('#id_rpt_evry_'+$('#id_repeat_every_store').val()).prop('selected',true);
	if($('#id_repeat_on_wk_store').val()!=''){
		$('#id_repeat_on_weekly').show();
		var weak_values = $('#id_repeat_on_wk_store').val().split(',');
		for(i=0;i<weak_values.length;i++){
			$('.setwk_'+weak_values[i]).prop('checked',true);
		}
	}
	if($('#id_repeat_store').val() == '2'){
		$('#id_repeat_on_monthly').show();
	}
	if($('#id_repeat_store').val() != '1'){
		repeat_days();
	}
	$('.repeat_on_monthly_cls_'+$('#id_repeat_on_mnth_store').val()).prop('checked',true);
	if($('#id_ends_store').val()!=''){
		$('.chked_ends_'+$('#id_ends_store').val()).prop('checked',true);
		$('#id_ends_occurences').val($('#id_ends_occurence_store').val());
		$('#id_ends_on_date').val($('#id_ends_on_store').val());
		ends_manage();
	}
	$('#id_display_summary').text($('#id_repeat_summary').val());
	$('.bM-sLt').bUiSlCt('refresh');
}
</script>
<script type="text/javascript">
$(document).ready(function(){
	//var scripts = [ "{{STATIC_URL}}js/date.format.js"];
  	//preuploadjs(scripts,initapp);
});
</script>
<div class="row-fluid">
	<form class="form-horizontal uSr-aCnT">
		<input id='id_start_date_converted' type="hidden" class='tags' name="start_date_converted" value="" >
        <div class="control-group">
            <label class="control-label" >Repeat every</label>
            <div class="controls">
                <select class="span4 iSp4 bM-sLt" id="id_repeat_every" onchange="create_summery(true);">
                    <option value="1" id="id_rpt_evry_1">1</option>
                    <option value="2" id="id_rpt_evry_2">2</option>
                    <option value="3" id="id_rpt_evry_3">3</option>
                    <option value="4" id="id_rpt_evry_4">4</option>
                    <option value="5" id="id_rpt_evry_5">5</option>
                    <option value="6" id="id_rpt_evry_6">6</option>
                    <option value="7" id="id_rpt_evry_7">7</option>
                    <option value="8" id="id_rpt_evry_8">8</option>
                    <option value="9" id="id_rpt_evry_9">9</option>
                    <option value="10" id="id_rpt_evry_10">10</option>
                    <option value="11" id="id_rpt_evry_11">11</option>
                    <option value="12" id="id_rpt_evry_12">12</option>
                    <option value="13" id="id_rpt_evry_13">13</option>
                    <option value="14" id="id_rpt_evry_14">14</option>
                    <option value="15" id="id_rpt_evry_15">15</option>
                    <option value="16" id="id_rpt_evry_16">16</option>
                    <option value="17" id="id_rpt_evry_17">17</option>
                    <option value="18" id="id_rpt_evry_18">18</option>
                    <option value="19" id="id_rpt_evry_19">19</option>
                    <option value="20" id="id_rpt_evry_20">20</option>
                    <option value="21" id="id_rpt_evry_21">21</option>
                    <option value="22" id="id_rpt_evry_22">22</option>
                    <option value="23" id="id_rpt_evry_23">23</option>
                    <option value="24" id="id_rpt_evry_24">24</option>
                    <option value="25" id="id_rpt_evry_25">25</option>
                    <option value="26" id="id_rpt_evry_26">26</option>
                    <option value="27" id="id_rpt_evry_27">27</option>
                    <option value="28" id="id_rpt_evry_28">28</option>
                    <option value="29" id="id_rpt_evry_29">29</option>
                    <option value="30" id="id_rpt_evry_30">30</option>
                </select>
                <select class="span4 iSp4 bM-sLt" id="id_repeats">
                    <option value="0" id="id_0_rp" {% if repeat_option == '0' %} selected="selected"{% endif %}>Day</option>
                    <option value="1" id="id_1_rp" {% if repeat_option == '1' %} selected="selected"{% endif %}>Week</option>
                    <option value="2" id="id_2_rp" {% if repeat_option == '2' %} selected="selected"{% endif %}>Month</option>
                    <option value="3" id="id_3_rp" {% if repeat_option == '3' %} selected="selected"{% endif %}>Year</option>
                </select>
            </div>
        </div>
        <div class="control-group mRb10" id="id_repeat_on_weekly" style="display:none;">
        	<label class="control-label" >Repeats On</label></label>
            <div class="controls">
            	<div class="span4 iSpa pDt8 mRb5">
                    <label class="checkbox inline">
                        <input type="checkbox" class="repeat_chkbx setwk_MO" onclick="create_summery(true);" name="MO" id="id_1" value="Monday">M
                    </label>
                    <label class="checkbox inline">
                        <input type="checkbox" class="repeat_chkbx setwk_TU" onclick="create_summery(true);" name="TU" id="id_2" value="Tuesday">T
                    </label>
                    <label class="checkbox inline">
                        <input type="checkbox" class="repeat_chkbx setwk_WE" onclick="create_summery(true);" name="WE" id="id_3" value="Wednesday">W
                    </label>
                    <label class="checkbox inline">
                        <input type="checkbox" class="repeat_chkbx setwk_TH" onclick="create_summery(true);" name="TH" id="id_4" value="Thursday">T
                    </label>
                    <label class="checkbox inline">
                        <input type="checkbox" class="repeat_chkbx setwk_FR" onclick="create_summery(true);" name="FR" id="id_5" value="Friday">F
                    </label>
                    <label class="checkbox inline">
                        <input type="checkbox" class="repeat_chkbx setwk_SA" onclick="create_summery(true);" name="SA" id="id_6" value="Saturday">S
                    </label>
                    <label class="checkbox inline">
                        <input type="checkbox" class="repeat_chkbx setwk_SU" onclick="create_summery(true);" name="SU" id="id_0" value="Sunday">S
                    </label>
                </div>
            </div>
        </div>
		<div class="control-group mRb10" id="id_repeat_on_monthly" style="display: none;">
            <label class="control-label" >Repeats On</label></label>
			<div class="controls">
            	<div class="span4 iSpa pDt8 mRb5">
					<label class="radio inline">
						<input type="radio" class="repeat_on repeat_on_monthly_cls_M" value="M" name="repeat_on_monthly" onclick="create_summery(true);" {% if repeated_value == 'M' %}checked="checked" {% endif %}>day of the month
					</label>
					<label class="radio inline">
                        <input type="radio"  class="repeat_on repeat_on_monthly_cls_W" value="W" name="repeat_on_monthly" onclick="create_summery(true);" {% if repeated_value == 'W' %}checked="checked" {% endif %}>day of the week
					</label>
				</div>
			</div>
        </div> 
        <div class="control-group mRb10">
            <div class="controls">
            	<div class="span4 iSpa pDt8 mRb5">
                    <label class="radio inline">
                    <input type="radio" class="chk_ends chked_ends_CHK_ON" onclick="ends_manage();" value="CHK_ON" name="chk_ends">Ends on</label>
                </div>
                <div class="span3 mRl14 sP6mP mR0Mp">
                    <input id="id_ends_on_date" type="text" placeholder="">
                </div>
            </div>
        </div>
        <div class="control-group">
            <div class="controls">
            	<div class="span4 iSpa pDt8 mRb5">
                    <label class="radio inline">
                    <input type="radio" class="chk_ends chked_ends_AFT" onclick="ends_manage();" value="AFT" name="chk_ends">Ends After</label>
                </div>
                <div class="span3 sP6mP pLlTmP">
                    <input type="text" placeholder="input a number" value="10" onkeyup="create_summery(true)" id="id_ends_occurences">
                </div>
                <div class="span3 sP6mP pLlTmP pDt8 pDl10mP">Occurrences</div>
            </div>
        </div>
        <div class="control-group mRb10">
            <label class="control-label">Summary</label>
            <div class="controls">
            	<div class="iSpa pDt8" id="id_display_summary"></div>
            </div>
        </div>
    </form>	
</div>