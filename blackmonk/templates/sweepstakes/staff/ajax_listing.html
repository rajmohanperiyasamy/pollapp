{% load ds_utils %}
{% load i18n %}
{% load thumbnail %}			
<input type="hidden" value="{{status}}" name="id_status" id="id_status">
<input type="hidden" value="{{created}}" name="id_created" id="id_created">
<input type="hidden" value="{{sort}}" name="id_sort" id="id_sort">
<input type="hidden" value="{{msg}}" name="id_action_msg" id="id_action_msg">
<input type="hidden" value="{% if search %}{{search}}{% endif %}" name="id_search" id="id_search">
<input type="hidden" value="" name="id_action" id="id_action">
{% if sweepstakes %}
<ol class="data-table table-lists-container" id="ajax_content_list">
{% for sweepstake in sweepstakes %}	
	<li class="table-list" id="li_{{sweepstake.id}}">
        <div class="table-list-container check-item has-thumb110 group">
			<span class="checkbox-wrap">
				<span class="cform-checkbox-container"><input type="checkbox" value="{{sweepstake.id}}" onclick="fix_action()" status="{{sweepstake.status}}" id="id_checkbox_{{sweepstake.id}}" name="artCulture" class="check-overflow cbox check_action"><span class="cform-checkbox-element"></span></span>
			</span>
            <div class="item-media">
            	<a href="{% url 'staff_preview_sweepstakes' sweepstake.id %}" class="inline-block">
                    <span class="item-thumb thumb-110">
                        <span class="thumb-in">
                            <span class="thumb"><img src="{% if sweepstake.get_cover_image %}{% thumbnail sweepstake.get_cover_image 110x0 %}{% else %}{{sweepstake.get_default_image}}{%endif%}" alt="{{sweepstake.title}}" class="inline-block"><span class="inline-block h100"></span></span>
                        </span>
                    </span>
				</a>                                                            
            </div> 
			<div class="item-info relative-block">
                <h3 class="title"><a href="{% url 'staff_preview_sweepstakes' sweepstake.id %}">{{sweepstake.title}}({{sweepstake.get_participant_count}})</a></h3>
                <p class="ltxt80">{% trans 'By' %} <a href="{% url 'user_profile' sweepstake.created_by.profile_slug %}">{{sweepstake.created_by.display_name}}</a> <span class="divider12">|</span>{% trans "On" %} {{sweepstake.created_on|date:"M d, Y"}} <span class="divider12">|</span>{% trans "Participant" %}({{sweepstake.get_participant_count}})</p>
				<p class="ltxt80">{% trans "Contest ID" %} {{sweepstake.contest_id}}<span class="divider12">|</span>{% trans "SweepStake ID" %} {{sweepstake.sweepstakes_id}}</p>
				<p class="ltxt80">{% trans "Start Date" %} {{sweepstake.start_date|date:"M d, Y"}}<span class="divider12">|</span>{% trans "End Date" %} {% if sweepstake.duration != 'N' %}{{sweepstake.current_end_date|date:"M d, Y"}}{% if sweepstake.current_end_date == sweepstake.end_date %} {% if sweepstake.duration == 'M' %}{% trans "Monthly" %} -{% endif %}{% if sweepstake.duration == 'W' %}{% trans "Weekly" %} -{% endif %} {% trans "Last Draw" %}{% else %} <span class="divider12">|</span> {{sweepstake.get_duration_text}}{% endif %}{% else %}{{sweepstake.end_date|date:"M d, Y"}}{% endif %}</p>
                <div class="item-status {% if forloop.counter == 1 %}tip tip7{% endif %} {% if not perms.sweepstakes.publish_sweepstakes %}no-options{% endif %} dev_hide_list_status" onclick="display_change_status({{sweepstake.id}},$('#id_estatus_{{sweepstake.id}}').attr('name'));">
                	<span class="status-inside inline-block" id="id_span_chge_sts_{{sweepstake.id}}">
					<span title="{% get_status_class sweepstake.status %}" name="{{sweepstake.status}}" id="id_estatus_{{sweepstake.id}}" class="inline-block tttxt status-idty icon-{% get_status_class sweepstake.status %}"></span>	 
                    {% if not perms.sweepstakes.publish_sweepstakes %}</span>{% endif %}
					{% if perms.sweepstakes.publish_sweepstakes %}
						<span class="arrow"></span></span>
						<ul class="dropdown-list" id="change_status_id_{{sweepstake.id}}">
							<li><strong>{% trans 'Update status to...' %}</strong></li>
							<ul id="id_dis_status_{{sweepstake.id}}">
	                       	</ul>
	                    </ul>
					{% endif %}
                </div>                                                        
            </div>
			{% if perms.sweepstakes.promote_sweepstakes or perms.sweepstakes.change_sweepstakes or perms.sweepstakes.delete_sweepstakes %}
            	<div class="action-buttons {% if forloop.counter == 1 %}tip tip8{% endif %}">
                	<div class="relative-block">
	                    <span class="item-manage inline-block dev_hide_list_settings" id="id_span_settings_{{sweepstake.id}}" onclick="display_settings({{sweepstake.id}});"><span class="action-icon icon-manage"></span></span>
	                    <ul class="dropdown-list dev_settingsdrpdwn" id="settings_id_{{sweepstake.id}}" style="display:none">
							{% if perms.sweepstakes.change_sweepstakes %}
	                        	<li><a href="{% url 'staff_edit_sweepstakes' sweepstake.id %}">{% trans 'Edit' %}</a></li>
								<li><a title="{% trans 'Title / Description (SEO)' %}" href="{% url 'staff_seo_sweepstakes' sweepstake.id %}" class="bm-add-gadget light_box">{% trans 'Update SEO' %}</a></li>
								<li><span class="line-break"></span></li>
							{% endif %}
							{% if perms.sweepstakes.delete_sweepstakes %}
                    	    	<li><a onclick="if(confirm(gettext('Are you sure you want to delete the selected sweepstake?'))){filter_action({{sweepstake.id}},'DEL');return false;}" href="javascript:void(0)">{% trans 'Delete' %}</a></li>
							{% endif %}
                    	</ul>
					</div>                                                              	                                                         
            	</div>
			{% endif %}
    	</div>
	</li> 
{% endfor %}
</ol>
<div id="pagenation">
	{% include 'common/pagination_ajax.html'%}
</div>  
{% else %}
	<div class="no-data"> <p>{% trans 'Sorry , No sweepstakes found !' %}</p></div>
{% endif %}
<script>
function status_function(id,status){
	$('#id_dis_status_'+id).html('');
	if(status=='P'){
		ahtml = '<li><a onclick="save_status('+id+',\'B\');" href="javascript:void(0);">{% trans 'Blocked' %}</a></li>'
		$('#id_dis_status_'+id).append(ahtml);
	}
	else if(status=='N'){
		ahtml = '<li><a onclick="save_status('+id+',\'P\');" href="javascript:void(0);" >{% trans 'Publish' %}</a></li>'
		ahtml+= '<li><a onclick="save_status('+id+',\'R\');" href="javascript:void(0);" >{% trans 'Reject' %}</a></li>'
		$('#id_dis_status_'+id).append(ahtml);
	}
	else if(status=='B'){
		ahtml = '<li><a onclick="save_status('+id+',\'P\');" href="javascript:void(0);" >{% trans 'Publish' %}</a></li>'
		$('#id_dis_status_'+id).append(ahtml);
	}
	else if(status=='R'){
		ahtml = '<li><a onclick="save_status('+id+',\'P\');" href="javascript:void(0);" >{% trans 'Publish' %}</a></li>'
		$('#id_dis_status_'+id).append(ahtml);
	}
	else if(status=='D'){
		ahtml = '<li><a onclick="save_status('+id+',\'P\');" href="javascript:void(0);" >{% trans 'Publish' %}</a></li>'
		$('#id_dis_status_'+id).append(ahtml);
	}
	else{
		$('#change_status_id_'+id).hide();
		$('#id_span_chge_sts_'+id).removeClass('active')
		return false;
	}
}
function save_status(id,status){
	$('#id_estatus_'+id).addClass('loading');
	var DataString="id="+id+"&status="+status;
	$.ajax({
		type: "GET",
		url: "{% url 'staff_change_status_sweepstakes' %}",
		data: DataString,
		success: function(data){
			if(data!=0){
				$('#id_estatus_'+id).removeClass('loading');
				$('#id_estatus_'+id).replaceWith(data);
				$('#change_status_id_'+id).hide();
				$('#id_span_chge_sts_'+id).removeClass('active')
				$('#id_checkbox_'+id).attr('status',status);
				show_count('all');
			}else{
				alert(gettext('Oops!!! Not able to process your request.'));
			}
		}
	});
}
</script>
