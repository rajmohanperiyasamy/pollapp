{% extends "staff_base.html" %}
{% load tabs %}
{% load i18n %}
{% load upload_tags %}
{% load thumbnail %}
{% block navigation %}
	{% activetab "selmodule" "sweepstakes" %}
	{{ block.super }}
{% endblock %}
{% block pagetitle %}{% trans 'Preview - Sweepstakes' %} {% endblock %}
{% block head %}
<link type="text/css" rel="stylesheet" href="{{STATIC_URL}}css/bm.jfp.ui.css">
{% endblock %}
{% block content %}
<div id="staff-platform" class="group">
	<div class="header-bar has-preview-head">
        <a href="{% url 'staff_manage_sweepstakes' %}"><h2 style="cursor:pointer;"><span class="go_back"></span>Sweepstakes</h2></a>
        <section class="sub-header-bar">
            <div class="preview-head">
                <div class="item-title">
                    <h1>{{ sweepstakes }}</h1>
                    <p class="ltxt80">By <a href="#">{{sweepstakes.created_by.profile.get_full_name}}</a> <span class="divider12">|</span> {{sweepstakes.created_on|date:"M d, Y"}}</p>
				</div>                                   
                <ul class="status-tabs group">
                	 <li>{{sweepstakes.get_participant_count}}<span class="meta">{% trans 'participants' %}</span></li>
                </ul>                                
            </div>                                
        </section>                          
    </div>
    <div id="core-wraper" class="group">
        <div class="staff-main">
            <div class="page-wrap">
                <div id="article-preview" class="preview-center group">
                    <div class="preview-items">
                        <div class="preview-group">  
                        	<div class="preview-items-head">
                        		{% if perms.sweepstakes.change_sweepstakes %}
                                	<div class="right-item"><div class="cform-button"><a href="{% url 'staff_edit_sweepstakes' sweepstakes.id %}"><span>{% trans 'Edit' %}</span></a></div></div>
								{% endif %}
                            	<h3 style="vertical-align:top">{% trans 'Sweepstakes Details' %}</h3>
                            </div>            
                            <div class="preview-item title">
                                <div class="label"><h4>{% trans 'Name' %}</h4></div>
                                <div class="value">{{ sweepstakes }}</div>
                            </div> 
							<div class="preview-item title">
                                <div class="label"><h4>{% trans 'Sweepstake ID' %}</h4></div>
                                <div class="value">{{ sweepstakes.sweepstakes_id }}</div>
                            </div> 
							<div class="preview-item title">
                                <div class="label"><h4>{% trans 'Contest ID' %}</h4></div>
                                <div class="value">{{ sweepstakes.contest_id }}</div>
                            </div>
							<div class="preview-item title">
                                <div class="label"><h4>{% trans 'Start Date' %}</h4></div>
                                <div class="value">{{ sweepstakes.start_date|date:"M d Y" }}</div>
                            </div> 
							<div class="preview-item title">
                                <div class="label"><h4>{% trans 'End Date' %}</h4></div>
                                <div class="value">{{ sweepstakes.end_date|date:"M d Y" }}</div>
                            </div> 
							<div class="preview-item title">
                                <div class="label"><h4>{% trans 'No of Winners' %}</h4></div>
                                <div class="value">{{ sweepstakes.total_winners }}</div>
                            </div> 
							{% if sweepstakes.get_duration_text %}
							<div class="preview-item title">
                                <div class="label"><h4>{% trans 'Recurring' %}</h4></div>
                                <div class="value">{{ sweepstakes.get_duration_text }}</div>
                            </div> 
							<div class="preview-item title">
                                <div class="label"><h4>{% trans 'Next Winner On' %}</h4></div>
                                <div class="value">{{ sweepstakes.current_end_date|date:"M d Y" }}</div>
                            </div>   
							{% endif %}
							{% if available_apps %}
							<div class="preview-item title">
                                <div class="label"><h4>{% trans 'Entries/Points Detail' %}</h4></div>
								<div class="value">&nbsp;</div>
								{% for app in available_apps %}
									{% if app.point > 0 %}
	                                	<div class="value" style="width:200px;float:left;">{{app.label}}</div>
										<div class="value" style="width:70px;margin-left:5px;float:left;">{{app.point}} {% trans 'Entries' %}</div>
									{% endif %}
								{% endfor %}
							</div> 
							{% endif %}
							{% if sweepstakes.image %}
							<div class="preview-item medias">
                                <div class="label"><h4>{% trans 'Logo' %}</h4></div>
                                <div class="value">
                                    <div class="item-photos">
                                        <ul>
                                            <li class="inline-block">
                                                <div class="photos-preview"><img src="{% thumbnail sweepstakes.image.image 110x0 %}"><a class="icon-view preview-item" title="{% trans 'Large preview' %}" href="#"></a></div>
                                            </li>
                                        </ul>
                                    </div>
								</div>
                            </div>
							{% endif %}
							<div class="preview-item title">
                                <div class="label"><h4>{% trans 'Description' %}</h4></div>
                                <div class="value">{% autoescape off %}{{ sweepstakes.description }}{% endautoescape %}</div>
                            </div>
							
							<div class="preview-items-head" id="add_head" style="{% if not offers %}display:none;{% endif %}">
                            <div class="right-item"><div class="cform-button prime bm-add-product" href="{% url 'staff_sweepstakes_offer_add' sweepstakes.id %}" title="{% trans 'Add New offer' %}"><span>{% trans 'Add new offer' %}</span></div></div>
                            <h3>{% trans 'Offers' %}</h3>
                        </div>
						<ol class="data-table-inset" id="offer_list">
							<li class="table-list-row" style="text-align:center;padding:10px;display:none;" id="ajax_content_loading_list">
								<img src="{{STATIC_URL}}ui/images/global/loading-s.gif">
							</li>
							{% if offers %}
							{% for offer in offers %}
                        	<li class="table-list-row manage-items has-thumb90" id="li_{{offer.id}}">
                                <div class="table-list-row-inner group">
                                    <div class="item-media">
                                        <span class="item-thumb thumb-90">
                                            <span class="thumb-in">
												<span class="thumb"><img src="{% if offer.image.image %}{% thumbnail offer.image.image 110x0 %}{% else %}{{STATIC_URL}}themes/green/images/global/nophoto_90.jpg{% endif %}" alt="{{offer.title}}" class="inline-block"><span class="inline-block h100"></span></span>
                                            </span>
                                        </span>
                                    </div>   
									<div class="item-detail">
                                    	<h4>{{offer.title}}</h4>
										<p>{% if offer.description %}{% autoescape off %}{{offer.description}}{% endautoescape %}{% endif %}</p>
                                    </div>
									{% if perms.sweepstakes.change_sweepstakes or perms.sweepstakes.add_sweepstakes %}
                                   	<div class="action-buttons">
                                        <div>
                                            <a href="{% url 'staff_sweepstakes_offer_update' sweepstakes.id offer.id %}" class="tttxt-w bm-add-product" original-title="{% trans 'Edit offer' %} {{offer}}"><span class="action-icon icon-edit"></span></a>
                                            <a href="javascript:delete_product({{offer.id}})" class="tttxt-w" original-title="Delete"><span class="action-icon icon-delete"></span></a>
										</div>                                                            
                                  	</div>
									{% endif %}
                                </div>
							</li>
							{% endfor %}
							{% endif %}
                        </ol> <!-- end table --> 
                        <div class="no-data" style="padding-top:0px;{% if offers %}display:none;{% endif %}">
                        	<p>{% trans 'No offers found for this sweepstakes.Add Now!' %}.</p>
                            {% if perms.sweepstakes.change_sweepstakes or perms.sweepstakes.add_sweepstakes %}
								<div class="button-insde">
	                            	<span class="btn-txt-inline-prime bm-add-product" href="{% url 'staff_sweepstakes_offer_add' sweepstakes.id %}" title="{% trans 'Add new offer' %}"><span class="btn-txt">{% trans 'Add new offer' %}</span></span>
	                            </div>
							{% endif %}
                        </div>
							 
                        </div>   
                    </div>                                            
                </div><!-- end table -->
            </div> <!-- end page wrap -->
        </div> <!-- end main-col -->
        <div id="aside" class="side-bar">
        	<div class="preview-aside-meta group">
                <ul class="side-navigation">
                </ul>
			</div>
			{#% include 'sweepstakes/staff/faq.html' %#}
        </div>
    </div>                                                    
</div>
{% endblock %}
{% block footer_include %}
{% upload_js %}
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.jfp.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.fup.appln.js"></script>
<script src="{{ STATIC_URL }}js/ckeditor/ckeditor.js" type="text/javascript"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}ui/js/listing_settings.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/sweepstakes/staff.js"></script>
<script type="text/javascript">
function save_product(){
	var flag = $('#mform').validate().form();
	if(flag==true){
		var dataString='&title='+encodeURIComponent($('#id_title').val());
		dataString+='&description='+encodeURIComponent(CKEDITOR.instances.id_description.getData());
		dataString+='&url='+encodeURIComponent($('#id_url').val());
		dataString+='&image_id='+$('.new_pic_uploaded').val();
		$('#ajax_content_product').hide();
		$('#ajax_content_loading_product').show();
		$.ajax({
		type: "post",
		url: $("#mform").attr("action"),
		data: dataString,
		dataType:'json',
		success: function(responseData){
				try{$('.no-data').hide();$('#add_head').show();}
				catch(e){}
				$('#ajax_content_loading_product').html(responseData.msg);
				if(responseData.status){
					$("#offer_id").val(responseData.id);
					if(imageIsThere){$(".start").trigger('click');}
					$('#ajax_content_loading_list').show();
					setTimeout(function(){
						load_append_html(responseData.id)
					},2000);
					show_msg(responseData.msg,responseData.mtype);
					$.colorbox.close();
				}else{
					$('div#ajax_content_product_outer').replaceWith(responseData.html);
					$.colorbox.resize();
				}
			}
		});
	}
}
function load_append_html(id){
	$.ajax({
		type: "POST",
		url:'{% url 'staff_sweepstakes_offer_load_html' %}',
		data:'id='+id,
		dataType:'JSON',
		success: function(responseData){
			try{$('#li_'+id).remove();}
			catch(e){}
			$('#ajax_content_loading_list').hide();
			$(responseData.html).insertAfter("#ajax_content_loading_list")
			$(".bm-add-product").colorbox({width:"700",height:"560",initialWidth: "700", top:"5%", initialHeight: "200",title:function(){return getLBTitle($(this));}});
		}
	});
}
function delete_product(id){
	if(confirm(gettext('Are you sure want to delete this product ?'))){
		$.ajax({
			type: "POST",
			url:'{% url 'staff_sweepstakes_offer_delete' %}',
			data:'id='+id,
			dataType:'JSON',
			success: function(responseData){
				show_msg(responseData.msg,responseData.mtype);
				if(responseData.status==1){
					$('#li_'+id).remove();
					if($('#product_list').find('li').length==1){
						$('.no-data').show();
						$('#add_head').hide();
					}
				}
			}
		});
	}
}
function showhttp(){$('#id_url').val('http://');}
function hidehttp(){
	if($('#id_url').val()=='http://'){$('#id_url').val('');}
}
</script>
{% endblock %}
