{% load i18n %}	
{% load thumbnail %}	
<!-- script type="text/javascript" src="{{STATIC_URL}}ui/js/application.js"></script -->
<input type="hidden" value="{{status}}" name="id_status" id="id_status">
<input type="hidden" value="{{listing_type}}" name="id_listing_type" id="id_listing_type">
<input type="hidden" value="{{created}}" name="id_created" id="id_created">
<input type="hidden" value="{{sort}}" name="id_sort" id="id_sort">
<input type="hidden" value="" name="id_action" id="id_action">
<input type="hidden" value="{% if search %}{{search}}{% endif %}" name="id_search" id="id_search">
{% if advice %} 
	<ol class="data-table table-lists-container" id="ajax_content_list">
		{% for atr in advice %}	
			<li class="table-list" id="li_{{atr.id}}">
				<div class="table-list-container check-item group">
			 		{% if atr.is_featured %}
						<span class="list-type featured-item"><a class="tttxt" title="{% trans 'Item listed as featured' %}" href="javascript:void(0)">{% trans 'Featured' %}</a></span>
					{% endif %}
				 	<span class="checkbox-wrap">
						<span class="cform-checkbox-container"><input type="checkbox" onclick="fix_action()" status="{{atr.status}}" value="{{atr.id}}" id="id_checkbox_{{atr.id}}" name="artCulture" class="check-overflow cbox check_action"><span class="cform-checkbox-element"></span></span>
					</span>
					<div class="item-info relative-block">
						<h3 class="title"><a href="{% url 'staff_preview_advice' atr.id %}">{{atr.question}}</a></h3>
						<p class="ltxt80">
							{{atr.category}}
							<span class="divider12">|</span> {% trans 'By' %} <a href="{% url 'user_profile' atr.created_by.profile_slug %}">{{atr.created_by.display_name}}</a> 
							<span class="divider12">|</span>{{atr.created_on|date:"M d, Y"}}
						</p>
						<ul class="quick-stats group">
	        	            <li class="views"><a class="tttxt" href="javascript:void(0)" title="{% trans 'Viewers' %}"><span class="inline-block icon-view-stats"></span>{{atr.viewed}}</a></li>
	            	        <li class="cmnt"><a class="tttxt"title="{% trans 'Posts(Reply)' %}" href="{% url 'staff_preview_advice' atr.id %}"><span class="inline-block icon-cmnt-stats"></span>{{atr.get_answer_count}}</a></li>
		                </ul>
						<div class="item-status {% if forloop.counter == 1 %}tip tip8{% endif %} {% if not perms.advice.publish_advice %}no-options{% endif %} dev_hide_list_status" onclick="display_change_status({{atr.id}},$('#id_estatus_{{atr.id}}').attr('name'));">
		                	<span class="status-inside inline-block" id="id_span_chge_sts_{{atr.id}}">
							<span title="{{atr.get_status|capfirst}}" name="{{atr.status}}" id="id_estatus_{{atr.id}}" class="inline-block tttxt status-idty icon-{{atr.get_status}}"></span>	 
							{% if not perms.advice.publish_advice %}</span>{% endif %}
							{% if perms.advice.publish_advice %}
								<span class="arrow"></span></span>
								<ul class="dropdown-list" id="change_status_id_{{atr.id}}">
									<li><strong>{% trans 'Update status to...' %}</strong></li>
									<ul id="id_dis_status_{{atr.id}}"></ul>
			                    </ul>
							{% endif %}
	    	            </div>
				   	</div>
					{% if perms.advice.promote_advice or perms.advice.change_advice or perms.advice.delete_advice%}
					<div class="action-buttons {% if forloop.counter == 1 %}tip tip9{% endif %}">
	                	<div class="relative-block">
	                    	<span class="item-manage inline-block dev_hide_list_settings" id="id_span_settings_{{atr.id}}" onclick="display_settings({{atr.id}});"><span class="action-icon icon-manage"></span></span>
		                    <ul class="dropdown-list dev_settingsdrpdwn" id="settings_id_{{atr.id}}" style="display:none">
								{% if perms.advice.change_advice %}
									<li><a href="{% url 'staff_edit_advice' atr.id %}">{% trans 'Edit' %}</a></li><li><span class="line-break"></span></li>
								{% endif %}
									<li><a title="{% trans 'Community Logs' %}" class="bm-add-gadget light_box" href ="{% url 'common_log' %}?obj_id={{ atr.id }}&type=community">Audit Logs</a></li>
								{% if perms.advice.delete_advice %}
		            	        	<li><a onclick="if(confirm(gettext('Are you sure you want to delete the advice?'))){filter_action({{atr.id}},'DEL');return false;}" href="javascript:void(0)">{% trans 'Delete' %}</a></li>
								{% endif %}
	                    	</ul>
						</div>                                                              	                                                         
	            	</div>
					{% endif %}
				</div>
			</li>
		{% endfor %}
	</ol>
	<div id="pagenation">
		{% include 'common/pagination_ajax.html'%}  
	</div>
	<script type="text/javascript">
		function status_function(id,status){
			$('#id_dis_status_'+id).html('');
			if(status=='P'){
				ahtml = '<li><a onclick="save_status('+id+',\'B\');" href="javascript:void(0);">{% trans 'Blocked' %}</a></li>'
				$('#id_dis_status_'+id).append(ahtml);
			}
			else if(status=='B'){
				ahtml = '<li><a onclick="save_status('+id+',\'P\');" href="javascript:void(0);" >{% trans 'Publish' %}</a></li>'
				$('#id_dis_status_'+id).append(ahtml);
			}
			else if(status=='N'){
				ahtml = '<li><a onclick="save_status('+id+',\'P\');" href="javascript:void(0);" >{% trans 'Publish' %}</a></li>'
				$('#id_dis_status_'+id).append(ahtml);
			}
			else{
				$('#change_status_id_'+id).hide();
				$('#id_span_chge_sts_'+id).removeClass('active')
				return false;
			}
		}
		function save_status(id,status){
			$('#id_estatus_'+id).addClass('loading');
			var DataString="id="+id+"&status="+status;
			$.ajax({
				type: "GET",
				url: "{% url 'staff_change_status_advice' %}",
				data: DataString,
				success: function(data){
					if(data!=0){
						$('#id_estatus_'+id).removeClass('loading');
						$('#id_estatus_'+id).replaceWith(data);
						$('#change_status_id_'+id).hide();
						$('#id_span_chge_sts_'+id).removeClass('active')
						$('#id_checkbox_'+id).attr('status',status);
						show_count('all');
					}else{
						$('#change_status_id_'+id).hide();
						$('#id_span_chge_sts_'+id).removeClass('active')
						$('#id_estatus_'+id).removeClass('loading');
						alert(gettext('Oops!!! Not able to process your request.'));
					}
				}
			});
		}
	</script>
{% else %}
	<div class="no-data"><p>{% trans 'Sorry , No Threads found !' %}</p></div> 
{% endif %}   
