{% extends base %}
{% load tabs %}
{% load i18n %}
{% load thumbnail truncate_filter %}
{% load ds_utils %}
{% block pagetitle %}{% seo_format_tag module='Advice' title=advice code='DT' category=category.name as seo_meta_title %}{{seo_meta_title}}{% endblock %}
{% block meta %}
    <meta name="description" content="{{ advice }} | {{ advice.category.seo_description }}" />
{% endblock %}
{% block head %}
    <script src="{{STATIC_URL}}themes/js/bootstrap-collapse.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/qna/qna.js"></script>
    <script>
        var ajax_login_url = '{% url 'ajax_signin' %}';
        var ajax_follow_topic_url = '{% url 'advice_add_subscribe' advice.id %}';
        var user_login = false;
        {% if user.is_authenticated %}
            var user_login = true;
        {% endif %}
    </script>
{% endblock %}
{% block navigation %}
    {% activetab "topnav" "advice" %}
    {{ block.super }}
{% endblock %}
{% block content %}
    <div class="container-fluid">
        {% include 'default/advice/part-search.html' %}
        <div class="row-fluid">
            <div class="main span8 mRb0mX769">
                <div class="row-fluid">
                    <div class="span3 sP12mX767">
                        {% include 'default/advice/section-categories.html' %}
                    </div> <!-- /.span3 -->
                    <div class="span9 sP12mX767">
                        <input type="hidden" id="id_qna_cmnt_obj" value="">
                        <div class="pD20">
                            {% include 'default/advice/advice-add-form.html' %}
                            <div class="cMnT bBl-tP mRb0">
                                <div class="cMnT-iN">
                                    <div class="vCrD cLrFx pD15">
                                        <span class="bBl-aRw">
                                            <span class="aRw a1"></span>
                                            <span class="aRw a2"></span>
                                        </span>
                                        <a href="{% url 'user_profile' advice.created_by.profile_slug %}" class="pLlT bLk aVtR-36"><img class="aVtR" src="{% if advice.created_by.image %}{% thumbnail advice.created_by.image 36x36 crop %}{% else %}{{STATIC_URL}}themes/img/cmnts-default-avatar.jpg{% endif %}"></a>
                                        <div class="cLr-lT pD10 cLr-gRy fS12">
                                            <span class="fW-bLd"><a href="#" class="cLr-dRk">{{advice.created_by.display_name}}</a></span> {% trans 'asked' %}<span class="sPrTr cLr-lTbLu">{{advice.category}}</span><span class="sPrTr" title="{{advice.created_on|date:'l, F d Y f A'}}">{{advice.created_on|timesince|time_up_to:','}} {% trans 'ago' %}</span>
                                            <div class="pStN-rT mRt4" id="id_folllow_topic_div"><a href="javascript:void(0);" onclick="check_login('{{advice.id}}','follow');" id="" class="btn btn-small btn-success">{% trans 'Follow Thread' %}</a></div>
                                        </div>
                                    </div>
                                    <div class="cMnT-bDy bM-bX pD20 rLvE">
                                        <div class="cMnT-bDy-iN">
                                            <header class="cMnT-hD">
                                                <h4 class="mRt0 fW-bLd w95P"><span title="{{advice.question}}" class="cLr-bLk">{{advice.question}}</span></h4>
                                            </header>
                                            {% if advice.moredetails %}
                                            <div class="cLr-dRk fS85P">
                                                {% if advice.moredetails|length|get_digit:"-1" > 430 %} 
                                                    <p id="less_content_{{answer.id}}">{{advice.moredetails|truncate_chars:430}} <a onclick="show_toggle('{{answer.id}}')" href="javascript:void(0)" class="cLr-lTbLu">{% trans '(more)' %}</a></p>
                                                    <p id="more_content_{{answer.id}}" style="display:none;">{{advice.moredetails}} <a onclick="show_toggle('{{answer.id}}')" href="javascript:void(0)" class="cLr-lTbLu">{% trans '(less)' %}</a></p>
                                                {% else %}
                                                    <p id="all_content_{{anser.id}}">{{advice.moredetails}}</p>
                                                {% endif %}
                                            </div>
                                            {% endif %}
                                            {% with advice.Thread_subscribers.all as subscribers_list %}
                                            <footer class="cMnT-fTr cLrFx mRt20">
                                                <div class="pLlT"><span class="rPlY fS12"><a href="javascript:void(0)" data-toggle="collapse" data-target="#question-comments{{advice.id}}" data-toggle-icon="bUi-iCn-aNg-t-aLt-12"><i aria-hidden="true" class="bUi-iCn-bBlS-12 mRr5"></i><span id="id_question_cmnts_count_{{advice.id}}">{{advice.thread_comments.all.count}} {% trans 'Comments' %}</span><i aria-hidden="true" class="bUi-iCn-aNg-b-aLt-12 ib mRl5 cLr-lTgRy"></i></a></div>
                                                <div class="pLrT">
                                                    <span class="fS11 cLr-lTgRy">
                                                        <i class="icon-bar-chart fS13 mRr10"></i><span><span class="fS13 cLr-dRk">{{advice.viewed}}</span> {% trans 'Views' %}</span><span class="sPrTr"><a href="javascript:void(0)" data-toggle="collapse" data-target="#followers"><span class="fS13 cLr-dRk"></span><span id="id_subscribers_count">{{subscribers_list.count}}</span> {% trans 'Followers' %}</a></span> 
                                                    </span>
                                                </div>
                                            </footer> 
                                            {% endwith %}
                                            <div class="cMnT-oPtN btn-group">
                                                <a class="btn-link dropdown-toggle oPtN-tGl" data-toggle="dropdown" href="#"><span class="caret"></span>
                                                </a>
                                                <ul class="dropdown-menu pLrT mNi">
                                                    <li><a href="#" class="btn-mention_user">Flag for Spam</a></li>
                                                </ul>
                                            </div>
                                        </div> <!-- /.cMnT-bDy-iN -->
                                        <div id="question-comments{{advice.id}}" class="collapse">
                                            <div class="mRt20">
                                                <div class="cMnT-pSt aVtR-28 mRt0">
                                                    <div class="cMnT-pSt-iN">
                                                        <form class="cMnT-fRm mRb0 dev-aForm">
                                                            <div class="vCrD pLlT mRr10">
                                                                <a href="{% if request.user.id %}{% url 'user_profile' request.user.profile_slug %}{% else %}javascript:void(0);{% endif %}" class="aVtR-cRcL">
                                                                    <img class="aVtR" src="{% if request.user.image %}{% thumbnail request.user.image 36x36 crop %}{% else %}{{STATIC_URL}}themes/img/cmnts-default-avatar.jpg{% endif %}">
                                                                </a>
                                                            </div>
                                                            <div class="cMnT-bDy">
                                                                <div class="cMnT-bDy-iN">
                                                                    <div class="cMnT-tXtArA-wRp">
                                                                        <textarea id="comment_question_{{advice.id}}" class="cMnT-tXtArA mNi" onkeyup="update_comment_button($(this));" placeholder="{% trans 'Write a comment...' %}" name="comment" data-focus="true"></textarea>
                                                                    </div>
                                                                    {% if request.user.id %}<p class="fS11 cLr-gRy nEdS-fCs pLlT">{% trans 'Posting as' %} <a href="{% url 'user_profile' request.user.profile_slug %}" class="cLr-lTbLu">{{request.user.display_name}}</a></p>{% endif %}
                                                                    <div class="cMnT-pSt-bTn pLrT nEdS-fCs">
                                                                        <a href="javascript:void(0);" onclick="cancel_comment($(this));" class="btn btn-light fS12 fW-bLd">{% trans 'Cancel' %}</a> 
                                                                        <button type="button" class="btn fS12 fW-bLd disabled dev-postBtn" disabled="disabled" data-id="{{advice.id}}" data-type="question" data-url="{% url 'advice_save_comment' advice.id 'question' %}" onclick="check_login_qna_comments($(this));">{% trans 'Post Comment' %}</button>        
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                                <ol class="cMnTs dVdR0 aVtR-28 mRb0" id="question_comments_{{advice.id}}">
                                                {% with advice.thread_comments.all as comments %}
                                                {% if comments %}
                                                    {% for comment in comments %}
                                                        {% include 'default/advice/section-comments.html' %}
                                                    {% endfor %}
                                                {% endif %}   
                                                {% endwith %} 
                                                </ol> <!-- /.cMnTs -->
                                            </div>
                                        </div> 
                                        <div id="followers" class="collapse">
                                            {% with advice.Thread_subscribers.all as subscribers_list %}
                                                {% include 'default/advice/subscribers-list.html' %}
                                            {% endwith %}
                                        </div>
                                        {% with advice.post_answers.all as answers %}
                                        <div class="cLrFx mRt20 rLvE">
                                            <ul class="nav nav-tabs tB-cStM rEd  bRdR-tP mR0">
                                                <li class="active"><span class="fS14">{{answers.count}} {% trans 'Answers' %}</span></li>
                                            </ul>
                                        </div>
                                        <div class="cMnT-pSt aVtR-36 mRb20">
                                            <div class="cMnT-pSt-iN">
                                                <form class="cMnT-fRm mRb0 dev-aForm" action="{% url 'advice_save_answer' advice.id %}" method="post" id="ansbmt_{{advice.id}}">
                                                    <div class="vCrD pLlT mRr10">
                                                        <a href="{% if request.user.id %}{% url 'user_profile' request.user.profile_slug %}{% else %}javascript:void(0);{% endif %}">
                                                            <img class="aVtR" src="{% if request.user.image %}{% thumbnail request.user.image 36x36 crop %}{% else %}{{STATIC_URL}}themes/img/cmnts-default-avatar.jpg{% endif %}">
                                                        </a>
                                                    </div>
                                                    <div class="cMnT-bDy">
                                                        <div class="cMnT-bDy-iN">
                                                            <div class="cMnT-tXtArA-wRp">
                                                                <textarea id="" class="cMnT-tXtArA" onkeyup="update_comment_button($(this));" placeholder="{% trans 'Add your answer...' %}" name="answer" data-focus="true"></textarea>
                                                            </div>
                                                            {% if request.user.id %}<p class="fS11 cLr-gRy nEdS-fCs pLlT">{% trans 'Posting as' %} <a href="{% url 'user_profile' request.user.profile_slug %}" class="cLr-lTbLu">{{request.user.display_name}}</a></p>{% endif %}
                                                            <div class="cMnT-pSt-bTn pLrT nEdS-fCs">
                                                                <a href="javascript:void(0);" onclick="cancel_comment($(this));" class="btn btn-light fS12 fW-bLd">Cancel</a> 
                                                                <button type="button" class="btn fS12 fW-bLd dev-postBtn disabled" disabled="disabled" onclick="check_login('{{advice.id}}','addanswer');">{% trans 'Add Answer' %}</button>        
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        {% if answers %}
                                            <ol class="cMnTs aVtR-36 mRb10">
                                                {% for answer in answers %}
                                                {% with answer.post_comments.all as comments %}
                                                    <li class="cMnT">
                                                        <div class="cMnT-iN">
                                                            <div class="vCrD pLlT mRr10">
                                                                <a href="{% url 'user_profile' answer.created_by.profile_slug %}">
                                                                    <img class="aVtR" src="{% if answer.created_by.image %}{% thumbnail answer.created_by.image 36x36 crop %}{% else %}{{STATIC_URL}}themes/img/cmnts-default-avatar.jpg{% endif %}">
                                                                </a>
                                                                <span class="cMnT-vTnG cStM mRt4 bLk">
                                                                    <span>
                                                                        <a href="javascript:void(0);" onclick="answer_response('{{answer.id}}','like','{% url 'advice_answer_user_rating' %}');" class="cMnT-rTg-uP">
                                                                            <i aria-hidden="true" class="bUi-iCn-cRt-t-12"></i>
                                                                        </a>
                                                                        <a href="javascript:void(0);" onclick="answer_response('{{answer.id}}','dislike','{% url 'advice_answer_user_rating' %}');" class="cMnT-rTg-dWn">
                                                                            <i aria-hidden="true" class="bUi-iCn-cRt-b-12"></i>
                                                                        </a>
                                                                    </span>
                                                                    <span class="bLk fS11 tXt-cTr fW-bLd">
                                                                        <span class="cMnT-rTg-pStV" id="answr_updown_count_spn_{{answer.id}}" title="{{answer.rateplus}} {% trans 'up' %}, {{answer.rateminus}} {% trans 'down' %}">{{answer.rateplus|subtract:answer.rateminus}}</span>
                                                                        <!-- span class="cMnT-rTg-nGtV" title="3 down">3</span -->
                                                                    </span>
                                                                </span>
                                                            </div>
                                                            <div class="cMnT-bDy" id="answers">
                                                                <div class="cMnT-bDy-iN">
                                                                    <header class="cMnT-hD cLr-gRy fS12">
                                                                        <span class="pBlSr fS14"><a href="{% url 'user_profile' answer.created_by.profile_slug %}">{{answer.created_by.display_name}}</a></span><span class="tM fS12 sPrTr" title="{{answer.created_on|date:'l, F d Y f A'}}">{{answer.created_on|timesince|time_up_to:','}} {% trans 'ago' %}</span>
                                                                    </header>
																	<div id="answer_{{answer.id}}">
	                                                                    <div class="cLr-dRk fS85P">
	                                                                        <p>{{answer.answer}}</p>                               
	                                                                    </div>
	                                                                    <footer class="cMnT-fTr">
	                                                                        <span class="rPlY fS12"><a href="javascript:void(0)" data-toggle="collapse" data-target="#answer-comments{{answer.id}}" data-toggle-icon="bUi-iCn-aNg-t-aLt-12"><i aria-hidden="true" class="bUi-iCn-bBlS-12 mRr5"></i><span id="id_answer_cmnts_count_{{answer.id}}">{{comments.count}} {% trans 'Comments' %}</span><i aria-hidden="true" class="bUi-iCn-aNg-b-aLt-12 ib mRl5 cLr-lTgRy"></i></a></span> {% if answer.created_by == user %} <span class="rPlY sPrTr fS12"><a href="javascript:void(0)" onclick="$('#answer_{{answer.id}}').hide();$('#edit_answer_{{answer.id}}').show();">Edit</a></span>{% endif %}
	                                                                    </footer>
																	</div>	
																	<!--update-form-->
																	<form class="cMnT-fRm mRb0 dev-aForm" action="{% url 'advice_update_answer' answer.id %}" method="post" id="edit_answer_{{answer.id}}" style="display:none;" >
					                                                    <div class="cMnT-bDy">
					                                                        <div class="cMnT-bDy-iN">
					                                                            <div class="cMnT-tXtArA-wRp">
					                                                                <textarea id="" class="cMnT-tXtArA" onkeyup="update_comment_button($(this));" placeholder="{% trans 'Add your answer...' %}" name="answer" data-focus="true">{{ answer.answer }}</textarea>
					                                                            </div>
					                                                            {% if request.user.id %}<p class="fS11 cLr-gRy nEdS-fCs pLlT">{% trans 'Posting as' %} <a href="{% url 'user_profile' request.user.profile_slug %}" class="cLr-lTbLu">{{request.user.display_name}}</a></p>{% endif %}
					                                                            <div class="cMnT-pSt-bTn pLrT nEdS-fCs">
					                                                                <a href="javascript:void(0);" onclick="$('#answer_{{answer.id}}').show();$('#edit_answer_{{answer.id}}').hide();" class="btn btn-light fS12 fW-bLd">Cancel</a> 
					                                                                <button type="submit" class="btn fS12 fW-bLd dev-postBtn disabled" disabled="disabled">{% trans 'update Answer' %}</button>        
					                                                            </div>
					                                                        </div>
					                                                    </div>
					                                                </form>
																	<!--/update-form-->
                                                                    <div class="cMnT-oPtN tR0 btn-group">
                                                                        <a class="btn-link dropdown-toggle oPtN-tGl" data-toggle="dropdown" href="#"><span class="caret"></span>
                                                                        </a>
                                                                        <ul class="dropdown-menu pLrT mNi">
                                                                            <li><a href="#" class="btn-mention_user">Flag for Spam</a></li>
                                                                        </ul>
                                                                    </div>                                            
                                                                </div>
                                                                <div id="answer-comments{{answer.id}}" class="collapse">
                                                                    <div class="mRt20">
                                                                        <div class="cMnT-pSt aVtR-28 mRt0">
                                                                            <div class="cMnT-pSt-iN">
                                                                                <form class="cMnT-fRm mRb0 dev-aForm">
                                                                                    <div class="vCrD pLlT mRr10">
                                                                                        <a href="{% if request.user.id %}{% url 'user_profile' request.user.profile_slug %}{% else %}javascript:void(0);{% endif %}" class="aVtR-cRcL">
                                                                                            <img class="aVtR" src="{% if request.user.image %}{% thumbnail request.user.image 36x36 crop %}{% else %}{{STATIC_URL}}themes/img/cmnts-default-avatar.jpg{% endif %}">
                                                                                        </a>
                                                                                    </div>
                                                                                    <div class="cMnT-bDy">
                                                                                        <div class="cMnT-bDy-iN">
                                                                                            <div class="cMnT-tXtArA-wRp">
                                                                                                <textarea id="comment_answer_{{answer.id}}" class="cMnT-tXtArA mNi" onkeyup="update_comment_button($(this));" placeholder="{% trans 'Write a comment...' %}"  name="comment" data-focus="true"></textarea>
                                                                                            </div>
                                                                                            {% if request.user.id %}<p class="fS11 cLr-gRy nEdS-fCs pLlT">{% trans 'Posting as' %} <a href="{% url 'user_profile' request.user.profile_slug %}" class="cLr-lTbLu">{{request.user.display_name}}</a></p>{% endif %}
                                                                                            <div class="cMnT-pSt-bTn pLrT nEdS-fCs">
                                                                                                <a href="javascript:void(0);" onclick="cancel_comment($(this));" class="btn btn-light fS12 fW-bLd">{% trans 'Cancel' %}</a> 
                                                                                                <button type="button" class="btn fS12 fW-bLd disabled dev-postBtn" disabled="disabled" data-id="{{answer.id}}" data-type="answer" data-url="{% url 'advice_save_comment' answer.id 'answer' %}" onclick="check_login_qna_comments($(this));" >{% trans 'Post Comment' %}</button>        
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </form>
                                                                            </div>
                                                                        </div>
                                                                        <ol class="cMnTs dVdR0 aVtR-28 mRb0" id="answer_comments_{{answer.id}}">
                                                                            {% if comments %}
                                                                                {% for comment in comments %}
                                                                                    {% include 'default/advice/section-comments.html' %}
                                                                                {% endfor %}
                                                                            {% endif %}   
                                                                        </ol> <!-- /.cMnTs -->
                                                                    </div>
                                                                </div> 
                                                            </div><!-- /.cMnT-bDy -->
                                                        </div> <!-- /.cMnT-iN -->
                                                    </li> <!-- /.cMnT -->
                                                {% endwith %}
                                                {% endfor %}
                                            </ol> <!-- /.cMnTs -->
                                        {% endif %}
                                        {% endwith %}    
                                    </div><!-- /.cMnT-bDy -->
                                </div> <!-- /.cMnT-iN -->
                            </div> <!-- /.cMnT -->
                        </div>
                    </div> <!-- /.span9 \-->
                </div>
            </div>
            <aside class="sD-bR span4 oF3mN768 sP9mN768">
                <div>
                    <section class="tXt-cTr pD15 bNr-aD" id="banner_placement_right"></section> 
                </div>
                {% include 'default/advice/related-advice.html' %}
                <div>
                    <section class="sCn">
                        {% include 'default/likebox.html' %}
                    </section>
                </div>
            </aside>
    </div>

<script type='text/javascript'>
var cmnt_obj;

$(document).ready(function(){
   $.ajax({
        type:'get',
        url:'{% url 'advice_ajax_viewed' advice.id %}',
        success:function(data){},
        error:function(data){}
    });                          
});

function check_login_qna_comments(hobj){
   cmnt_obj = hobj;                                     
   if(!user_login){
        $.colorbox({width: "722",initialWidth: "722", top:"5%", initialHeight: "200", href:'{% url 'ajax_signin' %}?type=qnacmnts', onOpen:function(){$("#colorbox").addClass("no_title");} });
   }
   else{save_comment();}                                                        
}

function save_comment(){
    user_login = true;
    hobj = cmnt_obj;                      
    var id=$(hobj).attr('data-id');
    var type=$(hobj).attr('data-type');
    var url=$(hobj).attr('data-url');  
                         
    $.ajax({
        type:'post',
        url:url,
        data:'id='+id+'&comment='+encodeURIComponent($('#comment_'+type+'_'+id).val()),
        dataType:'json',
        success:function(data){
            if(data.status){
                $('#'+type+'_comments_'+id).prepend(data.html).hide().fadeIn(400); 
                $('#id_'+type+'_cmnts_count_'+id).html(data.comments_count+' Comments');
                setTimeout(function(){cancel_comment(hobj);},400);
            }else{
                alert(gettext('Oops !!! Not able to process your request.'));
            }
        }
    });
}

function like_dislike_comment(cid,url,vote){
  $.ajax({
        type:'get',
        url:url,
        data:'cid='+cid+'&vote='+vote,
        dataType:'json',
        success:function(data){
            if(data.status){
                $('#id_cmnt_like_spn_'+cid).html(data.like_count);            
                $('#id_cmnt_dslike_spn_'+cid).html(data.dislike_count);
            }else{
                alert(gettext('Oops !!! Not able to process your request.'));
            }
        }
    });                                          
}
</script>
{% endblock %}                        