{% extends base %}
{% load tabs %}
{% load i18n %}
{% load bm_movie_tags %}
{% load ds_utils %}
{% block pagetitle %}{{theater.name}} theater in {{ globalsettings.city }} | {{theater.name}} show timings | {{theater.name}} reviews{% endblock %}
{% block meta %}
<meta name="description" content="{{theater.name}} theater in {{ globalsettings.city }},{{theater.name}} showtimes, nowplaying movies in {{theater.name}},Get the complete details of {{theater.name}} at movies section in {{ globalsettings.domain }}" />
{% endblock %}
{% block navigation %}
    {% activetab "topnav" "movies" %}
    {{ block.super }}
{% endblock %}
{% block head %}
    <script src="{{STATIC_URL}}themes/js/bootstrap-collapse.js"></script>
    <script src="{{STATIC_URL}}themes/js/jquery.calendarPicker.js"></script> 
    <script src="{{STATIC_URL}}themes/js/bm-date-format.js"></script>   
    <script src="{{STATIC_URL}}themes/js/jquery.raty.js"></script>
    <script>
        $(document).ready(function(e) {
            // Calendar 
            var calendarPicker1 = $("#dTpKr").calendarPicker({
                monthNames:["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                dayNames: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
                years:0,
                reYe:true,
                months:0,
                days:4,
                showDayArrows:false,
                disablePrvDate:true,
                //useWheel:true,
                colWidth: 37,
                onSelect:function(d){
                   retreive_showtimes_by_date(d.format("yyyy-mm-dd"));         
                }
                
            });  
            calendarPicker1.changeDate(new Date("{{selected_date|date:'Y-m-d'}}"));                           
        });
        
        function retreive_showtimes_by_date(sdate){
            $('#id_showtimes_append_div').addClass('oP50');                                       
            $.ajax({
                type: "get",
                url: '{% url 'movies_ajax_theater_showtimes_by_date' %}?tid={{theater.id}}',
                data: 'sdate='+sdate,
                dataType:'json',
                success: function(data){
                        if(data.status){
                            $('#id_showtimes_append_div').empty().html(data.html);
                            $('#id_showtimes_append_div').removeClass('oP50');
                            $('html, body').animate({
                                 scrollTop: $('#dTpKr').offset().top-20
                             }, 500);            
                 }
                }
            });
        }
    </script>
{% endblock %}
{% block content %}
    <div class="container-fluid">
        <ul class="bRdCrB" itemscope itemtype="http://schema.org/WebPage">
            <li itemscope itemtype="http://www.data-vocabulary.org/Breadcrumb">
                <a itemprop="url" href="{% url 'movies_theater_showtimes' %}"><span itemprop="title">{% trans 'Theaters' %}</span></a>
                <span class="sPrTr"></span>
            </li>
            <li itemscope itemtype="http://www.data-vocabulary.org/Breadcrumb" class="aCtV"><span itemprop="title">{% trans 'Showtimes' %}</span></li>
        </ul>
        <div class="row-fluid">
            <div class="main span8 mRb0mX769">
                <section class="sCn pD15">
                    <div class="row-fluid">
                        <div class="pG-hD mRb0 rLvE">
                            <h3 class="pLlT iM">Showtimes</h3>
                            <div class="pStN-rT mRt10 span4 hMp">
                                <div id="dTpKr" class="cLnDr-hR x-mNi mNt0 pLrT mRt-20"></div>
                            </div>
                            <div class="pLrT iM w50P vOp">
                                <select class="bUiSlCtbtn-light pLrT fS12 tXt-rT" id="date_cal_sel" onchange="retreive_showtimes_by_date($(this).val());">
									{% for dt in dateList %}
                                    <option value="{{ dt|date:'Y-m-d' }}">{{ dt|date:'l, M j' }}</option>
									{% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <ul class="nav nav-tabs tB-cStM pLlT pD015">
                            <li><a href="{% url 'movies_theater_showtimes' %}" class="fW-nRmL fS12 cLr-lTbLu b0H"><i aria-hidden="true" class="bUi-iCn-aRw-l-16 ib fS12 mRr5"></i>Back to all theaters</a></li>
                        </ul>
                    </div>
                    <hr class="oTsT-hRz mRb15 mRt0">
                    <div class="row-fluid">
                        <div class="span8 mRb10mX480">
                            <div class="mDa-bDy">
                                <div class="pLlT">
                                    <span class="pD15 bLk"><i aria-hidden="true" class="bUi-iCn-mP-mKr-16 cLr-rEd fS24"></i></span>
                                </div>
                                <div class="cLr-lT">
                                    <h4 class="mDa-hD tRnC mRt10 mRb5 w85P rLvE" title="{{theater.name}}"><a href="javascript:void(0);" title="{{theater.name}}" class="fW-bLd">{{theater.name}}</a></h4>
                                    <div class="mDa-dTa fS12 cLr-gRy">
                                        <span>{{theater.address.address1}}{% if theater.address.address2 %}, {{theater.address.address2}}{% endif %}{% if theater.address.city %}, {{theater.address.city}}{% endif %}{% if theater.address.zip %} {{theater.address.zip}}{% endif %}</span>{% if theater.phone %}<span class="sPrTr">{{theater.address.phone}}</span>{% endif %}
                                    </div>
                                    <div class="mRt10 fS11 hide">
                                        <span class="bDg bRdR-gRy" title="IMAX">IMAX</span>
                                        <span class="bDg bRdR-gRy" title="Digital Projection">DP</span>
                                    </div> 
                                </div>
                            </div>
                        </div>
                        <div class="span4">
                            <div class="mP-wPr rLvE">
                                <a href="javascript:void(0);" class="bUi-tMb-wPr tMb-50 fLxiMgW">
                                    <span class="bUi-tMb">
                                        <span class="bUi-tMb-pRpL">
                                            <span class="bUi-tMb-cLp">
                                                <span class="bUi-tMb-cLp-iN">
                                                    <img alt="{{theater.name}}" src="https://maps.googleapis.com/maps/api/staticmap?center={{theater.address.lat}},{{theater.address.lon}}&zoom={{ theater.address.zoom }}&size=250x190&markers={{theater.address.lat}},{{theater.address.lon}}&sensor=false" class="mDa-oT">
                                                    <span class="vRtL-aLn">
                                                    </span>
                                                </span>
                                            </span>
                                        </span>
                                    </span>
                                </a>
                                <div class="mDa-hVr tR-hVr">
                                     <a href="javascript:void(0);" title="{% trans 'Directions' %}" onclick="init_get_direction('{{theater.address.id}}','{{theater.id}}','cinemas','{% url 'locality_map_ajax_get_direction' %}');" role="button" class="btn btn-large btn-light"><i aria-hidden="true" class="bUi-iCn-dRt-16"></i></a>
                                </div>
                                <ul class="iCnC-lSt iCn16 tHcL mRb0 pD15 hide">
                                    <li class="iCnC-lSt-iTm">
                                        <i aria-hidden="true" class="bUi-iCn-mP-mKr-12"></i>
                                    </li>
                                    <li class="iCnC-lSt-iTm">
                                        <i class="bUi-iCn-cAl-12"></i>
                                    </li>
                                    <li class="iCnC-lSt-iTm">
                                        <i aria-hidden="true" class="bUi-iCn-tAg-12"></i>
                                    </li>
                                </ul>
                            </div>
                        </div>                                
                    </div>
                    <div id="id_showtimes_append_div">
                    <hr class="oTsT-hRz mRb10 mRt15">
                        {% if showtimes %}
                        <div class="tLbR mRb10">
                            <div class="tLbR-iR">
                                <div class="pLlT fS11 mRt4">
                                    <span class="uC cLr-lTgRy">{% if today == selected_date %}{% trans 'Today' %}, {% now "F j" %}{% else %}{{selected_date|date:"l, F d"}}{% endif %}</span><span class="cLr-lTgRy sPrTr">{{showtimes.count}} movies playing at this theater.</span>
                                </div>
                            </div>
                        </div>
                        <ul class="showtimeData mDa-lT mR0 mDa-oT-lT">
                            {% for st in showtimes %}
                            {% with st.movietime.movie as movie %}
                            <li class="mDa">
                                <div class="mDa-iN wLl mRb0 pD10">
                                    <div class="mDa-wPr"> 
                                        <a class="bUi-tMb-wPr tMb-150 fLxiMgH bUi-tMb-80" href="{{movie.get_absolute_url}}">
                                            <span class="bUi-tMb">
                                                <span class="bUi-tMb-pRpL">
                                                    <span class="bUi-tMb-cLp">
                                                        <span class="bUi-tMb-cLp-iN"> 
                                                            <img class="mDa-oT" src="{% if movie.image.url %}{{movie.image.url}}{% else %}{{STATIC_URL}}themes/img/no-image.png{% endif %}" alt="{{movie.title}}">
                                                            <span class="vRtL-aLn"> </span>
                                                        </span>
                                                    </span>
                                                </span>
                                            </span>
                                        </a>
                                    </div>                                        
                                    <div class="mDa-bDy pD0">
                                        <h5 class="mDa-hD tRnCt mR50 rLvE w85P" title="{{movie.title}}"><a href="{{movie.get_absolute_url}}" class="fW-bLd">{{movie.title}}</a></h5>
                                        <div class="mDa-dTa fS11 cLr-gRy">
                                            <span class="bDg bRdR-gRy mRb0 mRr5">{{movie.certification|default:"NR"}}</span>{% if movie.duration_hours %}<span>{{movie.duration_hours}}</span>{% endif %}<span class="sPrTr">{% for gnr in movie.movie_type.all %}{{gnr.name}}{% if not forloop.last %}, {% endif %}{% endfor %}</span><span class="sPrTr"><strong class="cLr-dRk">{{movie.ratings|floatformat}}</strong>/10 <span class="fS11 cLr-lTgRy">({{movie.votes}} votes)</span></span>
                                        </div> 
                                        {% if st.movietime.theatre.tkt_url %}<a href="{{st.movietime.theatre.tkt_url}}" target="_blank" class="btn btn-warning fS11 pD612 cLr-wHt pStN-rT mRt10mX480 StCmP">Get Tickets</a>{% endif %}
                                        <div class="cLrFx mRt10 mRb30">
                                            <div class="tMlN hRz">
                                                <ol class="inline tMs">
                                                    {% for show in st.show_times|get_showtime_format %}
                                                        <li><a href="javascript:void(0);" class="tM-gD" style="left:{{show.position}}%"><span class="dOt"></span><span class="tM"><span class="aRw"></span> {{show.showtime}}</span></a></li>
                                                    {% endfor %}
                                                </ol>
                                            </div>
                                        </div> 
                                    </div>
                                </div>
                            </li>
                            {% endwith %}
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>   
                </section>
            </div>
            <aside class="sD-bR span4 oF3mN768 sP9mN768">
                <div>
                    <section class="tXt-cTr pD15 bNr-aD" id="banner_placement_right"></section> 
                </div>
                <div>
                    {% include 'default/likebox.html' %}
                </div>
            </aside>
        </div>
    </div>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>  
<script type="text/javascript" src="{{STATIC_URL}}js/locality/global-map-location.js"></script>  
{% endblock %}    