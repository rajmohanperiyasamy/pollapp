{% load comments i18n %}
{% load thumbnail %}
{% load comment_config %}
{% load_comment_config_obj object %}
{% load mptt_comments_tags %}
{% get_mptt_comment_form for object as form %}

{% if form.errors %}
<div class="messageerror" style="background:#FCF4F4;padding:10px;color:#FF9902; box-shadow:0 0 2px rgba(0, 0, 0, 0.1);border-bottom:1px solid #e1e1e1">
    <strong style="font-weight:bold;">{% trans 'There is a problem with your submission' %}</strong>
    <ul style="list-style:square;margin-left:20px;">
           {% for field in form %}
               {% if  field.errors %}<li>{%for error in field.errors%}{{ field.name|capfirst }} :{{error}}{%endfor%}</li>{% endif %}
           {% endfor %}
    </ul>
</div>
{% endif %}
{% if form.non_field_errors %}<li class="errors">{{ form.non_field_errors }}</li>{% endif %}
<form class="cMnT-fRm mRb0 dev-cForm" id="frmAddComment">
    <div class="vCrD pLlT">
        <span class="bBl-aRw">
            <span class="aRw a1"></span>
            <span class="aRw a2"></span>
        </span>
		<a href="{% if user.is_authenticated  %}{% url 'user_profile' user.username %}{% else %}javascript:void(0){% endif %}">
	        {% if cc_avatar %}
	            <img class="aVtR" src="{% if user.image %}{% thumbnail user.image 48x48 %}{% else %}{{STATIC_URL}}themes/img/cmnts-default-avatar.jpg{% endif %}">
	        {% else %}
	            <img class="aVtR" src="{{STATIC_URL}}themes/img/cmnts-default-avatar.jpg">
	        {% endif %}
		</a>
    </div>
    <div class="cMnT-bDy">
        <div class="cMnT-bDy-iN">
            <div class="cMnT-tXtArA-wRp">
               {% if cc_rating %}
                <div class="sTr-rT nEdS-fCsk" data-visible='{{cc_rating}}' onclick="update_comment_button($('#id_comment'))">
                    <span class="sTr-wPr sTr-rT-aCt iCn16 rEd"></span>
                    <span class="rT-sCr"></span>    
                </div>
                {% endif %}
                {#{ form.comment }#}
				<textarea data-expand="true" class="cMnT-tXtArA" placeholder="Write a comment..." onkeyup="update_comment_button($(this))" id="id_comment" cols="40" name="comment" rows="10" data-focus="true">{% if update %}{{update.comment}}{% endif %}</textarea>
                <input type="hidden" name="review" id="review" value="{% if object|class_name == 'Business' or object|class_name == 'Restaurants' or object|class_name == 'Movies' %}review{% endif %}"/>
                <input type="hidden" name="hiddenrating_service" id="id_hiddenrating_service" value="0" />
                {% for field in form %}{% if field.is_hidden %}{{ field }}{% endif %}{% endfor %}
            </div>
            <div class="cMnT-pSt-bTn pLrT nEdS-fCs">
				<button type="button"  class="btn disabled dev-postBtn save_comment" disabled="disabled" id="id_post_cmnt_btn">Post</button> &nbsp; <span class="as_comment_loading"></span>
            </div>
        </div>
    </div>
</form>
<script>
$(document).ready(function(){
	$('.sTr-rT-aCt').raty({
		precision: true,
	  	target    : '.rT-sCr',
	  	targetKeep: true,
	  	hints: ['', '', '', '', ''],
	  	size      : 16,
	  	scoreName: 'ratings',
		{% if update.rating %}score: {{update.rating}},{% endif %}
	});
});
</script>