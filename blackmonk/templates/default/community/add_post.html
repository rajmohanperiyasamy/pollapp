{% extends base %}
{% load tabs %}
{% load i18n truncate_filter %}
{% load ds_utils thumbnail %}
{% block pagetitle %}{% seo_format_tag module='Community' title="Add Post" code='DT' category="" as seo_meta_title %}{{seo_meta_title}}{% endblock %}
{% block meta %}
    <meta name="description" content="{{ seo.seo_description }}" />
{% endblock %}
{% block head %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/qna/qna.js"></script>
    <script>
        var ajax_login_url = '{% url 'ajax_signin' %}';
		var add_question_url = "{% url 'add_entry' %}?add_type=qna";
    </script>
{% endblock %}
{% block navigation %}
    {% activetab "topnav" "community" %}
    {{ block.super }}
{% endblock %}
{% block content %}
<div class="container-fluid">
				<!-- Module Search -->
	        	<div class="pD2015 bM-bX sRcHbR">
                    <div class="row-fluid">
                        <div class="span9 fRm" style="height:36px;">
                            <form class="form-search mRb0" method="get" action="{% url 'community_listing' %}">
								<input type="hidden" name="src" value="true">
                                <div class="mDl mRb10">
                                    <h3 class="mDl-nM mRt6">
                                        <i aria-hidden="true" class="bUi-iCn-cMnT-24 cLr-gRn"></i>
                                        <span class="ib"><a href="{% url 'community_listing' 'top_stories' %}">Community</a>
                                            <i aria-hidden="true" class="bUi-iCn-aNg-rT-12 cLr-lTgRy hP"></i>
                                        </span>
                                    </h3>
                                </div>
                                <div class="span7">
                                    <input type="text" placeholder="Search" value="{% if kw %}{{kw}}{% endif %}" name="kw" class="w72mP pLlT"></div>
                                <div class="sUb-bTn mRt0mX480 ib">
                                    <button type="submit" class="btn btn-primary mRl12 mRl5Mp  pLrT">
                                    	<i aria-hidden="true" class="bUi-iCn-sRh-16"></i>
                                    </button>
                                </div>
                            </form>
                        </div>
                        <div class="AD-bTn">
                            <div class="pLrT">
                                <a class="btn btn-danger" id="button_add_qna" {% if user.is_authenticated %} data-toggle="modal" data-target="#add_entry" data-href="{% url 'add_entry' %}?add_type=qna" {% else %} onclick="login_box('postquestion');" href="javascript:void(0);" {% endif %}>
                                	<i aria-hidden="true" class="bUi-iCn-pLs-16"></i> Add Question
                                </a>
                                <a class="btn btn-danger" href="{% url 'add_entry' %}">
                                	<i aria-hidden="true" class="bUi-iCn-pLs-16"></i> Write Post
                                </a>
                                <!--a class="btn btn-danger" href="#">
                                	<i aria-hidden="true" class="bUi-iCn-pLs-16"></i> Write Review
                                </a-->
                            </div>
                        </div>
                    </div>
                </div>
				<!-- Module Search -->

                <div class="row-fluid">
					<div class="main span8 bM-bX mRb0mX769">
						<div class="row-fluid">
							<div class="span3 sP12mX767">
								<section class="pD200">
									<ul class="nav nav-list fS12">
										<ul class="nav nav-list mRb20 nVsTyL-cMnTy cMpCt fOmX767 pDfX pD0 w100mN768 dRmN678">
											<li><a href="{% url 'community_listing' 'top_stories' %}">Top Stories</a></li>
											<li><a href="{% url 'community_listing' 'question_answer' %}">Questions &amp; Answers</a></li>
											<li><a href="{% url 'community_listing' 'open_question' %}">Open Questions</a></li>
											<li><a href="{% url 'community_listing' 'posts' %}">Posts</a></li>
										</ul>
										<li class="nav-header">Topics</li>
										<ul style="overflow-y: auto; overflow-x: hidden; max-height: 400px;" class="nav nav-list cMpCt nVsTyL-cMnTy fOmX767 pDfX pD0 w100mN768 dRmN678">
											{% for topic in topics %}
												<li><a href="{{topic.get_absolute_url}}">{{topic.name}}</a></li>
											{% endfor %}
										</ul>
							        </ul>
								</section>
							</div> 
							<div class="span9 sP12mX767">
                        		<div class="pDb12">
	                                <div class="cMnTs dVdR0 aVtR-36 mRb0 mRt10 mRr20">
	                                	<div class="cMnT">
										    <div class="cMnT-iN">
										        <div class="vCrD cLrFx pD200">
										            <a {% if request.user.id %}href="{% url 'user_profile' request.user.profile_slug %}"{% else %}href="#"{% endif %} class="pLlT bLk aVtR-36"><img class="aVtR" src="{% if request.user.image %}{% thumbnail request.user.image 36x36 crop %}{% else %}{{STATIC_URL}}themes/img/cmnts-default-avatar.jpg{% endif %}"></a>
										            <div class="cLr-lT pD10 cLr-gRy fS12">
										            	<span class="fW-bLd"><a {% if request.user.id %}href="{% url 'user_profile' request.user.profile_slug %}"{% else %}href="#"{% endif %} class="cLr-dRk">{% if request.user.id %}{{request.user.display_name}}{% else %}Unknown{% endif %}</a></span>
										            </div>
										        </div>
												{% if form.errors %}
												<div class="messageerror" style="background:#FCF4F4;padding:10px;color:#FF9902; box-shadow:0 0 2px rgba(0, 0, 0, 0.1);border-bottom:1px solid #e1e1e1">
													<strong style="font-weight:bold;">{% trans 'There is a problem with your submission' %}</strong>
												    <ul style="list-style:square;margin-left:20px;">
												   		{% for field in form %}
												   			{% if  field.errors%}<li>{%for error in field.errors%}{{error}}{%endfor%}</li>{% endif %}
												  	 	{% endfor %}
													</ul>
												</div>
												{% endif %}

												<div class="cMnT-bDy rLvE">
												    <div class="cMnT-bDy-iN">
													<form id="add_post_form" class="uSr-aCnT mRb0" method="post" action="{% url 'add_entry' %}{% if form.instance.id %}?id={{form.instance.id}}{% endif %}">{% csrf_token %}
													    <input type="hidden" id="id_add_type" name="add_type" value="posts">
														<div class="control-group">
													        <label class="control-label" >{% trans 'Title' %}<em class="cLr-rEd">*</em></label>
													        <div class="controls">
																{{form.title}}
													        </div>
													    </div>
														<div class="control-group">
													        <label class="control-label" >{% trans 'Description' %}<em class="cLr-rEd">*</em></label>
													        <div class="controls">
																{{form.content}}
													        </div>
													    </div>
														<div class="control-group">
													        <label class="control-label" >{% trans 'Topic' %}</label>
													        <div class="controls">
																<select id="id_topic" name="topic" class="bUiSlCt" data-size="3">
																		<option value=""></option>
																	{% for topic in topics %}
																		<option value="{{topic.id}}" {% if form.instance.topic.id == topic.id %}selected{% endif %}>{{topic.name}}</option>
																	{% endfor %}
																</select>
													        </div>
													    </div>
														<div class="row-fluid">
						                                    <div class="form-actions pD0 pLrT">
						                                        <a href="{% url 'community_listing' 'top_stories' %}" type="button" class="btn btn-light fS12 fW-bLd ">Cancel</a>
						                                        <a class="btn btn-primary fS12 fW-bLd" {% if user.is_authenticated  %}href="javascript: check_add_post();"{% else %} onclick="login_box('addpost');" href="javascript:void(0);"{% endif %} type="button">Submit</a>
						                                    </div>
						                                </div>
													</form>
                                                    </div> <!-- /.cMnT-bDy-iN -->
												</div><!-- /.cMnT-bDy -->
											</div> <!-- /.cMnT-iN -->
										</div> <!-- /.cMnT -->
	                                </div>	
                        		</div>
							</div> <!-- /.span9 -->
						</div>
					</div>
					<aside class="sD-bR span4 oF3mN768 sP9mN768">
						<div>
	                            <section class="tXt-cTr pD15 bNr-aD pDt0" id="banner_placement_right"></section> 
						</div>
                    	<div>
							{% include 'default/likebox.html' %}
						</div>
                    </aside>
				</div>
			</div>
{% include 'default/community/add-question_form.html' %}
<script type="text/javascript" src="{{ STATIC_URL }}js/ckeditor/ckeditor.js"></script>
<script type="text/javascript">
var edt;
	function updateTextArea(edt){
    CKEDITOR.tools.setTimeout( function(){ 
	        $('#id_content').val(edt.getData());
	        $("#id_content").trigger('keyup');
	    }, 0);  
	}

	try{
		var instance = CKEDITOR.instances['id_content'];
		CKEDITOR.remove(instance);
	}
	catch(e){}
	CKEDITOR.on( 'instanceCreated', function( e ){
		   e.editor.addCss('body { font-size:12px; font-family:Arial, "Times New Roman", Verdana;}');
   	});
	var edt=CKEDITOR.replace( 'id_content',{					
		customConfig : '{{ STATIC_URL }}js/ckeditor/custome_config.js',
		toolbar : 'Basic_Image',
		filebrowserImageUploadUrl : '{%url 'article_upload_from_editor' %}'
	});
	edt.on('key', function(event) {updateTextArea(edt);});

	$('#id_content').keyup(function(){$('#id_content').valid();})


$.validator.addMethod("desc_required", function(value, element) {  
    	$('#id_content').val(edt.getData());
		if($('#id_content').val()!=''){return true;}
		else{return false;}
	},"Please enter a description.");
$(document).ready(function(){
	$("#add_post_form").validate({
		   ignore:'',
	       highlight: function(element, errorClass){
				   $(element).parent('div').parent('div').addClass('error');
				   $(element).parent('div').addClass('error');
	               $(element).addClass('error');
	       },
	       unhighlight: function(element, errorClass){
	               $(element).parent('div').parent('div').removeClass('error');
				   $(element).parent('div').removeClass('error');
	               $(element).removeClass('error');
	       },
	       errorPlacement: function(error, element){},
	       rules:{
	           content: "required",
	           title: "required",
	       }
		});
		$('#id_topic').bind("change", function(){
			$("#add_post_form").validate().element($(this));
		});
});

</script>
{% endblock %} 