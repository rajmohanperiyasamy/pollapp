{% extends 'default/locality/map/base.html' %}
{% load modulotag %}
{% load truncate_filter %}
{% load mptt_comments_tags %}
{% load comparison %}
{% load i18n %}
{% load tabs %}
{% load thumbnail %}
{% load ds_utils %}
{% block pagetitle %}{{seo.seo_title}} | {{ globalsettings.domain }} {% endblock %}
{% block meta %}
    <meta name="description" content="{{ seo.seo_description }}" />
{% endblock %}
{% block head %}
    
{% endblock %}
{% block navigation %}
    {% activetab "modulenav" "attractions" %}
    {{ block.super }}
{% endblock %}
{% block content %}
    <div id="site">
        <div class="row-fluid">
            <div id="site" >
                <div class="expolre">
                    <div class="gGl-mP-cNvS">
                        <div id="map-canvas"></div>
                    </div>
                    <div class="result-container" id="id_result_div"> 
                        <div class="sCn">
                            <div class="" style="padding: 15px; margin-bottom: 11px; background-color: rgb(245, 245, 245); border-bottom: 1px solid rgb(221, 221, 221);">
                                <form class="form-search rLvE mRb0" method="GET" action="{% url 'locality_map_attractions' %}">
                                    <input type="hidden" name="search" value="true">
                                    <input type="text" id="id_q" name="q" value="{% if q %}{{ q }}{% endif %}" placeholder="Nearby attractions" class="search-query iSp9 fS14 h35" style="width: 100% ! important; border-color: rgb(221, 221, 221);">
                                    <button type="submit" class="btn btn-primary fS12 fW-bLd lH1 aBsLt rGt0 t0 " style="border-radius: 0px 2px 2px 0px; padding: 8px 12px; background-color: transparent; color: rgb(187, 187, 187);"> <i aria-hidden="true" class="bUi-iCn-sRh-16 "></i></button>
                                </form>
                            </div>
                            <input type="hidden" id="load_more_url" value="{% url 'locality_map_ajax_filter_attractions' %}">
                            <input type="hidden" id="id_search_status" value="{{search}}">
                            <input type="hidden" id="page_number" value="{{next}}">
                            <input type="hidden" id="id_fl_counter" value="{{fl_counter}}">
                            <ul class="modulesBrowseData mDa-lT mDa-oT-lT iNsT-10 mRl15" id="id_content_ul">
                                {% include 'default/locality/map/ajax-attractions-list.html' %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- #site-wrapper --> 
<script type="text/javascript" src="{{STATIC_URL}}js/locality/global-map-location.js"></script> 
<script type="text/javascript">
var markers=[];
var icon_lrg = "{{STATIC_URL}}themes/img/icons/map-pointer.png";
var icon_sml = "{{STATIC_URL}}themes/img/icons/a-small.png";

$(document).ready(function(){
                             
    {% for attraction in attractions %}
            {% with attraction.venue as addr %}
                var marker = new Object();
                marker["lat"] = {{addr.lat}};
                marker["lng"] = {{addr.lon}};
                marker["zoom"] = {{addr.zoom}};
                marker["icon"] = icon_lrg;
                 
                var contentString = '<ul id="map-view'+{{attraction.id}}+'" class="cLrFx map-info modulesBrowseData mDa-lT mDa-oT-lT">';
                contentString+='<li class="mDa mR0"> <div class="mDa-wPr mRr5mP"> <a href="{{ attraction.get_absolute_url }}" class="bUi-tMb-wPr tMb-100 fLxiMgH bUi-tMb-100">';
                contentString+='<span class="bUi-tMb"> <span class="bUi-tMb-pRpL"> <span class="bUi-tMb-cLp">{% with attraction.album.album_photos.all.0.photo as attraction_img %} <span class="bUi-tMb-cLp-iN">';
                contentString+='{% if attraction_img %}<img src="{% thumbnail attraction_img 260x0 %}" alt="{{ attraction.name }}" class="mDa-oT">{% else %}<span class="iCn-bRdR50 oP25" title="{{ attraction.name }}"><i aria-hidden="true" class="bUi-iCn-aTtR-24 cLr-gRy ib"></i></span>{% endif %}<span class="vRtL-aLn"> </span> </span>{% endwith %} </span> </span> </span> </a> </div>';
                contentString+='<div class="mDa-bDy pDt0"><h4 title="{{ attraction.title }}" class="mDa-hD"><a href="{{ attraction.get_absolute_url }}" class="tRnCt cLr-gRy-dRk fS14">{{ attraction.name }}</a></h4>';
                contentString+='{% if attraction.description %}<div class="mDa-dTa">';
                contentString+='<p class="fS12 cLr-gRy mXh35">{% autoescape on %}{{attraction.description|striptags|truncatewords:20}}{% endautoescape %}</p>';
                contentString+='</div>{% endif %}';
                contentString+='{% with attraction.venue as venue %}<div class="mDa-dTa mRt4 cLrFx">';
                contentString+='<span class="fS12 cLr-lTgRy pLlT"><i aria-hidden="true" class="bUi-iCn-mP-mKr-12"></i> {{ venue.venue}}</span></div>{% endwith %}';
                contentString+='<a href="{% url "locality_map_map_get_direction" %}?aid={{addr.id}}&objid={{attraction.id}}&src=attractions" title="{% trans "Directions" %}" class="aBsLt bR10"><i aria-hidden="true" class="bUi-iCn-dRt-20 fS12 "></i></a>';
                contentString+='</div></li></ul>';
                
                marker['content_info'] = contentString;
                markers.push(marker);
            {% endwith %}
    {% endfor %}
    
    {% if other_attractions %}
        {% for attraction in other_attractions %}
                {% with attraction.venue as addr %}
                    var marker = new Object();
                    marker["lat"] = {{addr.lat}};
                    marker["lng"] = {{addr.lon}};
                    marker["zoom"] = {{addr.zoom}};
                    marker["icon"] = icon_sml;
                    
                    var contentString = '<ul id="map-view'+{{attraction.id}}+'" class="cLrFx map-info modulesBrowseData mDa-lT mDa-oT-lT">';
                    contentString+='<li class="mDa mR0"> <div class="mDa-wPr mRr5mP"> <a href="{{ attraction.get_absolute_url }}" class="bUi-tMb-wPr tMb-100 fLxiMgH bUi-tMb-100">';
                    contentString+='<span class="bUi-tMb"> <span class="bUi-tMb-pRpL"> <span class="bUi-tMb-cLp">{% with attraction.album.album_photos.all.0.photo as attraction_img %} <span class="bUi-tMb-cLp-iN">';
                    contentString+='{% if attraction_img %}<img src="{% thumbnail attraction_img 260x0 %}" alt="{{ attraction.name }}" class="mDa-oT">{% else %}<span class="iCn-bRdR50 oP25" title="{{ attraction.name }}"><i aria-hidden="true" class="bUi-iCn-aTtR-24 cLr-gRy ib"></i></span>{% endif %}<span class="vRtL-aLn"> </span> </span>{% endwith %} </span> </span> </span> </a> </div>';
                    contentString+='<div class="mDa-bDy pDt0"><h4 title="{{ attraction.title }}" class="mDa-hD"><a href="{{ attraction.get_absolute_url }}" class="tRnCt cLr-gRy-dRk fS14">{{ attraction.name }}</a></h4>';
                    contentString+='{% if attraction.description %}<div class="mDa-dTa">';
                    contentString+='<p class="fS12 cLr-gRy mXh35">{% autoescape on %}{{attraction.description|striptags|truncatewords:20}}{% endautoescape %}</p>';
                    contentString+='</div>{% endif %}';
                    contentString+='{% with attraction.venue as venue %}<div class="mDa-dTa mRt4 cLrFx">';
                    contentString+='<span class="fS12 cLr-lTgRy pLlT"><i aria-hidden="true" class="bUi-iCn-mP-mKr-12"></i> {{ venue.venue}}</span></div>{% endwith %}';
                    contentString+='<a href="{% url "locality_map_map_get_direction" %}?aid={{addr.id}}&objid={{attraction.id}}&src=attractions" title="{% trans "Directions" %}" class="aBsLt bR10"><i aria-hidden="true" class="bUi-iCn-dRt-20 fS12 "></i></a>';
                    contentString+='</div></li></ul>';
                    
                    marker['content_info'] = contentString;
                    markers.push(marker);
                {% endwith %}
        {% endfor %}
     {% endif %}   
    
    setTimeout(function(){load_global_map('map-canvas',{{ globalsettings.google_map_lat }}, {{ globalsettings.google_map_lon }}, {{ globalsettings.google_map_zoom }}, markers, false)},500);
});

</script>
{% endblock %} 
