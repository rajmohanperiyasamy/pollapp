{% extends base %}
{% load modulotag %}
{% load truncate_filter %}
{% load comparison %}
{% load i18n %}
{% load currency %}
{% load tabs %}
{% load ds_utils %}
{% block pagetitle %}{%if seo%}{% seo_format_tag module='Shop' title=seo.meta_title code='MT' as seo_meta_title %}{{seo_meta_title}}{%else%}{% trans 'Shop' %}{%endif%}{% endblock %}
{% block meta %}
	<meta name="description" content="{{ seo.seo_description }}" />
{% endblock %}

{% block head %}
	<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}themes/green/css/store.css">
{% endblock %}
{% block navigation %}
	{% activetab "topnav" "shop" %}
	{{ block.super }}
{% endblock %}
{% block content %}
	{% include 'default/bmshop/include_search.html' %}		
	<div class="page_wraper" id="product_list">
	        <div class="group">
	        	<div class="mrl_0" id="breadcrumbs"><a href="{%url 'bmshop_product_home' %}">{% trans 'Home' %}</a>{%for parent_cat in cat_obj.get_parents %}&nbsp;»&nbsp;<a href="{{parent_cat.get_absolute_url}}">{{parent_cat.name}}</a>{%endfor%}&nbsp;»&nbsp;<span class="here">Search Result</span></div>
	            <div style="width:228px; margin-right:20px;" class="col_4" id="search_refine_bar">
					<div class="search_refine">
	                	<div class="inner">
							<div class="refinement category" id="refine_category">
	                        	<h4>Categories<span class="arrow"></span><span class="icon"></span></h4>
	                            <div class="refine_attributes">
	                            	<div class="group">
	                                    <ul>
											{%for cat_obj in cat_objs%}
												<li><input type="checkbox" value="{{cat_obj.cat.id}}" class="cat_s" id="id_cat" onclick="filter_product()" name="cat">{{cat_obj.name}} ({{cat_obj.product_count}})</li>
	                                        {%endfor%}
	                                    </ul>
									</div>                                                
								</div>                                            
	                        </div>
							{%if man_objs%}
	                    	<div class="refinement brand has_scroll" id="refine_brand">
	                        	<h4>{% trans 'Brand' %}<span class="arrow"></span><span class="icon"></span></h4>
	                            <div class="refine_attributes" style="height: 190px;">
	                            	<div class="group scroll_pane jspScrollable" style="overflow: hidden; padding: 0px; width: 228px;" tabindex="0">
	                                    
									<div class="jspContainer" style="width: 228px; height: 190px;"><div class="jspPane" style="padding: 0px; width: 216px; top: 0px;"><ul>
										{%for man_obj in man_objs%}
                                    	<li><input type="checkbox" value="{{man_obj.id}}" class="brand" id="id_brand" onclick="filter_product()" name="brand">{{man_obj.name}}</li>
										{%endfor%}
	                                 </ul></div><div class="jspVerticalBar"><div class="jspCap jspCapTop"></div><div class="jspTrack" style="height: 190px;"><div class="jspDrag" style="height: 110px; top: 0px;"><div class="jspDragTop"></div><div class="jspDragBottom"></div></div></div><div class="jspCap jspCapBottom"></div></div></div></div>                                                
								</div>  
	                        </div>  
	                        {%endif%}
	                    </div>
	                </div>
	            </div>
	            <div class="main col_12 mr_0" style="width:733px;">
	                <div class="list_wraper">
	                    <div class="list_controls group">
	                    	<div class="total_items">
	                        	Search Result for <b>"{{query}}"</b>  Showing <span class="count">{{product_objs.count}}</span>  Items.
	                        </div>
	                    </div>
	                    <div class="featured" style="">
	                        <h2 style="">{{cat_obj.name}}</h2>
	                    </div>   
						<input type="hidden" value="{{query}}" name="search_query" id="id_search_query">                         
	                    <div class="place_list group" id="product_content">
	                    	{% include 'default/bmshop/include_product_filter.html' %}  
	                    </div>
					</div>                              
	            </div> 
	        </div>
	    </div>
<script type="text/javascript">
	
	
	function filter_product(){
		var dataString='';
		var manufacture_ids=[];
		var cat_ids=[];
		var price_range_ids=[];
		
		$('.cat_s:checked').each(function(){
			cat_ids.push($(this).val());
		});
		dataString+="cat_id="+cat_ids;
		
		$('.brand:checked').each(function(){
			manufacture_ids.push($(this).val());
		});
		dataString+="&manufacture="+manufacture_ids;
		dataString+="&price_range="+price_range_ids;
		dataString+="&search_query="+$('#id_search_query').val();
		
		$.ajax({
		type: "GET",
		url: '{% url 'bmshop_product_filter_products' %}',
		data: dataString,
		dataType:'JSON',
		success: function(data){
				$('#product_content').empty().html(data.html);
				$('#product_content').show();	
				$('.count').empty().html(data.product_count);
				//window.history.pushState({},"", '?'+dataString);
				
			}
		});	
	
     }

</script>	
{% endblock %}
