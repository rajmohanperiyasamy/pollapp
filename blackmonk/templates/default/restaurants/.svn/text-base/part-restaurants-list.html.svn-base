{% load thumbnail %}
{% load mptt_comments_tags %}
{% load bm_restaurant_tags %}
{% load i18n %}
    <input type="hidden" value="{{sort}}" name="id_sort" id="id_sort">
    <input type="hidden" value="{{page}}" name="id_hid_pgntn" id="id_hid_pgntn">
    <input type="hidden" value="{{view_type}}" name="view_type" id="id_hid_view_type">
    
    <input type="hidden" value="{% if search %}true{% else %}false{% endif %}" name="id_search" id="id_search">
    <input type="hidden" value="{{kw}}" name="q" id="id_hid_kw">
    <input type="hidden" value="{{location}}" name="id_hid_location" id="id_hid_location">
    
{% if restaurants %}
<ul class="modulesBrowseData fOmX767 {% if view_type == 'list' %}mDa-lT mDa-oT-lT{% else %}mDa-gD mDa-oT-tP pDfX{% endif %}">
    {% for restaurant in restaurants %}
    <li class="mDa">
        <div class="mDa-iN">
            <div class="mDa-wPr"> 
                <a class="bUi-tMb-wPr tMb-100 fLxiMgH bUi-tMb-bSnS" href="{{restaurant.get_absolute_url}}">
                    <span class="bUi-tMb">
                        <span class="bUi-tMb-pRpL">
                            <span class="bUi-tMb-cLp">
                                <span class="bUi-tMb-cLp-iN"> <img class="mDa-oT" src="{% if restaurant.logo.logo %}{% thumbnail restaurant.logo.logo 600x0 %}{% else %}{{STATIC_URL}}themes/img/no-image.png{% endif %}" alt="{{restaurant.name}}">
                                    <span class="vRtL-aLn"> </span>
                                </span>
                            </span>
                        </span>
                    </span>
                </a> 
            </div>
            <div class="mDa-bDy">
                <h4 class="mDa-hD tRnCt0 rLvE" title="{{restaurant.name}}"><a href="{{restaurant.get_absolute_url}}" class="tRnCt bLk">{{restaurant.name}}</a> 
                    <!-- Star Rating -->
                    <div class="sTr-rT ib mRb0 mNi tXt-rT"><span class="rT-oVrL-sCr ib fS13 cLr-dRk">{{restaurant.ratings}}</span> <span class="sTr-wPr sTr-rT-mNi iCn16 rEd" id="id_rating_{{restaurant.id}}"></span><a href="#" class="cLr-lTgRy fS11 bLk">{% get_mptt_comment_count for restaurant as comment_count %}{{comment_count}} reviews</a></div>
                    <!-- Star Rating --> 
                </h4>
                <div class="mDa-dTa">
                    {% with restaurant.restaurant_address.all.0 as address %}
                    <ul class="iCnC-lSt iCn10 iCn-gRy">
                        <li class="iCnC-lSt-iTm">
                            <i aria-hidden="true" class="bUi-iCn-mP-mKr-12"></i>
                            <a href="#">{{address.address1}}{% if address.address2 %}, {{address.address2}}{% endif %}{% if address.city %}, {{address.city}}{% endif %}{% if address.pin %} - {{address.pin }}{% endif %}</a>
                        </li>
                        {% if address.telephone or address.mobile_no %}
                        <li class="iCnC-lSt-iTm">
                            <i aria-hidden="true" class="bUi-iCn-cAl-12"></i>
                            {% if address.telephone %}{{address.telephone}}{% else %}{{address.mobile_no}}{% endif %}
                        </li>
                        {% endif %}
                        <li class="iCnC-lSt-iTm">
                            <i aria-hidden="true" class="bUi-iCn-tAg-12"></i>
                            {% for csn in restaurant.cuisines.all %}<a href="#">{{csn.name}}</a>{% if not forloop.last %}, {% endif %}{% endfor %}
                            <span class="sPrTr">{{restaurant.price_range|get_price_range_fmt}}</span>
                        </li>
                    </ul>
                    {% endwith %}
                </div>
                <div class="mDa-hVr"> <a data-toggle="tooltip" data-placement="right" title="Share" class="iCn-lNk btn btn-mini" href="#"> <i class="BUI-icon-63"></i>Share</a></div>
            </div>
        </div>
    </li>
    {% endfor %}
</ul>
{% endif %}
{% include 'default/common/ajax-pagination.html' %}

<script src="http://maps.googleapis.com/maps/api/js?v=3&sensor=false{% if globalsettings.google_map_key %}&key={{ globalsettings.google_map_key }}{% endif %}" type="text/javascript"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/general/google_map.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}themes/js/gmap-markerwithlabel.js"></script>
<script src="{{STATIC_URL}}themes/js/jquery.raty.js"></script>
<script type="text/javascript">
var markers=[];
$(document).ready(function(){
    {% for restaurant in restaurants %}
            $('#id_rating_{{restaurant.id}}').raty({ readOnly: true, size: 12, score: {{restaurant.ratings}} });
            {% with restaurant.restaurant_address.all.0 as addr %}
                var marker = new Object();
                marker["lat"] = {{addr.pointer_lat}};
                marker["lng"] = {{addr.pointer_lng}};
                marker["zoom"] = {{addr.map_zoom}};
                marker["name"] = "{{ b.name }}";
                marker["title"] = "2";
                marker["label"] = "{{forloop.counter}}",
                marker["address"] = "{{ addr.address1|escape|linebreaks }}{{ addr.city }} - {{addr.pin }}";
                marker["icon"]="{{STATIC_URL}}themes/img/icons/marker-regular.png";
                markers.push(marker);
            {% endwith %}
    {% endfor %}
    {% get_featured_restaurants limit=20 cuisine=selected_cuisine as featured_restaurants %}
    {% if featured_restaurants %}
        {% for restaurant in featured_restaurants %}
                $('#id_fb_rating_{{restaurant.id}}').raty({ readOnly: true, size: 16, score: {{restaurant.ratings}} });
                {% with restaurant.restaurant_address.all.0 as addr %}
                    var marker = new Object();
                    marker["lat"] = {{addr.pointer_lat}};
                    marker["lng"] = {{addr.pointer_lng}};
                    marker["zoom"] = {{addr.map_zoom}};
                    marker["name"] = "{{ b.name }}";
                    marker["title"] = "2";
                    marker["address"] = "{{ addr.address1|escape|linebreaks }}{{ addr.city }} - {{addr.pin }}";
                    marker["icon"]="{{STATIC_URL}}themes/img/icons/marker-featured.png";
                    markers.push(marker);
                {% endwith %}
        {% endfor %}
    {% endif %}
    load_multi_marker_with_numeric_overlay('map-canvas',{{ globalsettings.google_map_lat }}, {{ globalsettings.google_map_lon }}, {{ globalsettings.google_map_zoom }},markers)            
    
    var views = $('#media-toggle');
    var figureItems = $('.main').find('.modulesBrowseData');
    var thumbnaiItem = $('.modulesBrowseData').find('.mDa-oT');
    
    
    function setGridColumn(){        
        $('.mDa-gD').each(function(index, element) {
            if(!$(this).hasClass('dSgDwDt')){
                var gridColumnWidth = $(this).find('.mDa').width();
                $(this).find('.mDa .mDa-oT').css({'width':''+gridColumnWidth+'','height':'auto'}); 
            }
        });    
    }
    
    views.on('click', '.c-lT', function() {
        views.find('.btn').removeClass('active');
        $(this).addClass('active');
        figureItems.removeClass('mDa-gD mDa-oT-tP').addClass('mDa-lT mDa-oT-lT');
        if(figureItems.children('li').hasClass('mDa-gRp')){
            figureItems.find('.mDa-gRp > ul').removeClass('pDfX')
        }
        else{
                figureItems.removeClass('pDfX');    
            }
        thumbnaiItem.css('width','auto');
        $('.fLxiMgH').setrSpVHeight('mDa-lT');
        $('.fLxiMgW').setrSpVWidth(0);
        $('.fLxiMgW30').setrSpVWidth(30);
    });
    views.on('click', '.c-gD', function() {
        views.find('.btn').removeClass('active');
        $(this).addClass('active');
        figureItems.removeClass('mDa-lT mDa-oT-lT').addClass('mDa-gD mDa-oT-tP');
        if(figureItems.children('li').hasClass('mDa-gRp')){
            figureItems.find('.mDa-gRp > ul').addClass('pDfX')
        }
        else{
                figureItems.addClass('pDfX');    
            }
        $('.fLxiMgH').setrSpVHeight('mDa-lT');
        $('.fLxiMgW').setrSpVWidth(0);
        $('.fLxiMgW30').setrSpVWidth(30);
        setGridColumn();
    });
    setGridColumn();
    
    
    $(window).bind("resize orientationchange", (function () {
        setGridColumn();            
    }))    
    
    setTimeout(function(){setGridColumn()});
    
    $('.fLxiMgH').setrSpVHeight('mDa-lT');
    
    
    
});
</script>    

