{% extends base %}
{% load tabs %}
{% load ds_utils %}
{% load i18n %}
{% block pagetitle %}{{topic.seo_title}}{% endblock %}
{% block meta %}
<meta name="Description" content="{{topic}}">
<meta name="Keywords" content="{{ globalsettings.city }}, forum, discussion, express yourself, {{ globalsettings.city }} forums, {{ globalsettings.city }} forums, {{ globalsettings.city }} views, {{ globalsettings.city }} connect">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="imagetoolbar" content="no" />
{% endblock %}
{% block head %}
<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}themes/green/css/forum.css">
<link href="{{STATIC_URL}}smarkup/skins/style.css" type="text/css" rel="stylesheet" />
<link href="{{STATIC_URL}}smarkup/skins/default/style.css" type="text/css" rel="stylesheet" />
<link href="{{STATIC_URL}}smarkup/conf/bbcode/style.css" type="text/css" rel="stylesheet" />

{% endblock %}
{% block navigation %}
	{% activetab "topnav" "forum" %}
	{{ block.super }}
{% endblock %}
{% block content %}
    <div id="breadcrumbs"><a href="/discussions/" title="{{ globalsettings.domain }} Home">{% trans 'Forum Index' %}</a> &nbsp;»&nbsp;   {% ds_link post.topic.forum.category %} &nbsp;»&nbsp; {% ds_link post.topic.forum %} &nbsp;»&nbsp;  {% ds_link post.topic %}</span></div>	<div class="group">
				<div id="forum" class="col_13 group">
     <div id="respond" style="margin:30px 0 20px 20%; padding-left:0;">                 
       <form class="post-form" id="post-form"  method="post" enctype="multipart/form-data">{% csrf_token %}
       <div class="preview-box" style="display:none">
       	 <div class="header" ><h3>{% trans 'Preview' %}</h3></div>
       	 <div class="content"></div>
    	</div>
        <input type="hidden" name="markup" id="id_markup" value="bbcode"/>
        <label for="postSubject">{% trans 'Subject' %}:</label>
        <p><input type="text" size="30" name="name" id="postSubject" class="input_text large" value="{{post.topic.name}}" readonly="readonly" ></p>
        <label for="postMessage">{% trans 'Post' %}:</label>
        <p style="width:553px;"> <textarea rows="7" name="body" id="bbcode"  class="large">{{post.body}}</textarea></p>
<div class="form_footer"> <button type="button" id="preview-button" name="preview"  class="button super green large"><span>{% trans 'Preview' %}</span></button> <button type="submit" class="button super red large"><span>{% trans 'Update' %}</span></button></div>
</form>                                            
                        </div>
<script type="text/javascript" src="{{STATIC_URL}}smarkup/smarkup.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}smarkup/jquery.smarkup.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}smarkup/addons/commons/addons.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}smarkup/conf/bbcode/conf.js"></script>
<script type="text/javascript">
		$(document).ready(function() {
		$('#bbcode').sMarkUp('bbcode', 200);
		$('#preview-button').click(function() {
        var raw_content = $.trim($('.post-form #bbcode').val());
        var markup = $('.post-form #id_markup').val();

        args = {'content': raw_content, 'markup': markup}
        $.post('/discussions/api/post_ajax_preview/', args, function(data) {
            if (data.error) {
                alert(data.error);
            } else {
                $('.preview-box .content').html(data.content);
                $('.preview-box').show();
            }
        }, 'json');
    });
    $("#post-submit").click(function() {
    
		      var name=$("#name").val();
		      var body=$("#bbcode").val();
		      var error="";
		      if(name==""){
		      	error=gettext("Ooops,  Please provide the subject")
		      }
		      if(error!=""){
		        error+="<br/>"
		      }
		      if(body==""){
		      	error+=gettext("Ooops,  Please provide the description")
		      }
		      
		      if(error==""){
		      $("#post-submit").attr("disabled","disabled")
		       $(".preview-button").attr("disabled","disabled")
		      	$(".post-form").submit()
		      }
		      else{
		      $("#error-box").show();
		      	 $("#error-box").html(error);
		      }
		});
		
	      
	  });
	</script>
                </div>
				<div id"secondary" class="col_3 mr_0">
                	<div class="advt">
                    	<span class="declare">{% trans 'Advertisement' %}</span>
                    	<div id="banner_placement_right"></div><!-- Banner Placement -->
                    </div><!-- /advt -->
                </div>
			</div>
        {% endblock %}