{% extends "staff_base.html" %}
{% load tabs %}
{% block navigation %}
	{% activetab "selmodule" "payment" %}
	{{ block.super }}
{% endblock %}
{% block pagetitle %}Payment{% endblock %}
{% block head %}

<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}themes/green/css/lightbox.css">
<script type="text/javascript" src="{{ STATIC_URL }}js/general/lightbox.js"></script>


<style>
	.allhide{display:none}
	#loading{ 
		text-align:center;
		position:relative;
		margin:20 auto;
		height:320px;
		width:580px;
	}
	.as_loader_default_wrapper {position:absolute;top:25%;left:50%;width:90px;margin-left:-37.5px;}
</style>

<script type="text/javascript">
	function load_payment_details(id){
		show_content("payment_details_page");
		$("#payment_details_page").html('<div id="loading"><span class="as_loader_default_wrapper"><img src= "{{ STATIC_URL }}themes/green/images/global/buzz_twitter_more.gif" style="float:left" />Loading...</span></div>');
		
		$.ajax({
			   type: "GET",
			   url: '/staff/payment/ajax_pay_details/',
			   data:"pid="+id,
			   success: function(html_from_server){	
					$("#payment_details_page").html(html_from_server);
				}
		});
	}
</script>	

{% endblock %}
{% block content %}

			<!-- Lightbox code begin -->   
     		<div class="lightbox_outer" >
			<div class="lightbox_content_holder">
     			<a href= "#1" class="call_lightbox lb_close fix_ie6png enlarge click_pvnt"></a>
				<div class="lightbox_content">
					<!-- Put all your contents only inside this "lightbox_content" div -->
					
					<div style="width:600px;height:180px;" class="allhide" id="payment_details_page"></div>
					<!-- put your contents only iside "lightbox_content" div -->		
				</div>			
			</div>
			</div>
			<div class="lightbox_background"></div>
			<!-- Lightbox code end -->

			<div class="page_title group" style="display:block; overflow:hidden; padding:10px 0 20px 0;">
            	<div class="bread-crumb clearfix">
                    <ul>
                        <li><a href="/staff/" style="background:#666;font-size:12px; padding:2px 4px; -moz-border-radius:4px;color:#FFF">Staff Home</a></li>
                        <li style="background:#eee;font-size:12px; padding:2px 4px; -moz-border-radius:4px;color:#666">Payment</li>
                        <li style="background:#eee;font-size:12px; padding:2px 4px; -moz-border-radius:4px;color:#666">Transaction History</li>                        
                    </ul>
                </div> 
            </div>
			<div class="page_title group" style="display:block; overflow:hidden;">
                <h2 style="display:block; margin:0; padding-left:10px; line-height:normal">Transaction History</h2> 
            </div>            
        	<div class="main" style="margin-bottom:20px;">
				{% activetab "leftnav" "trans" %}
				{% include 'payment/staff/part_left_nav.html' %}
            	 	
            	<div class="main_col" style="float:left; width:740px;">
					{% if message %}                         
                  		<div class="message">{{message}}</div>
            		{% endif %}
						
						<!--div class="all_control">
                            <select name="selvalue" id="qna_cat" class="textField small" style="width:105px;" onchange="javascript:validate();">
                                    <option value="">---Filter by---</option>
                                    <option value="addf">&nbsp;Article</option>
                                    <option value="remf">&nbsp;Business</option>
                                    <option value="act">&nbsp;Classified</option>
                                    <option value="dact">&nbsp;Events</option>
                                    <option value="del">&nbsp;Real Estate</option>
                             </select>                            
              			</div-->	
						
						<table class="staff content" align="center" cellpadding="0" cellspacing="0" width="740">
							<colgroup>
								<col width="180">
								<col width="300">							
								<col width="120">
								<col width="50">
								<col width="50">                                                                
							</colgroup>				
							<tbody>
								<tr class="head">
									<th class="id"><div>Id</div></th>
									<th class=""><div>Details</div></th>
									<th class="price"><div>Amount</div></th>
									<th class="status"><div>Status</div></th>								
									<th class="action" style="text-align:left"><div>Action</div></th>                                    
								</tr>
								{% for pay in payments %}
								<tr class="row">
									<td>
										<a href="{{ pay.get_staff_detail_url }}" style="text-decoration:none"><strong>{{ pay.order.invoice_no }}</strong></a><br />										
										<span style="color:#aaa; font-size:11px;">Date: {{ pay.created_on|date:"M d, Y" }}</span><br/>
                                    </td>
									<td>
                                    <span style="text-transform:uppercase; color:#808080; font-size:11px;">{{ pay.content_type }}</span><br />
                                    <a href="/staff/company/{{ pay.company.code }}/details/" target="_blank">{{ pay.company.name }}</a> <span style="font-size:11px; color:#aaa;">by <a href="/profile/{{ pay.created_by }}" target="_blank">{{ pay.created_by }}</a></span></td>
									<td>{% if pay.price %}{{ globalsettings.currency }} {{ pay.price }} {% else %} --- {% endif %}</td>
									<td class="status">
										
										{% if pay.content_object.get_payment_status %}
											<a href="javascript:void(0);" onclick="load_payment_details({{pay.id}});"><h5 class="pendding">Paid</h5></a>
										{% else %}
											<h5 class="pendding">Not Paid</h5></a>
										{% endif %}
										
									<!--
										{% ifequal pay.payment_status 'R' %}
											<h5 class="pendding">Pendding</h5>
										{% else %}{% ifequal pay.payment_status 'R' %}
											<h5 class="approved">Approved</h5>
										{% else %}
											<h5 class="">Request</h5>
										{% endifequal %}
										{% endifequal %}
										
										<a href="#" onclick="window.document.getElementById('id_paypaldetails{{ pay.id }}').style.display='';return false;">view details</a>
										<div id="id_paypaldetails{{ pay.id }}" style="display:none;">
											{% if pay.paypal %}
												<b>Invoice: </b>{{ pay.paypal.invoice }}<br/>
												<b>Transaction Id: </b>{{ pay.paypal.txn_id }}<br/>
											{% else %}
												<b>--Not completed --</b>
											{% endif %}
										</div>
									-->	
										
									</td>
                                    <td class="action"><a href="/staff/payment/deletetransaction/?pid={{ pay.id }}" onclick="if(!confirm('Are you sure you want to delete this transaction?')){return false;}">Delete</a></td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
                        {% if is_paginated %}
  						<div style="width:740px; text-align:center; margin:20px 0">
							<div class="Paginator">
							{% if has_previous %}
								{% ifequal num page %}
										<span class="this-page">{{ num }}</span>
								{% else %}
									<a href="{{ url }}/?page={{ prev }}" class="Prev" title="Previous Page">&laquo; Prev</a> 
								{% endifequal %}
							{% endif %}
						 
							{% if not in_leading_range %}
								{% for num in pages_outside_trailing_range %}
									{% ifequal num page %}
										<span class="active">{{ num }}</span>
									{% else %}
										<a href="{{ url }}/?page={{ num }}" >{{ num }}</a> 
									{% endifequal %}
								{% endfor %}
								<span class="break">&hellip;</span>
							{% endif %}
							 
							{% for num in page_numbers %}
								  {% ifequal num page %}
								    	<span class="active">{{ num }}</span>
								  {% else %}
								  		<a href="{{ url }}/?page={{ num }}" title="Page {{ num }}">{{ num }}</a> 
								  {% endifequal %}
							{% endfor %}
							 
							{% if not in_trailing_range %}
								<span class="break">&hellip;</span>
								{% for num in pages_outside_leading_range reversed %}
									{% ifequal num page %}
										<span class="active">{{ num }}</span>
									{% else %}
										<a href="{{ url }}/?page={{ num }}" >{{ num }}</a> 
									{% endifequal %}
								{% endfor %}
							{% endif %}
							 
							{% if has_next %}
								<a href="{{ url }}/?page={{ next }}" class="Next" title="Next Page">Next &raquo;</a> 
							{% endif %}
							<span class="Results">&nbsp;({{ count }} categories)</span>
						</div>
						</div>
					{% endif %}
                </div> 
                <hr />
            </div>
{% endblock %}