{% extends "staff_base.html" %}
{% load modulotag %}
{% load tabs %}
{% block navigation %}
	{% activetab "selmodule" "locality" %}
	{{ block.super }}
{% endblock %}
{% block pagetitle %}Manage locations{% endblock %}
{% block head %}
<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key={{ globalsettings.google_map_key }}" type="text/javascript"></script>
<script type="text/javascript">
    //<![CDATA[

    var iconPink = new GIcon(); 
    iconPink.image = '{{ STATIC_URL }}images/map/marker_pink.png';
    iconPink.shadow = '{{ STATIC_URL }}images/map/shadow.png';
    iconPink.iconSize = new GSize(20, 34);
    iconPink.shadowSize = new GSize(37, 34);
    iconPink.iconAnchor = new GPoint(9, 34);
    iconPink.infoWindowAnchor = new GPoint(5, 1);

    var iconGreen = new GIcon(); 
    iconGreen.image = '{{ STATIC_URL }}images/map/marker_green.png';
    iconGreen.shadow = '{{ STATIC_URL }}images/map/shadow.png';
    iconGreen.iconSize = new GSize(20, 34);
    iconGreen.shadowSize = new GSize(37, 34);
    iconGreen.iconAnchor = new GPoint(9, 34);
    iconGreen.infoWindowAnchor = new GPoint(5, 1);

    var customIcons = [];
    customIcons["pink"] = iconPink;
    customIcons["green"] = iconGreen;
    
    var opt  
	opt = {}
	opt.draggable = true  
	opt.clickable = true  
	opt.dragCrossMove = true 

	var marker;
	var map;
	function load(lat,lng,zoom,type,name,address,locality) {
		if (GBrowserIsCompatible()) {
			map = new GMap2(document.getElementById("map"));
			//map.addControl(new GSmallMapControl());
			//map.addControl(new GMapTypeControl());
			map.setCenter(new GLatLng(lat,lng), zoom);
	
			var point = new GLatLng(lat, lng);
			marker = createMarker(point, name, address, type);
			map.addOverlay(marker);
		}
    }

    function createMarker(point, name, address, type) {
    	opt.icon = customIcons[type]
		var marker = new GMarker(point, opt);
		var html = "<b>" + name + "</b> <br/>" + address;
		GEvent.addListener(marker, 'click', function() {
			marker.openInfoWindowHtml(html);
		});
		return marker;
    }
    //]]>
</script>
{% endblock %}
{% block content %}

			<div class="page_title group" style="display:block; overflow:hidden; padding:10px 0 20px 0;">
            	<div class="bread-crumb clearfix">
                    <ul>
                        <li><a href="/staff/" style="background:#666;font-size:12px; padding:2px 4px; -moz-border-radius:4px;color:#FFF">Staff Home</a></li>
                        <li><a href="/staff/locality/" style="background:#666;font-size:12px; padding:2px 4px; -moz-border-radius:4px;color:#FFF">Locality</a></li>
                        <li style="background:#eee;font-size:12px; padding:2px 4px; -moz-border-radius:4px;color:#666">Manage Locality</li>
                    </ul>
                </div> 
            </div>
			<div class="page_title group" style="display:block; overflow:hidden;">
                <h2 style="float:left; display:block;width:300px; margin:0; padding-left:10px; line-height:normal">Manage Locality</h2>           
                <div class="quick_nav">							
                    <a href="/staff/locality/add/" class="thick_link_plus">Add new Locality</a>
                </div>
            </div>            
        	<div class="main" style="margin-bottom:20px;">
            	<div class="left_col">
                	<h3>Options</h3>
                	<ul class="side_menus">
                    	<li><a href="/staff/locality/" class="side_menu on">Locality Home</a></li>
                    	<li><a href="/staff/locality/zip/" class="side_menu">ZIP Codes</a></li>
                    	<li><a href="/staff/locality/addzip/" class="side_menu">Add new ZIP Code</a></li>  
						<li><a href="/staff/locality/add/" class="side_menu">Add new Locality</a></li>                        
                    </ul>                    
                </div> 	
            	<div class="main_col" style="float:left; width:740px;">
            		{% if message %}
						<div style="clear:both;"></div>
						 <div class="message">{{ message }}</div>
					{% endif %}
            		<div id="map" style="float:left;width:740px;height:140px"></div>
					<table class="staff_ctg content" align="center" cellpadding="0" cellspacing="0" width="740">
						<colgroup>
							<col width="490">
							<col width="130">							
							<col width="120">
						</colgroup>				
						<tbody>
							<tr class="head" style="">
								<th class="title"><div>Locality</div></th>
								<th class="status" style="text-align: left;"><div></div></th>
								<th class="action" style="text-align: left;"><div>Actions</div></th>
							</tr>
							{% for locality in localityall %}
							<tr class="row">
								<td><h5><a href="#" onclick="load({{ locality.latitude }}, {{ locality.longitude}}, {{ locality.zoom }},'green','{{ locality.name }}','{{ locality.zip }}','{{ locality.city.name }}');return false;" title="See Venue details">{{ locality.name }}</a></h5></td>
								<td class="status" style="width:100px;"><div>
								  </div></td>
								<td class="action">
									<div class="action_link">
										<div class="action_nav">
										<p><a href="/staff/locality/edit/?lid={{ locality.id }}" class="edit">Edit</a>&nbsp;|&nbsp <a href="/staff/locality/delete/?lid={{ locality.id }}" onclick="if(!confirm('Are you sure to delete this location?')){return false;}" class="delete">Delete</a></p>
										</div>
									</div>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
            	</div> 
			<hr />
            </div>
<script type="text/javascript">
	load({{ globalsettings.google_map_lat }}, {{ globalsettings.google_map_lon }}, {{ globalsettings.google_map_zoom }},"green","{{ globalsettings.city }}","select the location","{{ globalsettings.city }}");
</script>
{% endblock %}