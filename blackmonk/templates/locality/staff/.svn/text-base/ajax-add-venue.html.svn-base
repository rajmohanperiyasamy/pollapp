{% load i18n %}
<div id="add_venue_overall">
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.common.js"></script>

<div id="ajax_content_loading" style="display:none;padding-top:222px;padding-bottom:350px;text-align:center;">
	<img src="{{STATIC_URL}}ui/images/global/loading-s.gif"><br><p>{% trans 'Saving Venue' %}</p>
</div>

<div id="add_venue" class="modal-form">
<script type="text/javascript">
	$(document).ready(function(){
		$.validator.addMethod("time", function(value, element) {  
    	return this.optional(element) || /^(([0]?[1-9])|([1][0-2])):([0-5]?[0-9])(:([0-5]?[0-9]))?\s([AP][M])$/i.test(value);},"Please enter a valid time.");
		$("#venueform").validate({
			highlight: function(element, errorClass){$(element).parent('div').parent('div').addClass('field-error');$(element).addClass('error')},
			unhighlight: function(element, errorClass){$(element).parent('div').parent('div').removeClass('field-error');$(element).removeClass('error')},
			errorPlacement: function(error, element){},
		   	rules:{
		    	venue: "required",
		    	address1: "required",
				email:{
					required:false,
					email:true
				},
				website:{
					required:false,
					url:true
				},zip:"required"},
				submitHandler:function(){
					get_lat_lang();
					form.submit();
		
		   	}
		});
		$('#id_type').bind("change", function(){
			custom_validate();
		});
		$('#id_website').focusin(function(){
			if($('#id_website').val()==""){
				$('#id_website').val('http://www.');
			}
		});
	});
	var valid_flag=false;
	
	function validate_custom(){
		valid_flag=true
		var flag = $('#venueform').validate().form()
		var flag1=false;
		if($('#id_type').val()!=""){
			$('#id_type').parent('div').parent('div').removeClass('field-error');
			$('#id_type').removeClass('error')
			flag1=true;
		}else{
			$('#id_type').parent('div').parent('div').addClass('field-error');
			$('#id_type').addClass('error')
			flag1=false;
		}
		if(flag==true && flag1==true){
			return true;
		}else{
			return false;
		}
	}
	function custom_validate(){
		if(valid_flag){
			if($('#id_type').val()!=""){
				$('#id_type').parent('div').parent('div').removeClass('field-error');
				$('#id_type').removeClass('error')
			}else{
				$('#id_type').parent('div').parent('div').addClass('field-error');
				$('#id_type').addClass('error')
			}
		}
	}
</script>
	{% if msg %}<div class="message">{{msg}}</div>{% endif %}
	{% if form.errors %}
		<div class="messageerror" style="background:lightyellow;padding:10px;color:red;width:100%;">
			<strong>{% trans 'There is a problem with your submission' %}</strong>
            <ul style="list-style:square;margin-left:20px;">
           		{% for field in form %}
           			{% if  field.errors%}<li>{%for error in field.errors%}{{error}}{%endfor%}</li>{% endif %}
          	 	{% endfor %}
			</ul>
	 	</div>
	{% endif %}
     <form action="{% url 'staff_common_ajax_add_venue' %}{% if venue %}?id={{venue.id}}{% endif %}" name="venueform"  id="venueform" method="post" class="add_venue">{% csrf_token %}
    	<div class="fields hform">
            <div class="field-group">              
                <div class="group">
                    <div class="fields-left">
                        <p class="ltxt80">{#% trans '' %#}</p> 
                    </div> 
            		<div class="fields-left col400">                    
                        <div class="field text-field">	
                            <div class="label"><label style="white-space: pre;">{% trans 'Venue / Location Name' %}<span class="required-field">*</span></label></div>	
                            <div class="value">{{form.venue}}</div>	
                        </div>
                        <div class="field text-field">	
                            <div class="label"><label>{% trans 'Address' %}<span class="required-field">*</span></label></div>	
                            <div class="value">{{form.address1}}</div>	
                        </div>
                        <div class="field text-field">	
                            <div class="value">{{form.address2}}</div>	
                        </div>
						<div class="field text-field">	
                            <div class="label"><label>{% trans 'City' %}</label></div>	
                            <div class="value">{{ form.city }}</div>	
                        </div>
                        <div class="field text-field">	
                            <div class="label"><label>{% trans 'Zip / Postalcode' %}<span class="required-field">*</span></label></div>	
                            <div class="value">{{form.zip}}</div>	
                        </div>
                        <div class="field select-field">	
                            <div class="label"><label>{% trans 'Type' %}<span class="required-field">*</span></label></div>	
                            <div class="value">
                                {{ form.type }}
                            </div>	
                        </div>
                        <div class="field text-field">	
                            <div class="label"><label>{% trans 'Phone' %}</label></div>	
                            <div class="value">{{form.telephone1}}</div>	
                        </div>
                        <div class="field text-field">	
                            <div class="label"><label>{% trans 'Email ID' %}</label></div>	
                            <div class="value">{{form.email}}</div>	
                        </div>
                        <div class="field text-field">	
                            <div class="label"><label>{% trans 'Website' %}</label></div>	
                            <div class="value">{{form.website}}</div>	
                        </div>
                        <div class="field text-field">	
                            <div class="label"><label>{% trans 'Note' %}</label></div>	
                            <div class="value">{{form.description}}</div>	
                        </div>
					</div> <!--/--> 
                    <div class="map-right col300">
                        <div class="map-container">
                            <div class="map-head">
                                <h4>{% trans 'Change map marker location' %}</h4>
                                <p>{% trans 'Use the mouse to pick up your marker and drag it to your street address.' %} <!-- Use the tools in the upper left corner of the map to pan and zoom for a better view. --></p>
                            </div>                                        
                            <div style="width: 298px; height: 308px;position: relative; background-color: rgb(229, 227, 223);" id="map"></div>
                        </div>                                            
                    </div> <!--/-->
            	</div>            
            </div>                        
		</div>    
        <div class="modal-base form-submit group">
           <button role="button" class="cform-button prime right" onclick="save_venue(),validate_custom()" type="button"><span class="cform-button-text">{% trans 'Save' %}</span></button>
        </div>           
    </form>
    <script type="text/javascript" src="{{STATIC_URL}}ui/js/inline.js"></script>
</div>
<script type="text/javascript">
$(document).ready(function(){
	$( "#id_zip" ).autocomplete({
			source: '{% url 'staff_common_auto_suggest_zip' %}',
		   	select: function(event, ui) {
     			$("#id_zip").val(ui.item.id);
     	 	}
	});
    function get_lat_lang(){
		var lat_lng = marker.getPosition();
		var zoom = map.getZoom();
		$('#lat_lng').val(lat_lng);
		$('#zoom').val(zoom);
	}
	setTimeout(function() {
		{% if venue %}
			load_for_add('map',{{ venue.lat }}, {{ venue.lon }}, {{ venue.zoom }},"{{ venue.venue }}","{{venue.address1}}<br>{{ globalsettings.city }} - {{venue.zip}}");
		{% else %}
			load_for_add('map',{{ globalsettings.google_map_lat }}, {{ globalsettings.google_map_lon }}, {{ globalsettings.google_map_zoom }},"{{ globalsettings.city }}","{{ globalsettings.city }}");
		{% endif %}
	}, 500);
});
$(document).ready(function(){
	$('#id_zip').live("keyup",function(){getPin(getaddress(),$('#id_zip').val());});
});
function getaddress(){return $('#id_address1').val()+" "+$('#id_address2').val()+" "+$('#id_venues').val()}
</script> 
</div>     