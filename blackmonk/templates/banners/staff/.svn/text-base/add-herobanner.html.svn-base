{% extends "staff_base.html" %}
{% load tabs %}
{% load upload_tags %}
{% load i18n %}
{% block navigation %}
    {% activetab "selmodule" "banners" %}
    {{ block.super }}
{% endblock %}
{% block pagetitle %}{% trans 'Banner Ads' %} {% endblock %}
{% block head %}
<style>
    .bm_faded{opacity:0.5;pointer-events:none;}
    .preview.preview_banner_zones > ul {
        margin-bottom: 10px;
    }
    .preview.preview_banner_zones li {
        color: #666666;
        font-size: 12px;
    }
    .preview.preview_banner_zones li span {
        display: inline-block;
        font-weight: bold;
        margin-right: 10px;
        text-align: right;
        width: 50px;
    }
</style>
<!-- CALENDER -->
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}themes/green/css/LE_MetaId99.css">
<!-- CALENDER -->
<link type="text/css" rel="stylesheet" href="{{STATIC_URL}}css/bm.jfp.ui.css">
{% endblock %}
{% block content %}
 <div id="staff-platform" class="group">
    <div class="header-bar">
        <a href="{% url 'staff_banners_manage_hero_banners' %}"><h2><span class="go_back"></span>{% trans 'Hero Banners' %}</h2></a>
    </div>
    <div id="core-wraper" class="group">
        <div class="staff-main">
            <div class="page-wrap">
                <div id="business-add" class="group">
                    <div id="add-new-business">
                        {% if form.errors %}
                            <div class="messageerror" >
                                <span style="font-size:1.2em;font-weight:250;"><strong>{% trans "There is a problem with your submission" %}</strong></span>
                                {% if form.errors %}
                                <ul>{% for field in form %}
                                     {% if field.errors%}<li>{%for error in field.errors%}{{error}}{%endfor%}</li>{% endif %}
                                 {% endfor %}</ul>
                                {% endif %}
                            </div>
                        {% endif %}
                        <form id="mform" name="mform" action="{% url 'staff_banners_add_hero_banner' %}{% if banner_obj %}?bid={{banner_obj.id}}{% endif %}" method="post"  enctype="multipart/form-data">{% csrf_token %}
                            <div class="fields hform">
                                <div class="field-group">              
                                    <div class="field text-field fd-title">
                                        <div class="label"><label for="">Caption<span class="required-field">*</span></label></div>
                                        <div class="value">
                                            {{form.title}}
                                        </div>
                                    </div>
                                </div> <!--/field-group--> 
                               <div class="clear"></div>
                                
                                <div class="field-group cr_wmr">
                                    <div class="field text-field">
                                        <div class="label"><label for="">Open in a new window</label></div>
                                        <div class="value">
                                            {{form.is_new_tab}}
                                            <!--span class="cform-radio-container">{{form.is_new_tab}}<span class="cform-radio-element"></span></span-->
                                        </div>
                                    </div>
                                    <div class="field text-field">
                                        <div class="label"><label for="">Banner Ordering<span class="required-field">*</span></label></div>
                                        <div class="value">
                                            {{form.display_order}}
                                        </div>
                                    </div>
                                    <div class="field text-field">
                                        <div class="label"><label for="">Destination URL</label></div>
                                        <div class="value">
                                            {{form.destination_url}}
                                        </div>
                                    </div>
                                    <div id="id_upload_banner_div" style="display:{% if banner_obj and banner_obj.is_script %}none;{% else %}block;{% endif %}">
                                        <div class="field text-field">
                                            <div class="label"><label for="">:</label></div>
                                            <div class="value">
                                                <input type="hidden" value="{% if form.instance.image %}1{% else%}0{% endif %}" id="id_img_hidden_field">
                                                {% if form.instance.image and not form.errors %}
                                                    <div style="width:100px; position:relative;">
                                                        <a href="javascript:void(0);" onclick="banner_image_large_preview('{% url 'staff_banners_banner_image_preview' %}?bid={{banner_obj.id}}','{{banner_obj.caption}}');" title="{% trans 'Large Preview' %}" ><img src="{{banner_obj.image.url}}"  width="100" /></a>
                                                        <span onclick="if(confirm(gettext('Are you sure you want to delete the banner?'))){remove_uploaded_banner($(this),'{{banner_obj.id}}');return false;}" style="background:url('{{STATIC_URL}}ui/images/icons/c/97-C3.png') no-repeat scroll 50% center transparent; width:16px; height:16px; display:block;position:absolute; top:0; right:0; cursor:pointer;"></span>
                                                    </div>
                                                {% endif %}    
                                                <div id="id_upload_imgae_div" {% if not form.errors and form.instance.image %}style="display:none;"{% endif %}>{{form.image}}</div>               
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="clear"></div>
                            </div> <!--/fields-->
                            <div class="form-submit right group">
                               <button class="cform-button" roll="button" type="button" onclick="window.location.replace('{% url 'staff_banners_manage_hero_banners' %}')"><span class="cform-button-text">{% trans 'Cancel' %}</span></button>
                               <button role="button" class="cform-button prime" name="draft" type="submit"><span class="cform-button-text">{% trans 'SAVE' %}</span></button>
                            </div>                                                
                        </form>
                    </div>                                                                                                            
                </div> <!-- end table -->                                    
            </div><!-- end page wrap -->
        </div>  <!-- end main-col -->                            
    </div>                            
</div>
{% endblock %}            
{% block footer_include %}
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.ui.datepicker.js"></script>
{% upload_js %}
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.jfp.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.fup.appln.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/ads/staff_banner.js"></script>
<script type="text/javascript">

$(document).ready(function(){

    $('#id_destination_url').focusin(function(){
        if($('#id_destination_url').val()==""){
        	$('#id_destination_url').val('http://www.');
        }
    });
	$('#id_image').bind("change", function(){
		$("#mform").validate().element($(this));
	});
    $('#id_destination_url').focusout(function(){
    if($('#id_destination_url').val()=='http://www.'){
			$('#id_destination_url').val('');
	        $(this).parent('div').parent('div').removeClass('field-error');$('#id_destination_url').removeClass("error");    
        }
    });
    
    $.validator.addMethod("img_required", function(value, element) {  
        //if($('#id_is_script_1').is(':checked')){return false;}      
        if($('#id_is_script_1').is(':checked')){if($('#id_img_hidden_field').val()=='0'){if($.trim($('#id_image').val())==''){return false;}else{return true;}}else{return true;}}                                                       
        else{return true;}
    },"Please upload image.");
    $.validator.addMethod("time", function(value, element) {  
    return this.optional(element) || /^(([0]?[1-9])|([1][0-2])):([0-5]?[0-9])(:([0-5]?[0-9]))?\s([AP][M])$/i.test(value);},gettext("Please enter a valid time."));
    $("#mform").validate({
        ignore: "",
        highlight: function(element, errorClass){add_error_class(element)},
        unhighlight: function(element, errorClass){remove_error_class(element)},
        errorPlacement: function(error, element){},
           rules:{
            title: "required",
            display_order: "required",
            image:"img_required",
            destination_url:{required:false},
           },
        submitHandler:function(){
            get_lat_lang();
            form.submit();
        }
    });   
});

function check_form_is_valid(){
   //ev.preventDefault();                                
   //evt.stopPropagation();                          
   var success = $('#mform').validate().form();
   if (success){return true;} 
   else{return false;} 
}

function remove_uploaded_banner(hobj,bid){
  $.get("{% url 'staff_ajax_delete_herobanner_image' %}",{ bid: bid },function(data){
         if(data=='1'){$(hobj).parent('div').fadeOut('slow').remove();$('#id_img_hidden_field').val('0');$('#id_upload_imgae_div').show();}
         else{alert('Oops..!! error while deleting logo');}
  });
}

function banner_image_large_preview(url,title){
  $.colorbox({width: "800",initialWidth: "800", top:"5%", initialHeight: "200", href:url, title:title });                        
}

</script>

{% endblock %}    
                