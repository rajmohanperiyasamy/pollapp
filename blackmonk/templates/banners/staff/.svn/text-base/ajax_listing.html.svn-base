{% load i18n %}	
{% load ds_utils %}
{% load thumbnail %}	
<script type="text/javascript">
var main_url = "{{ globalsettings.website_url }}";
</script>
<!-- script type="text/javascript" src="{{STATIC_URL}}ui/js/application.js"></script -->
<input type="hidden" value="{{status}}" name="id_status" id="id_status">
<input type="hidden" value="{{listing_type}}" name="id_listing_type" id="id_listing_type">
<input type="hidden" value="{{created}}" name="id_created" id="id_created">
<input type="hidden" value="{{sort}}" name="id_sort" id="id_sort">
<input type="hidden" value="" name="id_action" id="id_action">
<input type="hidden" value="{% url 'staff_banners_ajax_banner_actions' %}" name="id_banner_action" id="id_banner_action_url">
<input type="hidden" value="{% url 'staff_banners_ajax_list_banners' %}" name="id_banner_listing_url" id="id_banner_listing_url">
<input type="hidden" value="{% url 'staff_banners_ajax_banner_state' %}" name="banner_state_url" id="id_banner_state_url">
<input type="hidden" value="{% if search %}{{search}}{% endif %}" name="id_search" id="id_search">

{% if banners %} 
<ol class="data-table table-lists-container" id="ajax_content_list">
	{% for buz in banners %}
	<li class="table-list" id="li_{{buz.id}}">
			<div class="table-list-container check-item has-thumb110 group">
		 	<span class="checkbox-wrap">
				<span class="cform-checkbox-container"><input type="checkbox" onclick="fix_action()" status="{{buz.status}}" value="{{buz.id}}" id="id_checkbox_{{buz.id}}" name="artCulture" class="check-overflow cbox check_action"><span class="cform-checkbox-element"></span></span>
			</span>
            <div class="item-media">
            	<a href="{% url 'staff_banners_preview_banner' %}?bid={{buz.id}}" class="inline-block">
                    <span class="item-thumb thumb-110">
                        <span class="thumb-in">
                            <span class="thumb"><img src="{% if buz.image %}{% thumbnail buz.image 110x0 %}{% else %}{{ buz.get_default_image }}{% endif %}" alt="{{gal.title}}" class="inline-block"><span class="inline-block h100"></span></span>
                        </span>
                    </span>
				</a>                                                            
            </div> 
			{% get_payment_mode id=buz.id type='banner advertisements' as payments%}
			<div class="item-info relative-block">
                <h3 class="title"><a href="{% url 'staff_banners_preview_banner' %}?bid={{buz.id}}">{{buz.caption}}</a></h3>
                <p class="ltxt80">
                	<span>Section: {{buz.section.name}}</span> <span class="divider12">|</span> Zone: {{buz.zones}}
				</p> 
				<p class="ltxt80">
					{% trans 'By' %} <a href="{% url 'user_profile' buz.created_by.profile_slug %}">{{buz.created_by.display_name}}</a> 
					<span class="divider12">|</span>{{buz.created_on|date:"M d, Y"}}
				</p>
				{%if payments %}<p class="ltxt80">Payment Mode: {{payments.payment_mode}} & Payment Status: {% if buz.is_paid%}Paid{%endif%}{% endif %} 
                <ul class="quick-stats group">
                    <li class="views"><a class="tttxt" href="javascript:void(0)" title="{% trans 'Views' %}"><span class="inline-block icon-view-stats"></span>{{buz.get_total_banner_views}}</a></li>
                    <li class="cmnt"><a class="tttxt"title="{% trans 'clicks' %}" href="javascript:void(0)"><span class="inline-block icon-cmnt-stats"></span>{{buz.get_total_banner_clicks}}</a></li>
                </ul>
                <div class="item-status {% if forloop.counter == 1 %}tip tip9{% endif %} {% if not perms.business.publish_business %}no-options{% endif %} dev_hide_list_status" onclick="display_change_status({{buz.id}},$('#id_estatus_{{buz.id}}').attr('name'));">
                	<span class="status-inside inline-block" id="id_span_chge_sts_{{buz.id}}">
					<span title="{{buz.get_status|capfirst}}" name="{{buz.status}}" id="id_estatus_{{buz.id}}" class="inline-block tttxt status-idty icon-{{buz.get_status}}"></span>	 
                    {% if not perms.business.publish_business %}</span>{% endif %}
	                    <span class="arrow"></span></span>
						<ul class="dropdown-list" id="change_status_id_{{buz.id}}">
							<li><strong>{% trans 'Update status to...' %}</strong></li>
							<ul id="id_dis_status_{{buz.id}}">
	                       	</ul>
	                    </ul>
                </div>                                                        
            </div>
            <div class="action-buttons {% if forloop.counter == 1 %}tip tip10{% endif %}">
                <div class="relative-block">
                    <span class="item-manage inline-block dev_hide_list_settings" id="id_span_settings_{{buz.id}}" onclick="display_settings({{buz.id}});"><span class="action-icon icon-manage"></span></span>
                    <ul class="dropdown-list dev_settingsdrpdwn" id="settings_id_{{buz.id}}" style="display:none">
							<li><a title="{% trans 'Edit this Banner' %}" href="{% url 'staff_banners_add_banner' %}?bid={{buz.id}}">{% trans 'Edit' %}</a></li>
							<li><a title="{% trans 'Traffic Reports' %}" href="{% url 'staff_banners_banner_traffic_reports' %}?bid={{buz.id}}" >{% trans 'View Traffic Reports' %}</a></li>
							<li><span class="line-break"></span></li>
            	        	<li><a onclick="if(confirm(gettext('Are you sure you want to delete the Banner ?'))){filter_action({{buz.id}},'DEL');return false;}" href="javascript:void(0)">{% trans 'Delete' %}</a></li>
                    </ul>
				</div>                                                              	                                                         
            </div>
        </div>
    </li> 
	{% endfor %}
	</ol>
	<div id="pagenation">
		{% include 'common/pagination_ajax.html'%}  
	</div> 
	<script>
	function status_function(id,status){
			$('#id_dis_status_'+id).html('');
			if(status=='P'){
				ahtml = '<li><a onclick="save_status('+id+',\'B\');" href="javascript:void(0);">{% trans 'Blocked' %}</a></li>'
				$('#id_dis_status_'+id).append(ahtml);
			}
			else if(status=='N'){
				ahtml = '<li><a onclick="save_status('+id+',\'P\');" href="javascript:void(0);" >{% trans 'Publish' %}</a></li>'
				ahtml+= '<li><a onclick="save_status('+id+',\'R\');" href="javascript:void(0);" >{% trans 'Reject' %}</a></li>'
				$('#id_dis_status_'+id).append(ahtml);
			}
			else if(status=='B'){
				ahtml = '<li><a onclick="save_status('+id+',\'P\');" href="javascript:void(0);" >{% trans 'Publish' %}</a></li>'
				$('#id_dis_status_'+id).append(ahtml);
			}
			else if(status=='R'){
				ahtml = '<li><a onclick="save_status('+id+',\'P\');" href="javascript:void(0);" >{% trans 'Publish' %}</a></li>'
				$('#id_dis_status_'+id).append(ahtml);
			}
			else if(status=='D'){
				ahtml = '<li><a onclick="save_status('+id+',\'P\');" href="javascript:void(0);" >{% trans 'Publish' %}</a></li>'
				$('#id_dis_status_'+id).append(ahtml);
			}
			else{
				$('#change_status_id_'+id).hide();
				$('#id_span_chge_sts_'+id).removeClass('active')
				return false;
			}
		}
	function save_status(id,status){
		$('#id_estatus_'+id).addClass('loading');
		var DataString="id="+id+"&status="+status;
		$.ajax({
			type: "GET",
			url: "{% url 'staff_banners_ajax_change_banner_status' %}",
			data: DataString,
			success: function(data){
				if(data!=0){
					$('#id_estatus_'+id).removeClass('loading');
					$('#id_estatus_'+id).replaceWith(data);
					$('#change_status_id_'+id).hide();
					$('#id_span_chge_sts_'+id).removeClass('active')
					$('#id_checkbox_'+id).attr('status',status);
					show_count('all');
				}else{
					$('#change_status_id_'+id).hide();
					$('#id_span_chge_sts_'+id).removeClass('active')
					$('#id_estatus_'+id).removeClass('loading');
					alert(gettext('Oops!!! Not able to process your request.'));
				}
			}
		});
	}
</script> 
	{% else %}
		<div class="no-data"><p>{% trans 'Sorry , No Banners found !' %}</p></div>
{% endif %}   