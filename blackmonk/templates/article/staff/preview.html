{% extends "staff_base.html" %}
{% load tabs %}
{% load i18n %}
{% load thumbnail %}
{% load upload_tags %}
{% load truncate_filter %}
{% block navigation %}
	{% activetab "selmodule" "article" %}
	{{ block.super }}
{% endblock %}
{% block pagetitle %}{% trans 'Article - Preview' %} {% endblock %}
{% block head %}
	

{% endblock %}
{% block content %}
 <div id="staff-platform" class="group">
                  	<div class="header-bar has-preview-head">
                        <h2>Articles</h2>
                        <section class="sub-header-bar">
                            <div class="preview-head">
                            	{% if article.featured %}
				        		<span class="list-type featured-item"><a class="tttxt" original-title="{% trans 'Item listed as featured' %}" href="javascript:void(0);">{% trans 'Featured' %}</a></span>
						 		{% endif %}
                                <div class="item-title">
                                    <h1>{{ article.title|truncate_chars:80 }}</h1>
                                    <p class="ltxt80">By <a href="{% url 'user_profile' article.created_by.profile_slug %}">{{article.created_by.display_name}}</a> <span class="divider12">|</span> {{article.created_on|date:"M d, Y"}}</p>
								</div>                                   
                                <ul class="status-tabs group">
                                    <li>{{article.most_viewed}}<span class="meta">{% trans 'views' %}</span> </li>
                                    <!--li> <a href="javascript:void(0)">0<span class="meta">{% trans 'comments' %}</span></a> </li-->
                                </ul>                                
                            </div>                                
                        </section>                          
                    </div>
                    <div id="core-wraper" class="group">
                        <div class="staff-main">
                            <div class="page-wrap">
                                <div id="article-preview" class="preview-center group">
                                    <div class="preview-items">
                                        <div class="preview-group">  
                                        	<div class="preview-items-head">
												{% if perms.article.change_article %}
                                                <div class="right-item"><a href="{% url 'staff_article_add_article' %}?aid={{article.id}}"><div class="cform-button"><span>{% trans 'Edit' %}</span></div></a></div>
                                            	{% endif %}
												<h3 style="vertical-align:top">{% trans 'Article Details' %}</h3>
                                            </div>            
                                            <div class="preview-item title">
                                                <div class="label"><h4>{% trans 'Title' %}</h4></div>
                                                <div class="value">{{ article.title|truncate_chars:80 }}</div>
                                            </div> 
                                            <div class="preview-item date-time">
                                                <div class="label"><h4>{% trans 'Category' %}</h4></div>
                                                <div class="value">
                                                	<span class="date">{{ article.category.name }}</span> 
												</div>
                                            </div>
											{% if article.summary %}                                           
                                            <div class="preview-item description">
                                                <div class="label"><h4>{% trans 'Summary' %}</h4></div>
                                                <div class="value">
                                                	<div class="description basic-editor-content">
                                                    	<p>{{article.summary}}</p>
                                                	</div>
												</div>
                                            </div>
											{% endif %}
											{% if article.content %}                                           
                                            <div class="preview-item description">
                                                <div class="label"><h4>{% trans 'Content' %}</h4></div>
                                                <div class="value">
                                                	<div class="description basic-editor-content">
                                                    	{% autoescape off %}{{article.content}}{% endautoescape %}
                                                	</div>
												</div>
                                            </div>
											{% endif %}
											{% if article.tags.all %}  
                                            <div class="preview-item tags">
                                                <div class="label"><h4>{% trans 'Tags' %}</h4></div>
                                                <div class="value">
                                                	<span class="note">{% for tag in article.tags.all %}<a href="javascript:void(0)">{{ tag.tag }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}</span>
												</div>
                                            </div> 
											{% endif %}
											{% if article.venues.all %}
                                            <div class="preview-item address map">
                                                <div class="label"><h4>{% trans 'Venue' %}</h4></div>
                                                <div class="value">
													<div class="inline-block map-preview"  style="width: 190px; height: 140px;" id="map"></div>                                               
	                                                	<div class="inline-block valign-top" style="width:324px;">
                                                        {% for venue in article.venues.all %}
														<div>      
														<span class="address-name"><strong>{{ venue.venue }}</strong></span>                             
                                                        <span class="address-details">{{ venue.address1 }}{% if venue.address2 %},{{ venue.address2 }}{% endif %}{% if venue.zip %} - {{ venue.zip }}{% endif %}</span>                             
                                                       	{% if venue.email %}<span class="address-number">{% trans 'Email:' %} {{ venue.email }}</span>{% endif %} 
														{% if venue.website %}<span class="address-number">{% trans 'Website:' %} {{ venue.website }}</span>{% endif %} 
														{% if venue.mobile %}<span class="address-number">{% trans 'Mobile:' %} {{ venue.mobile }}</span>{% endif %}
														{% if venue.telephone %}<span class="address-number">{% trans 'Phone:' %} {{ venue.telephone }}</span>{% endif %}
														<script type='text/javascript'>total_address={{ forloop.counter }};</script>
														</div>
														{% endfor %}
													</div>                                                        
                                                </div>
                                            </div>
 											{% endif %}
											{% if article.album.get_gallery_uploaded_images %}  
                                            <div class="preview-item medias">
                                                <div class="label"><h4>{% trans 'Photos' %}</h4></div>
                                                <div class="value">
                                                    <div class="item-photos">
                                                        <ul class="fxslider">
                                                        	{% for photo in article.album.get_gallery_uploaded_images %}
                                                            <li class="inline-block" data-src="{{photo.photo.url}}">
                                                                <div class="photos-preview"><img style="height: 90px;" src="{% thumbnail photo.photo 110x0 %}"><a class="icon-view preview-item" title="{% trans 'Large preview' %}" href="#"></a></div>
                                                            </li>
															{% endfor %}
                                                        </ul>
                                                    </div>
												</div>
                                            </div>
											{% endif %} 
                                        </div>   
                                    </div>                                            
                                </div><!-- end table -->
                            </div> <!-- end page wrap -->
                        </div> <!-- end main-col -->                            
                        <!--div id="aside" class="side-bar">
                        	<div class="preview-aside-meta group">
                                <ul class="side-navigation">
                                    <li class="active"><a href="#">{% trans 'Article Details' %}</a></li>
                                    <!--li><a href="#">{% trans 'Comments' %}</a></li-->
                                </ul>
								<!--div class="preview-item-stats">
									<a href="#" class="btn-txt-blue" style="display:block; text-align:center"><span class="btn-txt">{% trans 'Preview this Article' %}</span></a>
                                </div>                                
							</div>       
                            
                        </div-->                            
                    </div>                                                    
				</div>
{% endblock %}
{% block footer_include%}
<script src="http://maps.googleapis.com/maps/api/js?v=3&sensor=false{% if globalsettings.google_map_key %}&key={{ globalsettings.google_map_key }}{% endif %}" type="text/javascript"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/general/google_map.js"></script>
<script src="{{STATIC_URL}}themes/js/fxslider.js"></script>
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}ui/css/fxslider.css" />
<script type="text/javascript">
$(document).ready(function(){
 $(".fxslider").fxslider();
});
</script>
{% if article.venues.all %}
<script type="text/javascript">
var markers=[];
total_address=0;
$(document).ready(function(){
	{% for addr in article.venues.all %}
		var marker = new Object();
		marker["lat"] = {{addr.lat}};
		marker["lng"] = {{addr.lon}};
		marker["zoom"] = {{addr.zoom}};
		marker["name"] = "{{ article.name }}";
		marker["address"] = "{{ addr.address1|escape|linebreaks }}{{ addr.city }} - {{addr.zip }}";
		markers.push(marker);
		total_address=total_address+1;
	{% endfor %}
	var map_height = total_address*120;
	map_height = map_height+'px';
	document.getElementById("map").style.height=map_height;
	load_multi_marker('map',{{ article.venues.all.0.lat }}, {{ article.venues.all.0.lon }}, {{ globalsettings.google_map_zoom }},markers)				
});
</script>
{% endif %}
{% endblock %}