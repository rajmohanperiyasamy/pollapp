{% extends "staff_base.html" %}
{% load tabs %}
{% load ds_utils %}
{% load i18n %}
{% load upload_tags %}
{% load truncate_filter %}
{% load thumbnail %}
{% block navigation %}
	{% activetab "selmodule" "movies" %}
	{{ block.super }}
{% endblock %}
{% block pagetitle %} {{movie_preview.title}} | {% trans 'Movie Preview ' %} {% endblock %}
{% block head %}

{% endblock %}
{% block content %}
                <div id="staff-platform" class="group">
                  	<div class="header-bar has-preview-head">
                        <h2><a href="{% url 'staff_display_movie' %}">{% trans 'Movies ' %}</a></h2>
                        <section class="sub-header-bar">
                            <div class="preview-head">
                                <div class="item-title" style="width: 100%;">
                                    <h1>{{movie_preview.title|truncate_chars:110}}</h1>
                                    <p class="ltxt80"><span class="divider12">By</span><a href="{% url 'user_profile' movie_preview.created_by.profile_slug %}">{{movie_preview.created_by.display_name}}</a><span class="divider12">|</span>{{movie_preview.created_on}}</p>
								</div>                                   
                                <!--ul class="status-tabs group">
                                    <li>
                                        3,203
                                        <span class="meta">views</span>
                                    </li>
                                    <li>
                                        <a href="#">
                                            146
                                            <span class="meta">likes</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            4
                                            <span class="meta">comments</span>
                                        </a>
                                    </li>
                                </ul-->                                
                            </div>                                
                        </section>                          
                    </div>
                    <div id="core-wraper" class="group">
                        <div class="staff-main">
						    <div class="page-wrap" >
                                <div id="articles-preview" style="display:{% if showtimes or review %}none;{% else %}block;{% endif %}" class="preview-center group">
                                    <div class="preview-items">
                                        <div class="preview-group">  
                                        	<div class="preview-items-head">
                                                <div class="right-item" >
													<a href="{% url 'staff_movie_edit_movie' %}?id={{movie_preview.id}}">	
														{% if perms.movies.change_movies %}
														<div class="cform-button" >
															<span>{% trans 'Edit'%}</span>
														</div>
														{% endif %}
													</a>
												</div>
                                            	<h3 style="vertical-align:top">{% trans 'Movie Details'%}</h3>
                                            </div>            
                                            <div class="preview-item title">
                                                <div class="label"><h4>{% trans 'Title'%}</h4></div>
                                                <div class="value">{{movie_preview.title}}</div>
                                            </div> 
                                            <div class="preview-item date-time">
                                                <div class="label"><h4>{% trans 'Releasing  Date'%}</h4></div>
                                                <div class="value">
                                                	<span class="date">{% if movie_preview.release_date %}{{movie_preview.release_date}}{% else %}{% trans 'N/A'%}{% endif %}</span> 
												</div>
                                            </div>
											{% if movie_preview.movie_url %}
                                            <div class="preview-item email">
                                                <div class="label"><h4>{% trans 'Movie Preview URL'%}</h4></div>
                                                <div class="value">
													<a target="_blank" {% if movie_preview.movie_url %}href="{% if movie_preview.is_vimeo %}http://www.vimeo.com/{{movie_preview.movie_url}}{% else %}http://www.youtube.com/watch?v={{movie_preview.movie_url}}{% endif %}"{% endif %}>{% if movie_preview.movie_url %}{% if movie_preview.is_vimeo %}http://www.vimeo.com/{{movie_preview.movie_url}}{% else %}http://www.youtube.com/watch?v={{movie_preview.movie_url}}{% endif %}{% endif %}</a>
												</div>
                                            </div>   
											{% endif %}
                                            <div class="preview-item url">
                                                <div class="label"><h4>{% trans 'Website/Profiles' %}</h4></div>
                                                <div class="value">
                                                	<span class="url">
                                                        {% if movie_preview.web %}<a href="{{movie_preview.web}}" target="_blank">{{movie_preview.web}}</a><br>{% endif %}
                                                       	{% if movie_preview.facebook_url %} <a href="{{movie_preview.facebook_url}}" target="_blank">{{movie_preview.facebook_url}}</a><br>{% endif %}
														{% if movie_preview.googleplus %} <a href="{{movie_preview.googleplus}}" target="_blank">{{movie_preview.googleplus}}</a><br>{% endif %}
                                                    </span>
												</div>
                                            </div>
                                            <div class="preview-item phone">
                                                <div class="label"><h4>{% trans 'Box office phone No:'%}</h4></div>
                                                <div class="value">
                                                	<span class="price">{% if added.0.theatre.boxoffice_no %}{{added.0.theatre.boxoffice_no}}{% else %}{% trans 'N/A'%}{% endif %}</span>
												</div>
                                            </div>                                            
                                            <div class="preview-item url">
                                                <div class="label"><h4>{% trans 'Online Ticket' %}</h4></div>
                                                <div class="value">
                                                	<span class="price">{% if added.0.theatre.tkt_url %}<a href="#" target="_blank">{{added.0.theatre.tkt_url}}</a>{% else %}{% trans 'N/A'%}{% endif %}</span>
												</div>
                                            </div>  
											       
											<div class="preview-item note">
                                                <div class="label"><h4>{% trans 'Director' %}</h4></div>
                                                <div class="value">
                                                	<span class="note">{% if movie_preview.director %}{{movie_preview.director}}{% else %}{% trans 'N/A'%}{% endif %}</span>
												</div>
                                            </div>   
											              
											<div class="preview-item note">
                                                <div class="label"><h4>{% trans 'Cast' %}</h4></div>
                                                <div class="value">
                                                	<span class="note">{% if movie_preview.cast %}{{movie_preview.cast}}{% else %}{% trans 'N/A'%}{% endif %}</span>
												</div>
                                            </div>   
											 {% if movie_preview.duration_hours %}
											<div class="preview-item note">
                                                <div class="label"><h4>{% trans 'Runtime' %}</h4></div>
                                                <div class="value">
                                                	<span class="note">{{movie_preview.duration_hours}}</span>
												</div>
                                            </div>  
											{% endif %}											                                             
                                            <div class="preview-item description">
                                                <div class="label"><h4>{% trans 'Description' %}</h4></div>
                                                <div class="value">
                                                	<div class="description basic-editor-content">
                                                    	{% if movie_preview.synopsis %}{% autoescape off %}{{movie_preview.synopsis}}{% endautoescape %}{% else %}{% trans 'N/A'%}{% endif %}
                                                	</div>
												</div>
                                            </div>
                          
                                            <div class="preview-item medias">
                                                <div class="label"><h4>{% trans 'Photos'%}</h4></div>
                                                <div class="value">
                                                    <div class="item-photos">
														 <ul class="fxslider">
														 	{% for photo in movie_preview.get_movie_photo %}
                                                            <li class="inline-block" data-src="{{photo.photo.url}}">
                                                                <div class="photos-preview"><img src="{% thumbnail photo.photo 110x0 %}"><a class="icon-view preview-item" href="#"></a></div>
                                                            </li>
															{% endfor %} 
                                                        </ul>
                                                    </div>
												</div>
                                            </div>                                                                                        
                                        </div>   
                                    </div>                                            
                                </div><!-- end table -->
								
								
								<!------------------  Showtimes -->
								
								<div id="showtimes" style="display:{% if showtimes %}block;{% else %}none;{% endif %}}" class="preview-center group">
                                	<div class="preview-group">
                                		{% if  movie_preview.get_theatres %}
                                        <div class="preview-items-head group">
                                            	<div class="right-item movie-showtimes" title="Add Showtime" href="{% url 'staff_movie_ajax_add_showtime' %}?movie_id={{movie_preview.id}}"><div class="cform-button prime"><span>Add Showtimes</span></div></div>
										<h3>{% trans 'Show Times' %}</h3>
                                    </div> 
										{% endif %}
										<ol class="data-table-inset">
                                        	<li class="table-list-row-head">
                                            	<div class="table-list-row-inner group">
                                                    <div class="table-list-coloumn w220 txt-right">{% trans 'Theater' %}</div>	
                                                    <div class="timings">{% trans 'Showtimes' %}</div>	
												</div>                                                    
                                            </li>
										{% for x in movie_preview.get_theatres %}
                                        	<li class="table-list-row manage-items" id="show_times_li_{{x.id}}">
											    <div class="table-list-row-inner group">
                                                	<div class="table-list-coloumn w220 txt-right">
														<h3>{{x.theatre.name}}</h3>
                                                        <p class="subhead">{{x.theatre.address1}}</p>                                                    
													</div>
													<div class="timings">
														{% autoescape off %}
												        {% for show in x.get_shows %}
                                                    	<div class="rw">
                                                            <span class="date">{{show.date|date:"D, dS M"}}</span>
                                                            <p class="grid">{% split_show_times show.show_times %}<!--{{ show.show_times }}--></p>
                                                    	</div>
														{% endfor %}
				                                        {% endautoescape %}
                                                        {% if x.is_all_shows_over %}
                                                        <div class="" style="
                                                           background-color: #fcf8e3;
                                                           border: 1px solid #faebcc;
                                                           color: #8a6d3b;
                                                           font-size: 13px;
                                                           padding: 10px;
                                                           border-radius: 5px;
                                                                            "><strong style="
                                                           font-weight: bold;
                                                        ">Warning : </strong> All the above showtime details has been expired, Please update or clear the entries.</div>
                                                        {% endif %}
                                                    </div>
                                                    {% for a in added %}	
													 <div class="action-buttons">
													    <a href="{% url 'staff_movie_edit_showtime_ajax' %}?id={{x.id}}"  class="tttxt-n edit_movie_lightbox"  title="Edit Showtime"><span class="action-icon icon-edit"></span></a>                                                    
													    <a href="javascript:void(0)" class="tttxt-n" onclick="delete_showtime({{x.id}});" original-title="Delete"><span class="action-icon icon-delete"></span></a>
                                                  	</div>
													{% endfor %}
                                                </div>
											</li>
                                        {% endfor %} 
                                        	                                           
                                        </ol> <!-- end table -->
										{% if not  movie_preview.get_theatres %}
										  <div class="no-data">
                                        	<p>{% trans 'No showtimes found for this movie.'%}</p>
                                            <div class="button-insde">
											{% if perms.movies.change_movies or perms.movies.add_movies%}
                                            	<span class="btn-txt-inline-prime critic-review-lightbox" href="{% url 'staff_movie_ajax_add_showtime' %}?movie_id={{movie_preview.id}}" title="Add Showtime"><span class="btn-txt">{% trans 'Add Showtimes' %}</span></span>
                                            {% endif %}
											</div>
                                         </div>
										{% endif %}
										
									</div>
                                </div>
								
								<!---  Show Times End -->
								
						<!---   Critic Review -->	
						  <div id="critic-review"  style="display:{% if review %}block;{% else %}none;{% endif %}}" class="preview-center group">
							{% include 'movies/staff/load_latest_review.html' %}	
                          </div><!-- end table -->
						<!--    Critic Review -->	
								
                            </div> <!-- end page wrap -->
							
							
                        </div> <!-- end main-col -->                            
                        <div id="aside" class="side-bar">
                        	<div class="preview-aside-meta group">
                                <ul class="side-navigation">
                                    <li id="conten_preview"{% if showtimes or review %}class="inactive"{% else %}class="active"{% endif %}><a href="javascript:void(0)" onclick="show_details()">{% trans 'Movie Details'%}</a></li>
                                    <li id="critic_preview"{% if review %} class="active"{% endif %}><a href="javascript:void(0);" onclick="critic_show();">{% trans 'Critic Reviews' %}</a></li>
                                    <li id="show_preview" {% if showtimes %} class="active"{% endif %}><a onclick="showtimes_show()" href="javascript:void(0)">Showtimes</a></li>
									<!--{% url 'staff_movie_ajax_add_showtime' %}?movie_id={{movie_preview.id}}" -->
                                </ul>
							</div>                                
                               {# include 'movies/staff/movie-preview-faq.html' #}                              
                        </div>                            
                    </div>                                                    
				</div>

{% endblock %}				
{% block footer_include %}
 <script type="text/javascript" src="{{STATIC_URL}}ui/js/jquery.ui.autocomplete.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/movies/staff_movies.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/ckeditor4/ckeditor.js"></script>
<script src="{{STATIC_URL}}themes/js/fxslider.js"></script>
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}ui/css/fxslider.css" />
<script src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js" type="text/javascript"></script>


<script>
$(document).ready(function(){
{% if msg %}
	show_msg("{{msg}}","{{mtype}}");
{% endif %}
 $(".fxslider").fxslider();
});


 function showtimes_show(){
 	$('#articles-preview').hide();
	$('#critic-review').hide();
 	$('#showtimes').show();
	
	$('#conten_preview').removeClass('active');
	$('#comnt_preview').removeClass('active');
	$('#critic_preview').removeClass('active');
	$('#show_preview').addClass('active');
	
 	
 }
  function critic_show(){
 	$('#articles-preview').hide();
	$('#showtimes').hide();
	$('#critic-review').show();
	
	$('#conten_preview').removeClass('active');
	$('#comnt_preview').removeClass('active');
	$('#critic_preview').addClass('active');
	$('#show_preview').removeClass('active');
	
 }
 function show_details(){
 	$('#articles-preview').show();
	
	$('#conten_preview').addClass('active');
	$('#comnt_preview').removeClass('active');
	$('#critic_preview').removeClass('active');
	$('#show_preview').removeClass('active');
	
	$('#articles-preview')
	$('#showtimes').hide();
	$('#critic-review').hide();

 	
 }
 
// Apply to all functionality 
function populateST(){
	s_value = window.document.getElementById('about1').value;
	if ((window.document.getElementById('same_stt').checked) && (s_value==''))
	{
		alert("Please enter the showtimes");
		$('#same_stt').removeAttr("checked");

	}
	
	else
	{
		if (window.document.getElementById('same_stt').checked)
		{
			for(i=1;i<=7;i++)
			{
				window.document.getElementById('about'+i).value = s_value;
			}
		}
		else
		{
			for(i=1;i<=7;i++)
			{
				window.document.getElementById('about'+i).value = '';
			}
		}
	}	
}
function delete_showtime(sid,id){
	var con = 	confirm('Are you sure you want to delete the showtime ?');
	if (con){
	
   var url = "{% url 'staff_movies_delete_movie_showtime' %}";
   var dataString = "id="+sid;
   $.ajax({
   type: "GET",
   url: url,
   data: dataString,
   dataType:'JSON',
   success: function(data){
   		$('#showtimes').empty().html(data.html)

   		show_msg(data.msg);
		$(".movie-showtimes").colorbox({ width: "770", initialWidth: "770", height:"auto", top:"5%"});

   		$(".edit_movie_lightbox").colorbox({width: "880", initialWidth: "880", height:"auto", top:"5%"});// This one i am using for edit theatre lightbox after adding colorbox
		$('#show_times_li_'+sid).fadeIn('slow').remove();
		$.colorbox.close();
	
	}
});
	}
}

function delete_review(id){
   var url = "{% url 'staff_movies_delete_movie_review' %}";
   var dataString = "id="+id;
   $.ajax({
   type: "GET",
   url: url,
   data: dataString,
   dataType:'JSON',
   success: function(data){
   		$('#critic-review').empty().html(data.html);
   		$(".review-edit").colorbox({
   			width: "770", 
   			initialWidth: "770", 
   			initialHeight:"250",
   			height:"auto",
   			top:"5%",
   			onComplete: function(){$.colorbox.resize();},
   			title:function(){return getLBTitle($(this));}
   		});
   		$(".critic-review-lightbox").colorbox({
   			width: "770", 
   			initialWidth: "770", 
   			initialHeight:"250",
   			height:"auto",
   			top:"5%",
   			onComplete: function(){$.colorbox.resize();},
   			title:function(){return getLBTitle($(this));}
   		});
   		$('#delete_after_'+id).fadeIn('slow').remove();
		show_msg(data.msg,data.mtype);
	
	}
});
}


  	function showscreens(obj){
  		if(obj.value!=''){
			{% for a in added%}
				if(obj.value == {{a.theatre_id}}){
					alert("You have already added the showtime for this theatre.\n Please click on edit button to change showtime")
					return false
				}
				else {
					return true
				}
			{% endfor %}
	}
	}
	
</script>
<script type="text/javascript">
function update_critic(id,mid){
	var flag=$("#f_addnew").validate().form();
	if (flag) {
		var source = $('#id_source').val();
		var reviewed_by = $('#id_reviewed_by').val();
		var title = $('#id_title').val();
		var rating = $('#id_rating').val();
		var review = encodeURIComponent($('#id_review').val());
		var dataString = 'id=' + id + '&title=' + title + '&source=' + source + '&reviewed_by=' + reviewed_by + '&rating=' + rating + '&review=' + review + '&mid=' + mid;
		var url = "{% url 'staff_movie_edit_critic' %}";
		$.ajax({
			type: "POST",
			url: url,
			data: dataString,
			beforeSend: function(){
				$('#spinner').show();
			},
			complete: function(){
				$('#spinner').hide();
			},
			dataType: 'JSON',
			success: function(data){
				if (data.status == 1) {
					$('#critic-review').empty().html(data.html);
					$(".review-edit").colorbox({width: "770",initialWidth: "770",height: "auto",top: "5%",title:gettext('Update Critic Review'),});
					$(".add-review-lightbox").colorbox({width: "770",initialWidth: "770",height: "auto",top: "5%",title:gettext('Add Critic Review'),});
					$.colorbox.close();
					show_msg(data.msg,data.mtype);
				}
				else {
					$('#critics-review').replaceWith(data.html);
					$.colorbox.resize();
				}
			}
		});
	} 
}		
</script> 
{% endblock %}
