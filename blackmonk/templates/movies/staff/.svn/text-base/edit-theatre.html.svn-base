{% load i18n %}
{% load upload_tags %}
<div id="ajax_content_loading" style="display:none;padding-top:222px;padding-bottom:350px;text-align:center;">
	<img src="{{STATIC_URL}}ui/images/global/loading-s.gif"><br><p>{% trans 'Saving theatre' %}</p>
</div>
<div class="main_col" id="ajax_content">
	{% if msg %}<div class="message">{{msg}}</div>{% endif %}
	{% if form.errors %}
		<div class="messageerror" >
			<strong>{% trans 'There is a problem with your submission' %}</strong>
            <ul style="list-style:square;margin-left:20px;">
           		{% for field in form %}
           			{% if  field.errors%}<li>{%for error in field.errors%}{{error}}{%endfor%}</li>{% endif %}
          	 	{% endfor %}
				{% for field in add_form %}
           			{% if  field.errors%}<li>{%for error in field.errors%}{{error}}{%endfor%}</li>{% endif %}
          	 	{% endfor %}
			</ul>
	 	</div>
	{% endif %}
<div id="add_theater" class="modal-form">
	<form action="{% url 'staff_movie_edit_theatre' %}" method="post" name="mform_add_theatre"  id="mform_add_theatre" enctype="multipart/form-data" >{% csrf_token %}
    	<input type="hidden" id="id_id" value="{{theatre.id}}" name="id">
		<div class="fields hform">
            <div class="field-group">              
                <div class="fields-head">
                	{% if form.errors %}
						<div class="messageerror" >
							<span style="font-size:1.2em;font-weight:250;"><strong>{% trans 'There is a problem with your submission' %}</strong></span>
					        <ul>
							 {% for field in form %}
							 	{% if field.errors%}<li>{%for error in field.errors%}{{error}}{%endfor%}</li>{% endif %}
					 		 {% endfor %}
							</ul>
						 </div>
					{% endif %}
                    <p class="ltxt80">{% blocktrans %}Add relevant theatre details.{% endblocktrans %}</p> 
                </div> 
                <div class="group">
            		<div class="fields-left col400">                    
                        <div class="field text-field">	
                            <div class="label"><label>{% trans 'Theater Name' %}<span class="required-field">*</span></label></div>	
                            <div class="value">
                                {{form.name}}
                            </div>	
                        </div>
                        <div class="field text-field">
                            <div class="label"><label for="">{% trans 'Theatre Image' %}</label></div>
                            <div class="value">
								{% if form.instance.image %}
									<img src="{{MEDIA_URL}}{{form.instance.image}}"  width="100" />
								{% endif %}
                                <input name="image" id="id_image" class="textField file_normal" size="5" type="file" >
                            </div>
                        </div>
                        <div class="field text-field">	
                            <div class="label"><label>{% trans 'Address' %}<span class="required-field">*</span></label></div>	
                            <div class="value">{{add_form.address1}}</div>	
                        </div>
                        <div class="field text-field">	
                            <div class="value">{{add_form.address2}}</div>	
                        </div>
						<div class="field text-field">	
                            <div class="label"><label>{% trans 'Zip/Postalcode' %}<span class="required-field">*</span></label></div>	
                            <div class="value">{{add_form.zip}}</div>	
                        </div>
                        <div class="field text-field">	
                            <div class="label"><label>{% trans 'Website' %}</label></div>	
                            <div class="value">{{add_form.website}}</div>	
                        </div>
                        <div class="field text-field">	
                            <div class="label"><label>{% trans 'Email ID' %}</label></div>	
                            <div class="value">{{add_form.email}}</div>	
                        </div>
                        <div class="field text-field">	
                            <div class="label"><label>Phone</label></div>	
                            <div class="value">{{add_form.telephone1}}</div>	
                        </div>
						<div class="field text-field">	
                            <div class="label"><label>{% trans 'Ticket Url' %}</label></div>	
							<div class="value">{{form.tkt_url}}</div>	
                        </div>
						<div class="field text-field">	
                            <div class="label"><label>{% trans 'Boxoffice No' %}</label></div>	
                        	<div class="value">{{form.boxoffice_no}}</div>	
						</div>
						<!--div class="field text-field">	
                            <div class="label"><label>{% trans 'Multiplex' %}</label></div>	
                           <div class="value"><span class="cform-checkbox-container"><input name="multiplex" id="inp_multiplex" class="textField"  type="checkbox"><span class="cform-checkbox-element"></span></span></div>
                        </div-->
					   <input type="hidden" name="lat_lng" id="id_lat_lng" value=""/>
               	  	   <input type="hidden" name="zoom" id="id_zoom" value=""/> 
					</div> 
                    <div class="map-right col300">
                        <div class="map-container">
                            <div class="map-head">
                                <h4>{% trans 'Change map marker location' %}</h4>
                                <p>{% trans 'Use the mouse to pick up your marker and drag it to your street address.' %} <!-- Use the tools in the upper left corner of the map to pan and zoom for a better view. --></p>
                            </div>                                        
							<div class="map" id="map" style="width: 298px;height: 370px; position: relative;"></div>
                        </div>                                            
                    </div> 
            	</div>            
            </div>                        
		</div>    
        <div class="modal-base form-submit group">
           <button id = "id_submit" role="button" class="cform-button prime right" type="button" onclick="savetheater();" ><span class="cform-button-text">Save</span></button>
        </div>           
    </form>
</div>
<script type="text/javascript">
function savetheater(){
	var lat_lng = marker.getPosition();
	var zoom = map.getZoom();
	$('#id_lat_lng').val(lat_lng);
	$('#id_zoom').val(zoom);
	var flag=$("#mform_add_theatre").validate().form();
	if(flag){
		$('#mform_add_theatre').submit();
	}
}
$(document).ready(function(){
	$("#mform_add_theatre").validate({
		ignore:'',
		highlight: function(element, errorClass){$(element).parent().parent().addClass('field-error');$(element).addClass('error');},
		unhighlight: function(element, errorClass){$(element).parent().parent().removeClass('field-error');$(element).removeClass('error');},
		errorPlacement: function(error, element){},
	   	rules:{
	    	name: "required",
	    	address1: "required",
			zip:"required"
	   	}
	});
    $( "#id_zip" ).autocomplete({
		source: '{% url "auto_suggest_pin" %}',
	   	select: function(event, ui) {$("#id_zip").val(ui.item.id);}
	});
	$('#id_zip').live("keyup",function(){getPin(getaddress(),$('#id_zip').val());});
	setTimeout(function() {
		{% if theatre.address.lat %}
			load_for_add('map',{{ theatre.address.lat }}, {{ theatre.address.lon }}, {{ theatre.address.zoom }},"{{ theatre }}","{{ theatre.address.address1 }}<br>{{ theatre.aip }}");
	    {% else %}
			load_for_add('map',{{ globalsettings.google_map_lat }}, {{ globalsettings.google_map_lon }}, {{ globalsettings.google_map_zoom }},"{{ globalsettings.city }}","select the location");
		{% endif %}		
		}, 500);
});
function getaddress(){return $('#id_address1').val()+" "+$('#id_address2').val()}
</script> 



