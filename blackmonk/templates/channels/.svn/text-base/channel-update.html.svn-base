{% extends "staff_base.html" %}
{% load tabs %}
{% load i18n %}
{% load upload_tags %}
{% block navigation %}
	{% activetab "selmodule" "channel" %}
	{{ block.super }}
{% endblock %}
{% block pagetitle %}{% if article %}{% trans 'Edit Channel' %}{% else %}{% trans 'Channel - Add New Channel' %}{% endif %}{% endblock %}
{% block head %}
	<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}themes/green/css/LE_MetaId99.css">
	<link type="text/css" rel="stylesheet" href="{{STATIC_URL}}css/bm.jfp.ui.css">
	<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}ui/css/jquery.tagit.css">
{% endblock %}
{% block content %}
<style>
	.module_cat {display: none;}
	.module_cat.active {display: block;}
</style>
<div id="staff-platform" class="group">
                    <div class="header-bar {% if article %}has-preview-head has-sub{% endif %}">
                    	<h2><a href="{% url 'staff_channel_manage_channel' %}"><span class="go_back"></span></a>{% if channel %}{% trans 'Edit Channel' %}{% else %}{% trans 'Add Channel' %}{% endif %}</h2>
					</div>
                    <div id="core-wraper" class="group">
                        <div class="staff-main">
                            <div class="page-wrap">
                                <div id="Articles-add" class="group">
                                    <div id="add-new-Article">
                                    	{% if form.errors %}
										<div class="messageerror" style="background:#FCF4F4;padding:10px;color:#FF9902; box-shadow:0 0 2px rgba(0, 0, 0, 0.1);border-bottom:1px solid #e1e1e1">
											<strong style="font-weight:bold;">{% trans 'There is a problem with your submission' %}</strong>
										    <ul style="list-style:square;margin-left:20px;">
										   		{% for field in form %}
										   			{% if  field.errors%}<li>{%for error in field.errors%} {{error}}{%endfor%}</li>{% endif %}
										  	 	{% endfor %}
											</ul>
										</div>
										{% endif %}
                                         <form action="." name="mform1" id="mform1" method="post" class="add_venue">{% csrf_token %}
                                            <div class="fields hform">
                                                <div class="field-group">  
                                                    <div class="field text-field fd-title">
                                                        <div class="label"><label for="">{% trans 'Title' %}<span class="required-field">*</span></label></div>
                                                         <div class="value" >
                                                        	{{ form.title }}
		                                                    <span class="tip">{{ globalsettings.website_url }}/{{form.slug}}</span>
														</div>
                                                    </div>
                                                    <div class="field text-field">	
                                                        <div class="label"><label>{% trans 'Description' %}<span class="required-field">*</span></label></div>	
                                                        <div class="value">{{ form.description }}</div>	
                                                    </div>
                                                </div>
												<!-- ------------------------------ -->
												<div class="field-group">  
													<div class="fields-head"></div>
													<div class="field text-field">
													    <div class="label">
															<label for="">Select Categories:</label>
														</div>
													    <div class="value"> 
														    <div style="width: 180px; height: 200px; overflow: auto; float: left; margin-left: 0px; border: 1px solid rgb(204, 204, 204); border-radius: 2px 0px 0px 2px;" id="topicsInterest">
																{% for module, categories in cat_set.items %}
															        <div class="topiA {% if forloop.first %}active{% endif %}" id="{{module}}">
															            <label class="">{{module|title}}</label>
															            <span class="caret"></span>
															            <span class="nUm" style="{% if 4 in l %}display: none;{% endif %}" id="{{module}}_count">{{categories.count}}</span>
															        </div>
																{% endfor %}
														    </div>
															{% for module, categories in cat_set.items %} 
																<div id="{{module}}_cat" class="module_cat {% if forloop.first %}active{% endif %}" style="width: 180px; height: 200px; overflow: auto; float: left; border-width: 1px 1px 1px medium; border-style: solid solid solid none; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(204, 204, 204) -moz-use-text-color; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-image: none; border-radius: 0px 2px 2px 0px;">
															        {% for cat in categories.all %}
																        <div class="topi">
																			<span class="checkbox-wrap">
																				<span class="cform-checkbox-container">
																					<input type="checkbox" value="{{cat.id}}" {% if cat.id in categories.selected %}checked="checked"{% endif %} onclick="change_catcount('{{module}}');" name="{{module}}" class="cbox_{{module}} check-overflow cbox">
																					<span class="cform-checkbox-element"></span>
																				</span>
																			</span>
																            <label class="">{{cat}}</label>
																        </div>
															        {% endfor %}
															    </div>
															{% endfor %}
														</div>
													</div>
												</div>
												<!-- ------------------------------ -->
                                            </div> 
                                            <div class="form-submit right group">
	                                            <button class="cform-button" type="button" roll="button" onclick="location.replace('{% url 'staff_channel_manage_channel' %}')"><span class="cform-button-text">{% trans 'Cancel' %}</span></button>
												<button role="button" value="save" name="save_button" class="cform-button prime" type="submit"><span class="cform-button-text">{% if channel %}{% trans 'Update' %}{%else%}{% trans 'Save' %}{%endif%}</span></button>
                                            </div>                                                
                                        </form>
                                    </div>																	                                        
                                </div> <!-- end table -->                                    
                            </div><!-- end page wrap -->
                        </div>  <!-- end main-col -->                            
                        <div id="aside" class="side-bar">
                        	{% if article %}
                        	<div class="preview-aside-meta group">
                                <ul class="side-navigation">
                                    <li class="active"><a href="javascript:void(0);">{% trans 'Article Details' %}</a></li>
                                    <!--li><a href="#">{% trans 'Comments' %}</a></li-->
                                </ul>
								<div class="preview-item-stats">
									<a href="{% url 'staff_article_preview' article.id %}" class="btn-txt-blue" style="display:block; text-align:center"><span class="btn-txt">{% trans 'Preview this Article' %}</span></a>
                                </div>                                
							</div> 
							{% endif %}
                            {#% include 'channels/faq-addpge.html' %#}                                            
                        </div>                            
					</div>                                                    
				</div>
{% endblock %}
{% block footer_include%}
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
<!-- script type="text/javascript" src="{{ STATIC_URL }}js/ckeditor/ckeditor.js"></script -->
<script type="text/javascript" src="{{ STATIC_URL }}js/article/article_staff.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}ui/js/jquery.ui.autocomplete.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}ui/js/tag-it.js"></script>


{% upload_js %}
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.jfp.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.fup.appln.js"></script>
<script src="http://maps.googleapis.com/maps/api/js?v=3&sensor=false{% if globalsettings.google_map_key %}&key={{ globalsettings.google_map_key }}{% endif %}" type="text/javascript"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/general/google_map.js"></script>
<script type="text/javascript">
var edt;
function resizeEditor() {
  	edt.resize('100%',edt.config.height+50);
}
$(document).ready(function(){
		$('.select-menu').bind("change", function(){
			$("#mform1").validate().element($(this));
		});
});

</script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.ui.datepicker.js"></script>
<script type="text/javascript">
function string_to_slug(str){
  str = str.replace(/^\s+|\s+$/g, ''); 
  str = str.toLowerCase();
  str = str.replace(/[^a-z0-9 -]/g, '').replace(/\s+/g, '-').replace(/-+/g, '-'); 
  $('#id_slug').val(str);
}
function change_catcount(module){
	var count=0;
	$('.cbox_'+module).each(function(){
		if($(this).is(':checked')==true){
			count+=1;
		}
	})
	$("#"+module+"_count").html(count);	
}
	$(document).ready(function(){
		$('.topiA').click(function(){
			$('.topiA').removeClass('active');
			$('.module_cat').removeClass('active');
			$(this).addClass('active');
			$("#"+$(this).attr('id')+"_cat").addClass("active");
		})
		if($("#id_published_on").length){
			$("#id_published_on").datepicker({ dateFormat: "mm/dd/yy" });
		}

		$.validator.addMethod("desc_required", function(value, element) {  
		    	$('#id_content').val(edt.getData());
				if($('#id_content').val()!=''){return true;}
				else{return false;}
			},"Please enter a description.");
			$("#mform1").validate({
					ignore:'',
					highlight: function(element, errorClass){$(element).parent().parent().addClass('field-error');$(element).addClass('error');},
					unhighlight: function(element, errorClass){$(element).parent().parent().removeClass('field-error');$(element).removeClass('error');},
					errorPlacement: function(error, element){},
				   	rules:{
				    	title: "required",
						slug: "required",
				    	category: "required",
				    	summary: "required",
				    	content: "desc_required",
						published_on: "required",
				   	}
			});
	}); 			
</script>
{% endblock %}			