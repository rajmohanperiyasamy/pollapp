{% extends "staff_base.html" %}
{% load tabs %}
{% load i18n %}
{% block navigation %}
	{% activetab "selmodule" "comments" %}
	{{ block.super }}
{% endblock %}
{% block pagetitle %}{% trans 'Comments' %} {% endblock %}
{% block head %}
{% endblock %}
{% block content %}
{% load comment_config %}
{% load_comment_config_obj_staff %}
<div id="staff-platform" class="group">
  	<div class="header-bar has-sub">
	<h2>{% trans 'Comments' %}</h2>
        <section class="sub-header-bar">
            <div class="group">
                  <div class="filter-view-tabs">
                        <ul class="left">
                              <li><label>{% trans 'View:' %}</label></li>
                              <li class="view-tab tip tip1" id="filter_a">
                                    <a title="{% trans 'View All' %}" name="all" id="listing_all" class="view-both tttxt-n active first" href="javascript:void(0)"><span>All</span></a>
                                    <a title="{% trans 'Pending Only' %}" name="N" id="listing_pending" class="view-pending tttxt-n" href="javascript:void(0)"><span>Pending</span></a>
                                    <a title="{% trans 'Published only' %}"  name="P" id="listing_published" class="view-published tttxt-n" href="javascript:void(0)"><span>Published</span></a>
									<a title="{% trans 'Blocked only' %}" name="B" id="listing_blocked" class="view-withdrawn tttxt-n last" href="javascript:void(0)"><span>{% trans 'Blocked' %}</span></a>     
                              </li>
                              <li class="view-tab tip tip2" id="filter_b">
                                    <a title="{% trans 'View All' %}" name="all" data-name="" class="view-both tttxt-n active first" href="javascript:void(0)"><span>{% trans 'All' %}</span></a>
                                    <a title="{% trans 'Show Flaged' %}" name="FL" data-name="FL" class="view-featured tttxt-n last" href="javascript:void(0)"><span>{% trans 'Flaged' %}</span></a>
                              </li>
                        </ul>
                  </div>
            </div>
        </section>                          
 		</div>
		<div id="core-wraper" class="group">
        	<div class="staff-main">
              	<div class="page-wrap">
					<div id="articles" class="group">
                        <section class="toolbars">
                            <div class="group">
                                <ul class="toolbar left">
                                    <li class="master-check tool">
										<span class="cform-checkbox-container"><input type="checkbox" value="true" id="master_check" name="master-check"><span class="cform-checkbox-element"></span></span>
									</li>
									<li class="tool action_status tip tip3">
                                        <select id="actionSelect" data-placeholder="{% trans 'Action' %}" class="select-menu" onchange="$('#id_action').val($(this).val()),action();" style=" width:140px;">
                                          	<option value=""></option>
                                          	<optgroup label="Status">
                                             	<option class='publish_action' value="P">{% trans 'Publish' %}</option>
												<option class='block_action' value="B">{% trans 'Block' %}</option>
                                          	</optgroup>
											<optgroup label="Action">
												<option value="DEL">{% trans 'Delete' %}</option>
												<option value="FL">{% trans 'Clear Flag' %}</option>
                                          	</optgroup>
                                        </select>
                                    </li>
                                    <li class="tool tip tip4">                                                       
                                        <label class="inline-block">{% trans 'Sort by:' %}</label>
                                        <select id="orderSelect" onchange="$('#id_sort').val($(this).val()),filter_content();" style="width:150px;" class="select-menu">
                                              <option value="-submit_date" selected="">{% trans 'Newest' %}</option>
                                              <option value="submit_date">{% trans 'Oldest' %}</option>
                                        </select>                                                    
                                    </li>
                                </ul>
                                {% include 'common/pagination_top.html'%} <!-- pagination top -->
								  
                            </div>
                        </section>
						<span id="ajax_content_loading" class="load-list-items" style="display:none">
						 	<img src="{{STATIC_URL}}ui/images/global/loading.gif" align="...">
						</span>
						<div style="display:none;" class="info-bar" id="top_info_bar"></div>
						<div id="ajax_content_cls" class="group">
                    		{% include 'comments/staff/ajax_comment_listing.html'%} 
                   		</div>	                                       
                    </div> <!-- end table -->
              </div>  <!-- end page wrap -->
        </div>  <!-- end main-col -->        
		 <div id="aside" class="side-bar">
        	<div class="preview-aside-meta group">
				<div id="module-stats" class="section">
                	<div class="group">
                        <h5>{% trans 'Comment Status:' %}</h5>
                      	<span id="ajax_loading" class="loading-stats"  style="display:none;"><img src="{{STATIC_URL}}ui/images/global/loading-s.gif" align="..."></span>
					</div>
                	<ol class="stats-summary" id="id_module_state_listing">
                    	 <li class="pending-state"><strong id="id_pending">{{ count_pending }}</strong> {% trans 'in' %} <a href="javascript:void(0)">{% trans 'Pending for review' %}</a></li>
				         <li class="published-state"><strong id="id_published">{{ count_published }}</strong> {% trans 'in' %} <a href="javascript:void(0)">{% trans 'Published' %}</a></li>
				         <li class="blocked-state"><strong id="id_blocked">{{ count_blocked }}</strong> {% trans 'in' %} <a href="javascript:void(0)">{% trans 'Blocked' %}</a></li>
				         <li class="sum"><strong id="id_total">{{ count_total }}</strong> {% trans 'total comments posted.' %}</li>
                    </ol>
                </div>
                <ul class="side-navigation">
					<li class="all {% if not m %}active{% endif %}"><a href="{% url 'staff_comments' %}">{% trans "All" %}</a></li>
                    {% for app in statt_applist %}
						<li class="{{app.slug}} {% if m == app.slug %}active{% endif %}"><a href="{% url 'staff_comments_model' app.slug %}">{{app.name|title}}</a></li>
						{% if app.slug == 'movies' %}
							<li class="theatres {% if m == 'theatres' %}active{% endif %}"><a href="{% url 'staff_comments_model' 'theatres' %}">{% trans "Theatres" %}</a></li>
						{% endif %}
					{% endfor %}
					<li class="venue {% if m == 'venue' %}active{% endif %}"><a href="{% url 'staff_comments_model' 'venue' %}">{% trans "Venues" %}</a></li>
                </ul>
			</div>       
             {#% include 'business/staff/faq.html' %#}         
        </div>                       
	</div>                                                    
</div>
<script type="text/javascript" src="{{ STATIC_URL }}ui/js/listing_settings.js"></script>
{% endblock %}
{% block footer_include%}
<script type="text/javascript">
function filter_content(){
	var dataString='';
	
	dataString+="sort="+$('#id_sort').val();
	dataString+="&flag="+$('#id_listing_type').val();
	if($('#id_status').val()!='' && $('#id_status').val()!=null){dataString+="&status="+$('#id_status').val();}
	if($('#id_pagentn').val()!='' && $('#id_pagentn').val()!=null){dataString+="&page="+$('#id_pagentn').val();}
	if($('#id_item_per_page').val()!='' && $('#id_item_per_page').val()!=null){dataString+="&item_perpage="+$('#id_item_per_page').val();}
	
	hide_top_info_bar();
	$('#ajax_content_cls').hide();
	$('#ajax_content_loading').show();
	$.ajax({
	type: "GET",
	url: "{% if m %}{% url 'staff_ajax_comments_model' m %}{% else %}{% url 'staff_ajax_comments' %}{% endif %}",
	data: dataString,
	dataType:'json',
	success: function(data){
			show_top_info_bar('Comments');
			$('#id_pagentn').val('');
			$('#id_action').val('');
			$('#ajax_content_loading').hide();
			$('#ajax_content_cls').empty().html(data.html);
			$('#ajax_content_cls').show();
			if(data.count){
				if(data.next){$('#top_pge_next').removeClass('inactive');}
				else{$('#top_pge_next').addClass('inactive');}
				if(data.previous){$('#top_pge_previous').removeClass('inactive');}
				else{$('#top_pge_previous').addClass('inactive');}
				$('#id_from_to').html(data.pagerange);
				$('#top_item_count').html("&nbsp;&nbsp;"+data.count);
			}else{
				$('#top_pge_next').addClass('disabled');
				$('#top_pge_previous').addClass('disabled');
				$('#id_from_to').html('0-0');
				$('#top_item_count').html('0');
			}
			$('html,body').animate({ scrollTop: 0 }, 'slow');
		}
	});
}
function filter_action(ids,action){
	var all_ids=[];
	var dataString='';
	
	dataString+="sort="+$('#id_sort').val();
	dataString+="&flag="+$('#id_listing_type').val();
	if($('#id_status').val()!='' && $('#id_status').val()!=null){dataString+="&status="+$('#id_status').val();}
	if($('#id_pagentn').val()!='' && $('#id_pagentn').val()!=null){dataString+="&page="+$('#id_pagentn').val();}
	if($('#id_item_per_page').val()!='' && $('#id_item_per_page').val()!=null){dataString+="&item_perpage="+$('#id_item_per_page').val();}
	
	if(action=='#'){
		dataString+="&action="+$('#id_action').val();
		if(ids==0){
			var ids=[];
			$('.cbox:checked').each(function(){ids.push($(this).val());});
		}
	}else{dataString+="&action="+action;}
	$('.cbox').each(function(){all_ids.push($(this).val());});
	dataString+="&ids="+ids;
	dataString+="&all_ids="+all_ids;
	
	$('#ajax_action_loading').show();

	hide_top_info_bar();
	$.ajax({
	type: "get",
	url: "{% if m %}{% url 'staff_ajax_comment_action_model' m %}{% else %}{% url 'staff_ajax_comment_action' %}{% endif %}",
	data: dataString,
	dataType:'json',
	success: function(data){
			show_top_info_bar('Comments');
			$("#master_check").attr('checked',false);
			$('#ajax_action_loading').hide();
			$('#actionSelect').val('').trigger("liszt:updated");
			try{for(i=0;i<data.send_deleted_list.length;i++){$('#li_'+data.send_deleted_list[i]).remove();}$('#li_'+data.send_deleted_list).remove();}
			catch(e){$('#li_'+data.send_deleted_list).remove();}
			$('#ajax_content_list').append(data.html);
			$('#pagenation').empty().html(data.pagenation);
			show_msg(data.msg,data.mtype);
			if(data.search){$('#close_search').show();}
			if(data.count){
				if(data.next){$('#top_pge_next').removeClass('inactive');}
				else{$('#top_pge_next').addClass('inactive');}
				if(data.previous){$('#top_pge_previous').removeClass('inactive');}
				else{$('#top_pge_previous').addClass('inactive');}
				$('#id_from_to').html(data.pagerange);
				$('#top_item_count').html("&nbsp;&nbsp;"+data.count);
				$('#id_total').html(data.count_total);
				$('#id_pending').html(data.count_pending);
				$('#id_published').html(data.count_published);
				$('#id_blocked').html(data.count_blocked);
			}else{
				$('#top_pge_next').addClass('disabled');
				$('#top_pge_previous').addClass('disabled');
				$('#id_from_to').html('0-0');
				$('#top_item_count').html('0');
			}
		}
	});
}
function delete_comment(ids){
	var falg=confirm(gettext("Are you sure want to delete this comment(includes reply's to this comment) ?"));
	if(falg){
		filter_action(ids,'DEL')
	}
}
function action(){
	var flag=false;
	var flag_action=false;
	if($('#id_action').val()!='0'){
		$('.cbox:checked').each(function(){
			flag=true;
		});
		if(flag){
			if($('#id_action').val()=='DEL'){
				 if(confirm(gettext("Are you sure want to delete this comment(includes reply's to this comment) ?"))){flag_action=true;}
			}
			if($('#id_action').val()=='FL'){
				if(confirm(gettext('Are you sure you want to Clear flag ?'))){flag_action=true;}
			}
			if($('#id_action').val()=='P'){
				if(confirm(gettext('Are you sure you want to Publish comment(s) ?'))){flag_action=true;}
			}
			if($('#id_action').val()=='B'){
				if(confirm(gettext('Are you sure you want to Block comment(s) ?'))){flag_action=true;}
			}
			if(flag_action){filter_action(0,'#');}
		}else{
			alert('Please select comment(s)')
		}
	}
}
$(document).ready(function(){
	
	$('.tool.action_status .chzn-container').addClass('chzn-disabled , disabled_chosen');

	$('#filter_a a').click(function(){
		$('#id_status').val($(this).attr('name'));
		if(!$(this).hasClass('active')){
			$('#filter_a a').removeClass('active');
			$(this).addClass('active');
		}
		filter_content();
	});
	$('#filter_b a').click(function(){
		$('#id_listing_type').val($(this).attr('data-name'));
		if(!$(this).hasClass('active')){
			$('#filter_b a').removeClass('active');
			$(this).addClass('active');
		}
		filter_content();
	});
	$('.see_more').live('click',function(){
		$(this).parent().toggle();
		$(this).parent().parent().find('.more_c').toggle();
	})
	$('.see_less').live('click',function(){
		$(this).parent().toggle();
		$(this).parent().parent().find('.less_c').toggle();
	})
});
</script>
<ul class="tour_link">
    <li class="tool-tip tttxt-t1"><a class="link1" href="/bmt/tour/comments/staff/status.html"></a></li>
    <li class="tool-tip tttxt-t2"><a class="link2" href="/bmt/tour/comments/staff/listing_type.html"></a></li>
    <li class="tool-tip tttxt-t3"><a class="link3" href="/bmt/tour/comments/staff/actions.html"></a></li>
    <li class="tool-tip tttxt-t4"><a class="link4" href="/bmt/tour/comments/staff/sorting.html"></a></li>
    <li class="tool-tip tttxt-t5"><a class="link5" href="/bmt/tour/comments/staff/status_aside.html"></a></li>
    <li class="tool-tip tttxt-t6"><a class="link6" href="/bmt/tour/comments/staff/settings.html"></a></li>
</ul>
{% endblock %}