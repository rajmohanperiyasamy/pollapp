{% extends "staff_base.html" %}
{% load tabs %}
{% load i18n %}
{% load truncate_filter %}
{% load upload_tags %}
{% load thumbnail %}
{% load truncate_filter %}
{% block navigation %}
	{% activetab "selmodule" "photos" %}
	{{ block.super }}
{% endblock %}
{% block pagetitle %}{% trans 'Gallery - Details' %} {% endblock %}
{% block head %}
<!-- TAGS -->
	<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}ui/css/jquery.tagit.css" />
<!-- TAGS -->
{% endblock %}
{% block content %}
<div id="staff-platform" class="group">
  	<div class="header-bar has-preview-head">
  		<h2 onclick="window.location.replace('{% url 'staff_manage_gallery' %}')" style="cursor:pointer;">{% trans 'Photos' %}</h2>
        <section class="sub-header-bar">
            <div class="preview-head">
            	{% if gallery.is_featured %}
                <span class="list-type featured-item">
                	<a href="#" class="tttxt" original-title="Item listed as featured">Featured</a>
				</span>
				{% endif %}
                <div class="item-title">
                    <h1>{{gallery.title|truncate_chars:88}}</h1>
                    <p class="ltxt80">{% trans 'By' %} <a href="{% url 'user_profile' gallery.created_by.profile_slug %}">{{gallery.created_by.display_name}}</a> <span class="divider12">|</span> {{gallery.created_on|date:"M d, Y"}}</p>
				</div>                                   
                <ul class="status-tabs group">
                    <li>{{gallery.most_viewed}}<span class="meta">views</span></li>
                    <!--li><a href="#">4<span class="meta">comments</span> </a></li-->
                </ul>                                
            </div>                                
        </section>                          
    </div>
    <div id="core-wraper" class="group">
        <div class="staff-main">
            <div class="page-wrap">
                <div id="photo-gallery" class="preview-center group">
                	<div class="preview-items">
                        <div class="preview-group">
                        	<div class="preview-items-head">
                                {% if perms.gallery.change_photoalbum %}
								<div class="right-item"><div title="{% trans 'Update Gallery Details' %}" href="{% url 'staff_gallery_update' gallery.id %}" class="cform-button bm-update-gallery"><span>{% trans 'Edit' %}</span></div></div>
                            	{% endif %}
								<h3>{% trans 'Gallery Details Details' %}</h3>
                            </div>
							<div id="gallery_content">
	                            {% include 'gallery/staff/gallery_detail_content.html' %}
							</div>                                           
						</div>
                        <div class="preview-group">
                        	<div class="preview-items-head" id="add_head" style="{% if not photos %}display:none;{% endif %}">
                                {% if perms.gallery.add_photoalbum %}
								<div class="right-item"><div class="cform-button prime add-photo-gallery"  href="{% url 'staff_add_gallery_add_photos' gallery.id %}" title="{% trans 'Add Photos' %}"><span>{% trans 'Add new Photos' %}</span></div></div>
                            	{% endif %}
								<h3>{% trans 'Photos' %}</h3>
                            </div>    
                            <ol id="photo-grid" class="data-table-inset">
                            	{% for photo in photos %}
                                <li class="table-list-row manage-items gallery_list_count" id="li_{{photo.id}}">
                                    <div class="table-list-row-inner group">
                                        <div class="thumb-wrap">
                                            <span class="inline-block">
                                            	<!--img alt="{{photo}}" src="{% if photo.photo_url %}{{photo.photo_url}}{% else %}{{photo.photo.url}}{% endif %}"-->
												<img alt="{{photo}}" src="{% if photo.photo_url %}{{photo.photo_url}}{% else %}{% thumbnail photo.photo 213x200 %}{% endif %}">
											</span>
                                        </div>   
                                        <div class="item-detail">
                                            <h4>{{photo.caption|truncate_chars:20}}</h4>
                                            <p class="ltxtAA txt11"><span>{% trans 'Updated on' %}:  {{photo.modified_on|date:'M d Y'}}</span></p>
                                        </div>
										{% if perms.gallery.delete_photoalbum or perms.gallery.change_photoalbum%}
                                        <div class="action-buttons">
                                            <div>
												{% if perms.gallery.delete_photoalbum %}
                                                <a href="javascript:delete_photo({{photo.id}})" class="tttxt" original-title="Delete"><span class="action-icon icon-delete"></span></a>
                                                {% endif %}
												{% if perms.gallery.change_photoalbum %}
												<a href="{% url 'staff_gallery_photo_detail' photo.id %}" class="tttxt bm-add-photo-details"  original-title="{% trans 'Edit Photo Details' %}"><span class="action-icon icon-edit"></span></a>
                                            	{% endif %}
											</div>                                                            
                                        </div>
										{% endif %}
                                    </div>
                                </li>
								{% cycle '' '' '<li class="clear"></li>' %}
								{% endfor %}
                            </ol> <!-- end table --> 
                            <div class="no-data" style="{% if photos %}display:none;{% endif %}">
                                <p>{% trans 'No photos found for this gallery. '%}</p>
                                <div class="button-insde">
									{% if perms.gallery.add_photoalbum %}
                                    <span class="btn-txt-inline-prime add-photo-gallery"  href="{% url 'staff_add_gallery_add_photos' gallery.id %}" title="{% trans 'Add Photos' %}"><span class="btn-txt">{% trans 'Add Photos' %}</span></span>
                                	{% endif %}
								</div>
                            </div>
                        </div>
					</div>                                        
                </div><!-- end table -->
            </div> <!-- end page wrap -->
        </div> <!-- end main-col -->                            
        <div id="aside" class="side-bar">
            {#% include 'business/staff/faq.html' %#}         
        </div>                            
    </div>                                                    
</div>
{% endblock %}
{% block footer_include %}
<!-- TAGS -->
	<script type="text/javascript" src="{{STATIC_URL}}ui/js/jquery.ui.autocomplete.js"></script>
	<script type="text/javascript" src="{{STATIC_URL}}ui/js/tag-it.js"></script>
<!-- TAGS -->
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
<input type="hidden" id='fapikey' value='{{ gallery_settings.flickr_api_key }}'>
<input type="hidden" id='staff_add_gallery' value="{% url 'staff_add_gallery' %}">
<script type="text/javascript" src="{{ STATIC_URL }}/js/gallery/gallery_staff.js"></script>
<script type="text/javascript">
function show_hide(){
	if($('#photo-grid').find('li').length>=1){
		try{$('.no-data').hide();$('#add_head').show();}
		catch(e){}
	}else{
		try{$('.no-data').show();$('#add_head').hide();}
		catch(e){}
	}
}
function delete_photo(id){
	if(confirm(gettext('Are you sure want to delete this photo ?'))){
		$.ajax({
			type: "GET",
			url: '{% url 'staff_gallery_photo_delete' %}',
			data: 'id='+id,
			dataType:'JSON',
			success: function(responseData){
				if(responseData.status){
					$('#li_'+id).remove();
				}
				show_hide();
				show_msg(responseData.msg,responseData.mtype);
			}
		});
	}
}
</script>
{% endblock %}