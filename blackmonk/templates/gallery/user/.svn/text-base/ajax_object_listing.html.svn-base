{% load thumbnail %}
{% load mptt_comments_tags %}
<input type="hidden" value="{% url 'user_ajax_list_gallery' %}" name="id_hidden_url" id="id_hidden_url">
<input type="hidden" value="{% url 'user_ajax_gallery_action' %}" name="id_action_url" id="id_action_url">
<input type="hidden" value="{{status}}" name="id_status" id="id_status">
<input type="hidden" value="{{listing_type}}" name="id_listing_type" id="id_listing_type">
<input type="hidden" value="{{sort}}" name="id_sort" id="id_sort">
<input type="hidden" value="{{msg}}" name="id_action_msg" id="id_action_msg">

<input type="hidden" value="{% if search %}{{search}}{% endif %}" name="id_search" id="id_search">
<input type="hidden" value="" name="id_action" id="id_action">
{% if gallery %}
<ul class="modulesBrowseData dSrS480 mDa-lT mDa-oT-lT oVrfLw-vSbL">
	{% for gal in gallery %}
    <li class="mDa mDa-sTtS-iN">
        <div class="mDa-iN">
            <div class="mDa-wPr"> 
            	<a class="bUi-tMb-wPr tMb-75 dSpD  fLxiMgW bUi-tMb-110" href="{% url 'user_gallery_detail' gal.id %}">
                    <span class="bUi-tMb w100pXmP">
                        <span class="bUi-tMb-pRpL">
                            <span class="bUi-tMb-cLp">
                                {% with gal.new_cover_image as cover %}
                                <span class="bUi-tMb-cLp-iN"> <img class="mDa-oT" src="{% if cover.photo %}{% thumbnail cover.photo 110x0 %}{% else %}{{ cover }}{% endif %}" alt="">
                                    <span class="vRtL-aLn"> </span>
                                </span>
                                {% endwith %}
                            </span>
                        </span>
                    </span>
                </a>
            </div>
            <div class="mDa-bDy mRr0mP">
				{% if gal.is_featured %}
					<span style="cursor:pointer;" title="Featured" class="fTrd-lSt"></span>
				{% endif %}
                <h5 class="mDa-hD tRnCt0 mR50 rLvE h65 h65" title="{{gal.title|title|truncatechars:70}}"><a href="{% url 'user_gallery_detail' gal.id %}">{{gal.title|title|truncatechars:70}}</a></h5>
                <p class="fS12 cLr-gRy"><span class="fS11 cLr-lTgRy">{{gal.created_on|date:"F d, Y f A"}}</span></p>
                <div class="clearfix">
                	<div class="btn-group pLlT iM" id="id_drop_{{gal.id}}">
                        <a href="{% url 'user_gallery_update' gal.id %}" title="Edit" class="btn btn-light btn-small"><span id="id_delete_{{gal.id}}"><i aria-hidden="true" class="bUi-iCn-rVeW-12 ib"></i></span><span id="id_loding_{{gal.id}}" style="display:none;"><i alt="Loading icon" class="icon-spinner bUi-iCn-sPnR mRr5 fS16" aria-hidden="true"></i></span></a>
                            <button class="h27 btn btn-light btn-small dropdown-toggle" data-toggle="dropdown">
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu mNi pLrT dSpL">
							<!--li><a title="Edit" href="{% url 'user_gallery_update' gal.id %}">Edit</a></li-->
							{% if gal.status == 'D' and gal.get_image_count != 0 %}
								<li id="sub"><a onclick="submit_for_publish({{gal.id}})" href="javascript:void(0)">Submit for publishing</a></li>
							{% endif %}
                            <li><a href="{% if gal.get_gallery_flicker_images %}{% url 'user_add_gallery_add_photos' gal.id %}{% else %}{% url 'user_add_gallery_upload_photos' gal.id %}{% endif %}">Add/Edit Photos</a></li>
                            <li><a href="{% url 'user_gallery_seo' gal.id %}" data-target="#update_seo">Update SEO info</a></li>
                            <li class="divider"></li>
                            <li><a onclick="if(confirm('Are you sure you want to delete the selected album?')){filter_action({{gal.id}},'DEL');return false;}" href="javascript:void(0)">Delete</a></li>
                        </ul>
                    </div>
                    <div class="pLrT mRr10 iM" style="cursor:pointer;" id="id_estatus_{{gal.id}}">
                        <i {% if gal.status == 'P' %}class="bUi-iCn-pPiE-24 cLr-pUb" title="Published"{% endif %}
							{% if gal.status == 'R' %}class="bUi-iCn-rGt-24 cLr-rEj" title="Rejected"{% endif %}
							{% if gal.status == 'N' %}class="bUi-iCn-pNdG-24 cLr-pEn" title="Pending"{% endif %}
							{% if gal.status == 'D' %}class="bUi-iCn-dRaT-24 cLr-dRf" title="Drafted"{% endif %}
							{% if gal.status == 'B' %}class="bUi-iCn-bLk-24 cLr-bLoK" title="Blocked"{% endif %} aria-hidden="true"></i>
                    </div>	
                </div>
                <div class="mDa-lT-sTtS aBsLt tR0 StCmP tXt-rTp bGtRp">
                   <span class="fS11 cLr-lTgRy mRr10 bLk" style="cursor:pointer;" title="Views"><i aria-hidden="true" class="bUi-iCn-vEw-12"></i> {{gal.most_viewed}}</span>
                   <span class="fS11 cLr-lTgRy mRr10 bLk" style="cursor:pointer;" title="Comments"><i aria-hidden="true" class="bUi-iCn-bBl-12 fS11"></i> {% get_mptt_comment_count for gal as comment_count %}{{comment_count}}</span>
                   <!--span class="fS11 cLr-lTgRy mRr10 bLk"><i aria-hidden="true" class="bUi-iCn-hRt-16 fS11"></i> 102</span-->
                </div> 
            </div>
        </div>
    </li>
    {% endfor %}
</ul>
{% else %}
	<!-- No data -->
	<div class="hT600 rLvE">
 		<div class="tBl-bLk pDt0">
			<div class="tBl-cEl">
				<span class="iCn-bRdR80 oP25"><i aria-hidden="true" class="bUi-iCn-pHoT-24 fS42-1 cLr-lTgRy ib"></i></span>
				{% if search %}
					<p class="bLk mRt20 fS16 cLr-lTgRy oP75">You haven't submitted any photos with keyword "{{search_keyword}}"</p>
				{% else %}
					{% if status == "P" %}
						<p class="bLk mRt20 fS16 cLr-lTgRy oP75">You have no published photos.</p>
					{% elif status == "N" %}
						<p class="bLk mRt20 fS16 cLr-lTgRy oP75">You have no pending photos.</p>
					{% elif status == "R" %}
						<p class="bLk mRt20 fS16 cLr-lTgRy oP75">You have no rejected photos.</p>
					{% elif status == "D" %}
						<p class="bLk mRt20 fS16 cLr-lTgRy oP75">You have no photo as drafts.</p>
					{% elif status == "E" %}
						<p class="bLk mRt20 fS16 cLr-lTgRy oP75">You have no expired photos.</p>
					{% elif status == "B" %}
						<p class="bLk mRt20 fS16 cLr-lTgRy oP75">You have no blocked photos.</p>
					{% elif listing_type == "B" %}
						<p class="bLk mRt20 fS16 cLr-lTgRy oP75">You have no free photos.</p>
					{% elif listing_type == "F" %}
						<p class="bLk mRt20 fS16 cLr-lTgRy oP75">You have no featured photos.</p>
					{% elif listing_type == "S" %}
						<p class="bLk mRt20 fS16 cLr-lTgRy oP75">You have no sponsored photos.</p>
					{% elif listing_type == "all" %}
						<p class="bLk mRt20 fS16 cLr-lTgRy oP75">You haven't uploaded any photos yet.</p>
						<p class="mRt15"><a href="{% url 'user_add_gallery' %}" class="btn btn-danger fS12 fW-bLd">Add photos</a></p>
					{% endif %}
				{% endif %}
			</div>
		</div>
	</div>
	<!-- /No data -->
{% endif %}
{% include 'usercp_pagination.html' %}
<script type="text/javascript">
	$(document).ready(function(){
		$("a[data-target=#upgrade_list]").click(function(ev) {
		   ev.preventDefault();
		   target = $(this).attr("href");
		
		   // load the url and show modal on success
		   $("#upgrade_list .modal-body").load(target, function() {
		        $("#upgrade_list").modal("show");
		   });
		});
		$("a[data-target=#update_seo]").click(function(ev) {
		   ev.preventDefault();
		   target = $(this).attr("href");
		
		   // load the url and show modal on success
		   $("#update_seo .modal-body").load(target, function() {
		        $("#update_seo").modal("show");
		   });
		});
	});
function submit_for_publish(gid){
	$.ajax({
		type: "GET",
		url: "{% url 'user_gallery_submit' %}",
		data: "gid="+gid,
		dataType:'JSON',
		success: function(data){
			$('#id_estatus_'+gid+' i').removeClass('bUi-iCn-dRaT-24 cLr-dRf');
			$('#id_estatus_'+gid+' i').addClass('bUi-iCn-pNdG-24 cLr-pEn');
			$("#sub").hide();
		}
	});
}
</script>