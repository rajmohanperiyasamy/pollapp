{% extends "user_base.html" %}
{% load ds_utils %}
{% load upload_tags %}
{% load tabs %}
{% load i18n %}
{% block pagetitle %}{% if category %}{% seo_format_tag module='Photos' title=category.seo_title code='LT' category=category.name as seo_meta_title %}{% else %}{% seo_format_tag module='Photos' title=seo.seo_title code='MT' as seo_meta_title %}{% endif %}{{seo_meta_title}}{% endblock %}
{% block meta %}
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="description" content="{{seo.seo_description}}" />
{% endblock %}
{% block head %}
	<link type="text/css" rel="stylesheet" href="{{STATIC_URL}}css/bm.jfp.ui.css">
	<script type="text/javascript" src="{{ STATIC_URL }}js/ckeditor/ckeditor.js"></script>
	<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
$("#mform").validate({
            ignore:'',
			highlight: function(element, errorClass){
				$(element).parent('div').parent('div').addClass('error');
				$(element).parent('div').addClass('error');
				$(element).addClass('error');
			},
			unhighlight: function(element, errorClass){
				$(element).parent('div').parent('div').removeClass('error');
				$(element).parent('div').removeClass('error');
				$(element).removeClass('error');
			},
			errorPlacement: function(error, element){},
			invalidHandler: function(event, validator) { 
				var id = $(validator.errorList[0].element).parent('div');
				$('html,body').animate({ scrollTop: $(id).offset().top }, 'slow');
			},
		   	rules:{
		    	title: "required",
				category: "required",
				summary:"required",
	   	},
		
		submitHandler:function(){
			form.submit();
		}
	});
	$('#id_category').bind("change", function(){
		$("#mform").validate().element($(this));
	});
});
</script>
{% endblock %}
{% block navigation %}
	{% activetab "leftnav" "photos" %}
	{{ block.super }}
{% endblock %}

{% block content %}
<div class="span10 sP9mX979 sP12mX767">
<div class="row-fluid">
	<div class="main span9">
		<section class="sCn pD0">
			<div class="cLrFx pD20">
				<h3 class="mR0 tRnCt">Add Photos</h3>
			</div>
            <hr class="mRb20 mRt0 oTsT-hRz15 vOp">
			<div class="dSpLy-tBl tHcL bRdR pD0 mRb20 sTpS-hRz hMp">
				<div class="aCtV">
					<h3><em class="sTp-cNt">1</em> Create gallery</h3>
				</div>
				<div>
					<h3><em class="sTp-cNt">2</em> Upload photos</h3>
				</div>
				<div>
					<h3><em class="sTp-cNt">3</em> Add title &amp; description</h3>
				</div>
			</div>
			<div class="pD20">
				<form class="form-horizontal uSr-aCnT mRb0 cLrFx" method="post" id="mform" action="{% url 'user_add_gallery' %}">
				{% if form.errors %} 
					<div class="field">
						<div class="messageerror" >
							<strong>{% trans 'There is a problem with your submission' %}</strong>
				            <ul style="list-style:square;margin-left:20px;">
				           		{% for field in form %}
				           			{% if  field.errors%}<li>{%for error in field.errors%}{{error}}{%endfor%}</li>{% endif %}
				          	 	{% endfor %}
							</ul>
					 	</div>
                    </div>  
				{% endif %}
					<div class="row-fluid mRb30">
                        <div class="control-group">
                            <label class="control-label">Gallery Name<em class="cLr-rEd">*</em></label>
                            <div class="controls">
                                {{form.title}}
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" >Category<em class="cLr-rEd">*</em></label>
                            <div class="controls">
                                {{form.category}}
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" >Description<em class="cLr-rEd">*</em></label>
                            <div class="controls">
                                {{form.summary}}
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Tags</label>
                            <div class="controls">
		                        <input type="text" name='tags' id='tags' value="" class="iSp8 tagsinput" placeholder="tags">
								<ul id="mytags" style="width:460px;"></ul>
                            </div>
                        </div>
					</div>
                    <hr class="oTsT-hRz20 mRb0 mRt0">
					<div class="row-fluid">
						<div class="form-actions pD0 pLrT">
							<button type="button" onclick="location.replace('{% url 'user_manage_gallery' %}')" class="btn btn-light fS12 fW-bLd ">Cancel</button>
							<button class="btn btn-primary fS12 fW-bLd mRl5" type="submit">Next step</button>
						</div>
					</div>
                </form>
			</div>
		</section>
	</div> <!-- /.main -->
	<aside class="sD-bR span3">
		<div>
			<section class="tXt-cTr pD0 bNr-aD"> 
               
            </section>
		</div>
	</aside>
</div>  <!-- /.row-fluid -->
{% endblock %}

{% block footerarea %}
<!-- TAGS -->
	<script type="text/javascript" src="{{STATIC_URL}}ui/js/jquery.ui.autocomplete.js"></script>
	<script type="text/javascript" src="{{STATIC_URL}}ui/js/tag-it.js"></script>
<!-- TAGS -->
<script type="text/javascript" src="{{STATIC_URL}}ui/js/inline.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	$("#mytags").tagit({
		singleField: true,
		singleFieldNode: $('#tags'),
		allowSpaces:true,
		tagSource: function( request, response ) {
		 $.ajax({
		       url: "{% url 'gallery_auto_suggest_tag' %}",
		       data: { term:request.term },
		       dataType: "json",
		       success: function( data ) {
		       response( $.map( data, function( item ) {
		       return {
			   	label: item.label, value: item.value 
				}}
			));
			}
		});
		},
		onTagAdded: function(event, tag) {
	        $.colorbox.resize();
	    },
		onTagRemoved: function(event, tag) {
	        $.colorbox.resize();
	    }
	});
})
{% endblock %}