{% load i18n %}
<div id="ajax_content_loading" style="display:none;padding-top:96px;text-align:center;">
	<img src="{{STATIC_URL}}ui/images/global/loading.gif"><br><p>{% trans 'Saving Header Menu Positions' %}</p>
</div>
<div id="id_navigation_content_div"><!-- extra div -->
<div class="sortable-menu group">
	<input type="hidden" id="id_hidden_order" value="">
    <ol class="sortable">
	{% for menu in footer_menus %}
		<li id="list_{{menu.id}}">
        	<div class="sortable-menu-inner group handle_test">
            	<div class="drag-icon"> <img src="{{STATIC_URL}}ui/images/icons/b/48.png" /></div> 
            	<div class="sortable-menu-item">{{menu.name}}</div>
                <div class="action-buttons">
                    <div class="group">
                        <a href="javascript:void(0);" onclick="if(confirm(gettext('Are you sure you want to delete this menu?'))){delete_menu({{menu.id}},'{% url 'admin_design_delete_menu_item' %}');return false;}" class="tttxt-n" title="{% trans 'Delete Menu' %}"><span class="action-icon icon-delete"></span></a>
                        <a class="txt-button tttxt-n bm-add-gadget light_box bmElement bm-menu-content" id="id_update_link_{{menu.id}}" href="{% url 'admin_design_update_footer_item' %}?mid={{menu.id}}" title="{% trans 'Update Menu' %}"><span class="action-icon icon-edit"></span></a>
                    </div>                                                            
                </div>
            </div>
		{% if menu.get_sub_menus %}
        	<ol>
			{% for smenu in menu.get_sub_menus %}	
            	<li id="list_{{smenu.id}}">
                	<div class="sortable-menu-inner group handle_test">
                    	<div class="drag-icon"> <img src="{{STATIC_URL}}ui/images/icons/b/48.png" /></div>
                    	<div class="sortable-menu-item">{{smenu.name}}</div>
                        <div class="action-buttons">
                            <div class="group">
                                <a href="javascript:void(0);" onclick="if(confirm(gettext('Are you sure you want to delete this menu?'))){delete_menu({{smenu.id}},'{% url 'admin_design_delete_menu_item' %}');return false;}" class="tttxt-n" title="{% trans 'Delete Menu' %}"><span class="action-icon icon-delete"></span></a>
                                <a class="txt-button tttxt-n bm-add-gadget light_box bmElement bm-menu-content" id="id_update_link_{{smenu.id}}" href="{% url 'admin_design_update_footer_item' %}?mid={{smenu.id}}" title="{% trans 'Update Menu' %}"><span class="action-icon icon-edit"></span></a>
                            </div>                                                            
                        </div>
                    </div>
                </li>
			{% endfor %}
            </ol>
		{% endif %}
        </li>
	{% endfor %}
    </ol>
</div>

<div class="form-submit right group trp-bg">
   <button roll="button" class="cform-button" id="id_reset" onclick="location.replace('{% url 'admin_design_manage_navigation' %}')"><span class="cform-button-text">{% trans 'Reset' %}</span></button>
   <button type="button" class="cform-button prime" id="id_update" role="button"><span class="cform-button-text">{% trans 'UPDATE' %}</span></button>
</div>  

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery-ui-1.8.11.custom.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.ui.nestedSortable.js"></script>

<script type="text/javascript">

	$(document).ready(function(){
	   // Customized Code 	
	   $('ol.sortable').nestedSortable({
      	// some options here
		forcePlaceholderSize: true,
		handle: 'div',
		helper:	'clone',
		items: 'li',
		maxLevels: 2,
		opacity: .6,
		placeholder: 'placeholder',
		tabSize: 25,
		tolerance: 'pointer',
		toleranceElement: '> div'
      	
		});

		$('#id_update').click(function(){

		
			var serialized = $('ol.sortable').nestedSortable('serialize');
			var serialized_list = serialized.split('&');
			var sdata='sortlist='+serialized_list;

			$.ajax({
			type: "GET",
			url: '{% url 'admin_design_update_footer_positions' %}',
			data: sdata,
			dataType:'json',
			success: function(data){
					show_msg(gettext(data.msg),data.mtype);
				}
			});
			
		});

		/*$('#id_reset').click(function(){
			//$('ol.sortable').sortable( "refresh" );
			//return false;

			$.ajax({
			type: "GET",
			url: '{% url 'admin_design_reset_menu_positions' %}',
			data: '1',
			dataType:'json',
			success: function(data){
					//alert(data.html);
					$('#ajax_content_loading').hide();
					$('#id_navigation_content_div').empty().html(data.html);
					//$("ol.sortable").sortable( 'refresh' );
				}
			});
		});*/

});
	
</script>
</div><!-- extra div -->

