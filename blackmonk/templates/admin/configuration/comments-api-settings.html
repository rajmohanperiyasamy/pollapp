{% load i18n %}
<div id="ajax_content_loading" style="display:none;padding-top:96px;text-align:center;">
	<img src="{{STATIC_URL}}ui/images/global/loading-s.gif"><br><p>{% trans 'Saving Comments API Settings' %}</p>
</div>
<div id="comments_api_settings_div" class="group">

	<script type="text/javascript">
	$(document).ready(function(){
		$("#mform").validate({
			highlight: function(element, errorClass){$(element).parent().parent().addClass('field-error');$(element).addClass('error');},
			unhighlight: function(element, errorClass){$(element).parent().parent().removeClass('field-error');$(element).removeClass('error');},
			errorPlacement: function(error, element){},
		   	rules:{
				disqus_forum_name: "required",
		   	}
		});
	});
	</script>
	{% if form.errors %}
		<div class="messageerror">
			<strong>{% trans 'There is a problem with your submission' %}</strong>
            <ul style="list-style:square;margin-left:20px;">
           		{% for field in form %}
           			{% if  field.errors%}<li>{%for error in field.errors%}{{error}}{%endfor%}</li>{% endif %}
          	 	{% endfor %}
			</ul>
	 	</div>
	{% endif %}
    <form action="{% url 'admin_configuration_general_comments_update' %}" name="mform" id="mform" method="post" class="add_category">{% csrf_token %}
    	<div class="fields hform">
				<section id="signin-with-facebook" class="section">
                	<div class="section-head">
                    	<label for="doubleclick" class="check-in">
                    		<span class="check-button tttxt-e" title="{% trans 'Select' %}">
                    			<span class="cform-radio-container">
                    				<input id="expedia" name="option" type="radio" checked="checked" value="D">
									<span class="cform-radio-element"></span>
								</span>
							</span>
						</label>
						<h3 class="section-title tttxt-e checkbox-left" title="{% trans 'Select' %}">
							<span class="favicon"><img src="http://mediacdn.disqus.com/1335308937/img/favicon.ico" /></span>
							{% trans 'Disqus' %}
						</h3>
                   	</div>
                    <div class="section-content" >
                    	<div class="fields hform">
            			<div class="field-group" id="meta-tags">
							<div class="field text-field">	
			                	<div class="label"><label>{% trans 'Shortname' %}<span class="required-field">*</span></label></div>	
			                	<div class="value"><input type="text" autocomplete="off" name="disqus_forum_name" maxlength="300" placeholder="{{globalsettings.city}}" id="id_disqus_forum_name" value="{% if comments_obj.disqus_forum_name %}{{comments_obj.disqus_forum_name}}{% endif %}" ></div>	
			                </div>
            			</div>                 
					</div>
					</div>                                                                  
    		</section> <!-- end section --> 
		</div>    
    	<div class="modal-base form-submit group trp-bg">
	  		<button role="button" class="cform-button prime right" type="button" onclick="save_comments_settings();"><span class="cform-button-text">{% trans 'UPDATE' %}</span></button>
		</div>           
    </form>
</div> 

<script type="text/javascript">
function save_comments_settings(){
	var success = $('#mform').validate().form();  
	if (success){
		var datastring='forum_name='+$('#id_disqus_forum_name').val();
		$('#comments_api_settings_div').hide();
		$('#ajax_content_loading').show();
		var url = $('#mform').attr('action');
		$.ajax({
		type: "POST",
		url: url,
		data: datastring,
		dataType:'JSON',
		success: function(data){
				show_msg(gettext(data.msg),data.mtype);
				$('#ajax_content_loading').hide();
				$('#comments_api_settings_div').fadeIn(800).html(data.html);
			}
		});
	}
}
</script>    