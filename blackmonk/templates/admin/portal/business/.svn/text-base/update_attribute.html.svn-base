{% load i18n %}
<div id="ajax_content_loading" style="display:none;padding-top:150px;padding-bottom:500px;text-align:center;">
	<img src="{{STATIC_URL}}ui/images/global/loading-s.gif"><br><p>{% trans 'Saving Attribute' %}</p>
</div>
<div class="main_col" id="ajax_content">
	<script type="text/javascript">
	function delete_attr_value(this_obj,av_id){
		if(confirm('Are you sure to delete this value ?')){
			if(av_id==0){
				$(this_obj).parent('div').remove();
				$.colorbox.resize();
			}else{
				$.ajax({
				type: "GET",
				url: "{% url 'ajax_admin_portal_business_attributevalues_delete' %}",
				data: "av_id=" + av_id,
				success: function(html_from_server){
					$(this_obj).parent('div').remove();
					$.colorbox.resize();
				}
			});
			}
		}
	}
	$(document).ready(function(){
		$('#id_type').change(function(){
			if($('#id_type').val()=='C'){
				$('.default_value').attr('disabled','disabled');	
			}else{
				$('.default_value').removeAttr('disabled');
			}
		});
		$("#mform").validate({
			highlight: function(element, errorClass){$(element).parent('div').parent('div').addClass('field-error');$(element).addClass('error');},
			unhighlight: function(element, errorClass){$(element).parent('div').parent('div').removeClass('field-error');$(element).removeClass('error');},
			errorPlacement: function(error, element){},
		   	rules:{
		    	name: "required"
		   	}
		});
	});
	function add_atr(){
		if($('#id_type').val()!='C'){
			$('#id_clone div').clone().appendTo('#id_default_p');
			$.colorbox.resize();
			return false;
		}
	}
	</script>
	{% if msg %}<div class="message">{{msg}}</div>{% endif %}
	{% if form.errors %}
		<div class="messageerror" >
			<strong>{% trans 'There is a problem with your submission' %}</strong>
            <ul style="list-style:square;margin-left:20px;">
           		{% for field in form %}
           			{% if  field.errors%}<li>{%for error in field.errors%}{{error}}{%endfor%}</li>{% endif %}
          	 	{% endfor %}
			</ul>
	 	</div>
	{% endif %}
	<div id="add-new-category" class="modal-form">
    <form action="{% url 'admin_portal_business_attributes_update' %}?id={{attributes.id}}" name="mform" id="mform" method="post" class="add_category">{% csrf_token %}
    	<div class="fields hform">
            <div class="field-group">              
                <div class="fields-head">
					<h3>Group - {{ attributegroup.name }} / Category - {{ category.name }}</h3>
					<p class="ltxt80">{% trans "Attribute name pertains to the brand name, product for the particular business category.Eg: Hotel Services, Restaurant Services." %}</p>
                </div>             
                <div class="field text-field">
                    <div class="label"><label>{% trans 'Attribute Name' %}<span class="required-field">*</span></label></div>
                    <div class="value">
                    	{{ form.name }}
						<input type="hidden" id="id_id" name="id" value="{{attributes.id}}">
						<input type="hidden" id="id_gid" name="gid" value="{{attributegroup.id}}">
						<input type="hidden" id="id_cid" name="cid" value="{{category.id}}">
					</div>
                </div> 
				<div class="field text-field">
                    <div class="label"><label>{% trans 'Type' %}</label></div>
                    <div class="value">{{ form.type }}</div>
                </div> 
				<div class="field select-field">
                    <div class="label"><label>{% trans 'Default values' %}</label></div>
                    <div class="value bus_attr" id="id_default_p">
                    	{% if attributes.get_default_values %}
                    	{% for atv in attributes.get_default_values %}
							<div class="group" style="margin-bottom:10px;">
							<input type="hidden" name="av_id" value="{{ atv.id }}" class="default_value" />
                    		<input type="text" name="default_values_{{ atv.id }}" id="default_values_{{ atv.id }}" value="{{ atv.name }}" style="float:left;width:150px;" class="tttxt default_value" maxlength="100" />
							<img onclick="delete_attr_value(this,'{{ atv.id }}');" style="float:right;cursor:pointer;margin-right:100px;padding:5px;" src="{{ STATIC_URL }}ui/images/icons/b/51.png">
							<select name="isstaff_{{ atv.id }}" id="isstaff_{{ atv.id }}" class="select-menu" style="float:left;width:70px;">
								<option value="1" {% if atv.staff_created %}selected="selected"{% endif %}>Show</option>
								<option value="0" {% if not atv.staff_created %}selected="selected"{% endif %}>Hide</option>
							</select>
							<!--a href="javascript:delete_attr_value(this,'{{ atv.id }}');" class="tttxt" style="float:left;color:red;text-decoration:none;">X</a-->
							</div>
						{% endfor %}
						{% else %}
							<input type="text" {% if form.instance.type == 'C' %}disabled='disabled'{% endif %} name="default_values" value="" style="width:150px;" class="tttxt default_value" maxlength="100" />
						{% endif %}
                    </div>
                </div>
				<div style="display:none;" id="id_clone" class="group">
					<div style="margin: 5px 0;">
                		<input type="text" name="default_values" value=""  style="width:150px;" class="tttxt default_value" maxlength="100" />
						<img onclick="delete_attr_value(this,0);" src="{{ STATIC_URL }}ui/images/icons/b/51.png">
					</div>
				</div>
				<div class="field text-field">
                    <div class="value">
                    	<a href="javascript:void(0)" onclick="add_atr()">add more</a>
					</div>
                </div> 
            </div>          
		</div>    
        <div class="modal-base form-submit group">
			<button role="button" class="cform-button {% if attributes %}prime{% endif %} right" type="button" onclick="save_attr(0)"><span class="cform-button-text">{% if attributes %}{% trans 'Update' %}{% else %}{% trans 'Done' %}{% endif %}</span></button>
			{% if not attributes %}<button role="button" class="cform-button prime right" type="button" style="margin-right:10px !important;" onclick="save_attr(1)"><span class="cform-button-text">{% trans 'Save &#38; Add Another' %}</span></button>{% endif %}
		</div>           
    </form>
    <script type="text/javascript" src="{{STATIC_URL}}ui/js/inline.js"></script>
</div>
