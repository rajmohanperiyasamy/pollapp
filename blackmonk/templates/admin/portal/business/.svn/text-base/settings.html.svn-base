{% extends "admin/admin_base.html" %}
{% load tabs %}
{% load i18n %}
{% load get_example %}
{% block navigation %}
	{% activetab 'topnav' 'site' %}
	{{ block.super }}
{% endblock %}
{% block pagetitle %}{% trans 'Business Settings' %} {% endblock %}
{% block head %}
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.common.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/admin/admin_utils.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	$("#mform").validate({
		highlight: function(element, errorClass){
			if(element.id == 'on_update_email' || element.id == 'on_claim_email'){
				$(element).parent('span').addClass('field-error');$(element).addClass('error');
				}
			else{
				$(element).parent('div').parent('div').addClass('field-error');$(element).addClass('error');
			}
		},
		unhighlight: function(element, errorClass){
			if(element.id == 'on_update_email' || element.id == 'on_claim_email'){
				$(element).parent('span').removeClass('field-error');$(element).removeClass('error');
			}
			else{
				$(element).parent('div').parent('div').removeClass('field-error');$(element).removeClass('error');
			}
		},
		errorPlacement: function(error, element){},
	   	rules:{
			meta_title:"required",
			meta_description:"required",
			on_update_email:{required:false,email:true},
			on_claim_email:{required:false,email:true}
	   	}
	});
	
});
function save_approval(){
	var flag = $('#mform').validate().form()
	if(flag){
		var dataString='ajax=true';
		if($('#on_add').is(':checked')){
			dataString+='&on_add=on';
			//dataString+='&on_add_email='+$('#on_add_email').val();
			dataString+='&on_update_email='+$('#on_update_email').val();
		}
		if($('#on_update').is(':checked')){
			dataString+='&on_update=on';
			dataString+='&on_update_email='+$('#on_update_email').val();
		}
		
		if($('#on_claim').is(':checked')){
			dataString+='&on_claim=on';
			dataString+='&on_claim_email='+$('#on_claim_email').val();
		}

		if($('#id_free').is(':checked')){dataString+='&free=on';}
		if($('#id_paid').is(':checked')){dataString+='&paid=on';}
		if($('#id_free_update').is(':checked')){dataString+='&free_update=on';}
		if($('#id_paid_update').is(':checked')){dataString+='&paid_update=on';}
		
		if($('#id_allow_claim').is(':checked')){dataString+='&allow_claim=on';}
		if($('#id_allow_free_buz_claim').is(':checked')){dataString+='&allow_free_buz_claim=on';}
		if($('#id_auto_aprove_free_buz_claim').is(':checked')){dataString+='&auto_aprove_free_buz_claim=on';}
		if($('#id_auto_aprove_paid_buz_claim').is(':checked')){dataString+='&auto_aprove_paid_buz_claim=on';}
		
		dataString+='&meta_title='+encodeURIComponent($('#id_meta_title').val());
		dataString+='&meta_description='+encodeURIComponent($('#id_meta_description').val());
		dataString+='&after_failed_payment='+$('#id_after_failed_payment').val();

		var height = $('#ajax_content').parent('.page-wrap').height();
		$('#ajax_content').parent('.page-wrap').css('height',height)
		$('#ajax_content').fadeOut('fast', function() {
			$('#ajax_content_loading').show();
			$("html, body").animate({ scrollTop: 0 }, "slow");
	    });
		$.ajax({
		type: "POST",
		url: "{% url 'admin_portal_business_approval' %}",
		data: dataString,
		dataType:'json',
		success: function(data){
				setTimeout( function() {
					show_msg(data.msg,data.mtype);
					$('#ajax_content_loading').fadeOut('fast', function() {
						$('#ajax_content').html(data.html);
						$('#id_after_failed_payment').chosen();
						$('#ajax_content').fadeIn();
						$('#ajax_content').parent('.page-wrap').removeAttr('style');
				    });
				}, 500 );
			}
		});
	}
}
function claim_toogle(){
	if($('#id_allow_claim').is(':checked')){
		$('#id_auto_aprove_paid_buz_claim').removeAttr('disabled');	
	}
	else{
		$('#id_auto_aprove_paid_buz_claim').attr('checked',false);
		$('#id_auto_aprove_paid_buz_claim').attr('disabled','disabled');	
	}
	if($('#id_allow_free_buz_claim').is(':checked')){
		$('#id_auto_aprove_free_buz_claim').removeAttr('disabled');
	}
	else{
		$('#id_auto_aprove_free_buz_claim').attr('checked',false);
		$('#id_auto_aprove_free_buz_claim').attr('disabled','disabled');
	}
}
$(document).ready(function(){
	claim_toogle();
	$('#id_allow_claim').live("click",function() {
		claim_toogle();
	});
	$('#id_allow_free_buz_claim').live("click",function() {
		claim_toogle();
	});
});
</script>
{% endblock %}
{% block content %}
<div id="admin_wrapper">
	<div id="admin-platform" class="group">
    	<div class="header-bar">
        	<div id="nav-roll">
            	<ul>
                	<li id="modules-index" class="first"><a href="{% url 'admin_portal' %}" style="z-index:9"><span class="icon"></span>{% trans 'Modules' %}</a></li>
                    <li><a href="{% url 'admin_portal_business' %}" style="z-index:8">{% trans 'Business' %}</a></li>
					<li><a href="{% url 'admin_portal_business_approval' %}" style="z-index:7">{% trans 'Settings' %}</a></li>
				</ul>
			</div>
		</div>
		<div id="core-wraper" class="group">
        	<div class="admin-main col_12">
            	{% block leftnavigation %}
					{% activetab 'topnav' 'site' %}
					{% activetab 'leftnav' 'business' %}
					{% activetab 'leftnavsub' 'bus_set' %}
					{{ block.super }}
				{% endblock %}
                <div class="left-nav-list-bg"></div>
                <div class="col_9 mr_0">
					<div class="page-wrap">
                    	<div class="page-head br_0">
                        	<h2>Business Settings</h2>
							<p class="ltxt80">{% trans 'Specify the settings which pertain to the business module.' %}</p>
                        </div>
                        {% include 'admin/portal/business/include_settings.html' %}
	               	</div>
	         	</div>                       
	       	</div>                            
	        {% include 'admin/portal/business/settings-faq.html' %}                         
		</div>                                                    
	</div>
</div>
{% endblock %}
				
				
				
				
				
				
				
				
				
				