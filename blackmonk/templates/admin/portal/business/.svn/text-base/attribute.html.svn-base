{% extends "admin/admin_base.html" %}
{% load tabs %}
{% load i18n %}
{% load get_example %}
{% block navigation %}
	{% activetab 'topnav' 'site' %}
	{{ block.super }}
{% endblock %}
{% block pagetitle %}{% trans 'Business Attributes' %} {% endblock %}
{% block head %}
<link rel="stylesheet" href="{{STATIC_URL}}ui/css/colorbox.css" type="text/css" />
<script type="text/javascript" src="{% url 'django.views.i18n.javascript_catalog' %}"></script>
<script type="text/javascript">
$(document).ready(function(){
	$('#master-check').click(function(){
		if($("#master-check").is(':checked')){$(".check-overflow").attr('checked',true);}
		else{$(".check-overflow").attr('checked',false);}
	});
});
</script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.common.js"></script>
<script type="text/javascript">
function show_attr(id){
		var dataString='id='+id;
		$('#ajax_content_atr').hide();
		$('#ajax_content_loading_atr').show();
		$.ajax({
		type: "POST",
		url: "{% url 'admin_portal_business_attributes_load' %}",
		data: dataString,
		success: function(data){
				$('#ajax_content_loading_atr').hide();
				$('#ajax_content_atr').empty().html(data);
				$('#ajax_content_atr').show();
				$(".bm-add-gadget").colorbox({width: "560",initialWidth: "560", top:"5%", initialHeight: "200",title:function(){return getLBTitle($(this));}});
			}
		});
}
function save_attr(option){
	var flag = $('#mform').validate().form();
	var values=[];
	var av_id=[];
	if(flag==true){
		var dataString='name='+encodeURIComponent($('#id_name').val());
		try{
			dataString+='&id='+$('#id_id').val();
			id=$('#id_id').val();
		}catch(ex){}
		try{dataString+='&gid='+$('#id_gid').val();}
		catch(ex){}
		dataString+='&cid='+$('#id_cid').val();
		dataString+='&type='+$('#id_type').val();
		$('input[name=av_id]').each(function(){
			av_id.push($(this).val());
		});
		dataString+='&av_id='+av_id;
		for(i=0;i<av_id.length;i++){
			dataString+='&default_values_'+av_id[i]+'='+encodeURIComponent($('#default_values_'+av_id[i]).val());
			dataString+='&isstaff_'+av_id[i]+'='+$('#isstaff_'+av_id[i]).val();
		}
		$('input[name=default_values]').each(function(){
			values.push(encodeURIComponent($(this).val()));
		});
		dataString+='&default_values='+values;
		$('#ajax_content').hide();
		$('#ajax_content_loading').show();
		$.ajax({
		type: "POST",
		url: "{% url 'admin_portal_business_attributes_update' %}",
		data: dataString,
		dataType:'JSON',
		success: function(data){
				$('#atr_'+id).remove();
				$('#append_'+$('#id_gid').val()).find('.collapse-view').addClass('expand-view').removeClass('collapse-view');
				$('#append_'+$('#id_gid').val()).find('.sub-cat-list-container').show()
				$('#append_atr_'+$('#id_gid').val()).append(data.append_html);
				$('.edit_link').colorbox({width: "560",initialWidth: "560", top:"0", initialHeight: "200"});
				$('#ajax_content_loading').html(data.msg);
				$('#ajax_content').empty();
				if(data.status){
					if(option==0){
						show_msg(data.msg,data.mtype);
						$.colorbox.close();
					}
				}
				$.colorbox({html:data.lightbox_html,width: "560",initialWidth: "560", top:"5%", initialHeight: "200",title:'Add New Attribute'});
				$('.modal-form .select-menu').chosen({disable_search_threshold:10});
	  			$('.field-group [title]').tipsy({trigger: 'focus', gravity: 'w',ftip:true});
				setTimeout(function(){
					$('#ajax_content_loading').hide();
				    $('#ajax_content').fadeIn(2000);
					$.colorbox.resize();
				},1000);
			}
		});
	}
}
function delete_attr(ids){
	if(ids==0){
		var ids=[];
		$('input[name=sub]').each(function(){if($(this).is(':checked')){ids.push($(this).val());}});
	}
	if(ids==''){alert(gettext('Please select Attribute(s).'))}
	else{
		if(confirm(gettext('Are you sure want to delete seleced Attribute(s) ?'))){
			$.ajax({
				type: "GET",
				url: "{% url 'admin_portal_business_attributes_delete' %}",
				data: "id="+ids,
				dataType:'JSON',
				success: function(data){
						if(data.status==1){
							try{$('#atr_'+ids).remove();}catch(ex){}
							for(i=0;i<ids.length;i++){$('#atr_'+ids[i]).remove();}
						}
						show_msg(data.msg,data.mtype);
					}
				});
		}
	}
}
</script>
{% endblock %}
{% block content %}
<div id="admin_wrapper">
	<div id="admin-platform" class="group">
    	<div class="header-bar">
        	<div id="nav-roll">
            	<ul>
                	<li id="modules-index" class="first"><a href="{% url 'admin_portal' %}" style="z-index:9"><span class="icon"></span>{% trans 'Modules' %}</a></li>
                    <li><a href="{% url 'admin_portal_business' %}" style="z-index:8">{% trans 'Business' %}</a></li>
                    <li><a href="{% url 'admin_portal_business_attributes' %}" style="z-index:7">{% trans 'Attributes ' %}</a></li>
				</ul>
			</div>
		</div>
		<div id="core-wraper" class="group">
        	<div class="admin-main col_12">
        		{% block leftnavigation %}
					{% activetab 'topnav' 'site' %}
					{% activetab 'leftnav' 'business' %}
					{% activetab 'leftnavsub' 'bus_atr' %}
					{{ block.super }}
				{% endblock %}
                <div class="left-nav-list-bg"></div>
                <div class="col_9 mr_0">
					<div class="page-wrap">
                    	<div class="page-head br_0">
                        	<h2>{% trans 'Attribute' %}</h2>
							<p class="ltxt80">{% trans "Attribute name pertains to the brand name, product for the particular business category.Eg: Hotel Services, Restaurant Services." %}</p>
						</div>
                        <div id="article-categories" class="cat-list group">
                        	<section class="toolbars">
                            	<div class="group">
                                	<ul class="toolbar left">
                                    	<li class="mas-check">
											<span class="checkbox-wrap tttxt-n" title="{% trans 'Select' %}">
												<span class="cform-checkbox-container"><input type="checkbox" id="master-check" name="master-check" class="master-check"><span class="cform-checkbox-element"></span></span>
											</span>
										</li>  
                                        <li class="mas-delete"><a href="javascript:delete_attr(0)" title="{% trans 'Delete' %}" class="tttxt-n inactive"><span class="icon icon-delete"></span></a></li>
									</ul>
                                    <span style="float:right">
                                    	<select class="select-menu" data-placeholder="{% trans 'Select a Category '%}" style="width:250px;" onchange="show_attr($(this).val())">
                                    		<option value=""></option>
											{% for cat in parentcategoryes %}
												<option class="parent" value="{{cat.id}}">{{cat}}</option>
												{% for subcat in cat.getChildCategory %}
	                                    			<option class="child" value="{{subcat.id}}">{{subcat}}</option>
												{% endfor %} 
											{% endfor %}  
                                    	</select>
									</span>
								</div>
							</section>
							<div id="ajax_content_loading_atr" style="display:none;padding-top:150px;text-align:center;">
								<img src="{{STATIC_URL}}ui/images/global/loading-s.gif"><br><p>{% trans 'Loading Attributes' %}</p>
							</div>
							<div id="ajax_content_atr">
								{% include 'admin/portal/business/include_attribute.html' %}   
							</div>
                    	</div>
                	</div>
            	</div>                       
            </div>                            
			{% include 'admin/portal/business/atr-faq.html' %}                          
		</div>                                                    
	</div>
</div>
{% endblock %}
				
				
				
				
				
				
				
				
				
				