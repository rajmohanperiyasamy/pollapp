{% extends "admin/admin_base.html" %}
{% load tabs %}
{% load i18n %}
{% load get_example %}
{% block navigation %}
	{% activetab 'topnav' 'site' %}
	{{ block.super }}
{% endblock %}
{% block pagetitle %}{% trans 'Classifieds Category' %} {% endblock %}
{% block head %}
<link rel="stylesheet" href="{{STATIC_URL}}ui/css/colorbox.css" type="text/css" />
<script type="text/javascript" src="{% url 'django.views.i18n.javascript_catalog' %}"></script>
<script type="text/javascript">
$(document).ready(function(){
	$('#master-check').click(function(){
		if($("#master-check").is(':checked')){$(".check-overflow").attr('checked',true);}
		else{$(".check-overflow").attr('checked',false);}
	});
});
</script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.common.js"></script>
<script type="text/javascript">
function txtarealimit(txtobj,len){
	var txtvalue = txtobj.value;
	var the_len = txtvalue.length;
	if (the_len > len){
		txtobj.value = txtvalue.substring(0,len);
	}
	txtobj.scrollTop=txtobj.scrollHeight;
}
function save_category(option){
	var flag = $('#mform').validate().form();
	if(flag==true){
		var dataString='name='+encodeURIComponent($('#id_name').val());
		dataString+='&slug='+encodeURIComponent($('#id_slug').val());
		dataString+='&parent='+$('#id_parent').val();
		if($('#id_is_rent').is(':checked')){
			dataString+='&is_rent='+$('#id_is_rent').val();
		}
		dataString+='&type_order='+$('#id_type_order').val();
		dataString+='&seo_title='+encodeURIComponent($('#id_seo_title').val());
		dataString+='&seo_description='+encodeURIComponent($('#id_seo_description').val());
		dataString+='&sp_price='+encodeURIComponent($('#id_sp_price').val());
		try{
			dataString+='&id='+$('#id_id').val();
			id=$('#id_id').val();
		}catch(ex){}
		dataString+='&ajax=true';
		$('#ajax_content').hide();
		$('#ajax_content_loading').show();
		$.ajax({
		type: "POST",
		url: "{% url 'admin_portal_classifieds_category_update' %}",
		data: dataString,
		dataType:'JSON',
		success: function(data){
				$('#div_'+id).remove();
				if(data.parent){$('#append_'+data.parent_id).append(data.append_html);}
				else{
					$('#category').append(data.append_html);
					var html_button=$('#sp_price_button').clone();
					$('#sp_price_button').remove();
					$('#category').append(html_button);
				}
				$('.edit_link').colorbox({width: "560",initialWidth: "560", top:"5%", initialHeight: "200"});
				$('#ajax_content_loading').html(data.msg);
				$('#ajax_content').empty();
				if(data.status){
					if(option==0){
						show_msg(data.msg,data.mtype);
						$.colorbox.close();
					}
				}
				$('#ajax_content').html(data.lightbox_html);
				$('.modal-form .select-menu').chosen({disable_search_threshold:10});
	  			$('.field-group [title]').tipsy({trigger: 'focus', gravity: 'w',ftip:true});
				$('html, body').animate({scrollTop:0}, 'fast');
				$('#toolbar').show();
				$('#catlisthead').show();
				$('#sp_price_button').show();
				setTimeout(function(){
					$('#ajax_content_loading').hide();
				    $('#ajax_content').fadeIn(2000);
					$.colorbox.resize();
				},1000);
			}
		});
	}
}
function delete_category(ids){
	if(ids==0){
		var ids=[];
		$('.check-overflow').each(function(){
			if($(this).is(':checked')){
				ids.push($(this).val());
			}
		});
	}
	if(ids=='' || ids==null){
		alert(gettext('Please select category(s).'))
	}
	else{
		if(confirm(gettext('Are you sure want to delete seleced category(s) ?'))){
			$.ajax({
			type: "GET",
			url: "{% url 'admin_portal_classifieds_category_delete' %}",
			data: 'id='+ids,
			dataType:'JSON',
			success: function(data){
					if(data.status==1){
						try{
							$('#div_'+ids).remove();
						}catch(ex){}
						for(i=0;i<ids.length;i++){
							$('#div_'+ids[i]).remove();
						}
						if(data.count == 0){
							$('#toolbar').hide();
							$('#catlisthead').hide();
							$('#sp_price_button').hide();
						}
					}
					show_msg(data.msg,data.mtype);
				}
			});
		}
	}
}
</script>
{% endblock %}
{% block content %}
<div id="admin_wrapper">
	<div id="admin-platform" class="group">
    	<div class="header-bar">
        	<div id="nav-roll">
            	<ul>
                	<li id="modules-index" class="first"><a href="{% url 'admin_portal' %}" style="z-index:9"><span class="icon"></span>{% trans 'Modules' %}</a></li>
                    <li><a href="{% url 'admin_portal_classifieds' %}" style="z-index:8">{% trans 'Classifieds' %}</a></li>
                    <li><a href="{% url 'admin_portal_classifieds_category' %}" style="z-index:7">{% trans 'Categories' %}</a></li>
				</ul>
			</div>
		</div>
		<div id="core-wraper" class="group">
        	<div class="admin-main col_12">
        		{% block leftnavigation %}
					{% activetab 'topnav' 'site' %}
					{% activetab 'leftnav' 'classifieds' %}
					{% activetab 'leftnavsub' 'cls_cat' %}
					{{ block.super }}
				{% endblock %}
                <div class="left-nav-list-bg"></div>
                <div class="col_9 mr_0">
					<div class="page-wrap">
                    	<div class="page-head br_0">
                        	<h2>{% trans 'Categories' %}</h2>
							<p class="ltxt80">{% trans "Try to add the category that best fits in the Classifieds module.For example: 'Autos & Vehicles' as a category." %}</p>
						</div>
                        <div id="classifieds-categories" class="cat-list group">
                        	<section class="toolbars">
                            	<div class="group">
                                	<ul class="toolbar left" id="toolbar" style="{% if not parentcategoryes %}display: none;{% endif %}">
                                    	<li class="mas-check"><span class="checkbox-wrap tttxt-n" title="{% trans 'Select' %}">
										<span class="cform-checkbox-container"><input type="checkbox" id="master-check" name="master-check" class="master-check"><span class="cform-checkbox-element"></span></span>
										</span></li>  
                                        <li class="mas-delete"><a href="javascript:delete_category(0)" title="{% trans 'Delete' %}" class="tttxt-n"><span class="icon icon-delete"></span></a></li>
										<li class="mas-toggle">
                                          <a href="#" class="expand-view tttxt-n" title="Expand All">Expand All</a>
                                          <a href="#" class="collapse-view tttxt-n" title="Collapse All">Collapse All</a>
                                    	</li>
									</ul>
                                    <span style="float:right">
                                    	<a href="{% url 'admin_portal_classifieds_category_update' %}" title="{% trans 'Add New Category' %}" class="btn-txt-inline-prime bm-add-gadget-clasfied"><span class="btn-txt">{% trans 'Add New Category' %}</span></a>
									</span>
								</div>
							</section>
							<input type='hidden' id='pcatcount' val="{{pcatcount}}">
                            <ul class="cat-list-container collaps-view carousal-list monthly-pricing-list" id="category">
                            	<li class="cat-list-row hdr-rw" id="catlisthead" style="{% if not parentcategoryes %}display: none;{% endif %}">
                                	<div class="cat-list-row-inner group">
                                        <div class="cat-list-column cat-name">&nbsp;</div>
                                        <div class="cat-list-column cat-price" style="margin: 0px; padding-bottom: 10px; padding-top: 7px;">
                                            <span class="price-field inline-block">Price ({{globalsettings.currency}})</span>
                                        </div>
                                    </div>
                                </li>
                            	{% for cat in parentcategoryes %}
								<li class="cat-list-row  collaps-view carousal-list" id="div_{{cat.id}}">
                                	<div class="cat-list-row-inner group">
                                        {% if cat.name != 'Uncategorized' %}
                                    	<span class="checkbox-wrap">
										<span class="cform-checkbox-container"><input type="checkbox" id="category" value="{{cat.id}}" name="category" class="check-overflow"><span class="cform-checkbox-element"></span></span>
										</span>
                                        {% endif %}
                                        <div class="cat-list-column cat-name"><h3>{{cat}}</h3></div>
										<div class="cat-list-column cat-price">
										  <span class="price-field inline-block">
										  	<input type="text" id="sp_cost{{cat.id}}" value="{{cat.sp_price|floatformat:2}}" placeholder="00.00" class="inline-block sp_price" disabled="disabled">
											<input type="hidden" name="sp_cost_id" class="sp_cost_id" value="{{cat.id}}">
										</span>
										</div> 
										{% if cat.name != 'Uncategorized' %}
                                        <div class="cat-list-column action-buttons">
                                        	<div class="group">
                                            	<!--a title="{% trans 'View Stats' %}" class="tttxt-n" href="#"><span class="icon icon-stats"></span></a-->
                                                <a href="{% url 'admin_portal_classifieds_category_update' %}?id={{cat.id}}&parent=1" title="{% trans 'Update Category' %}" class="tttxt-n bm-add-gadget-clasfied"><span class="icon icon-edit"></span></a>
                                                <a title="{% trans 'Delete' %}" class="tttxt-n" href="javascript:delete_category({{cat.id}})"><span class="icon icon-delete"></span></a>
                                            </div>                                                            
										</div>
										{% endif %}
										<div class="cat-list-column item-view-toggle">
                                          <a href="#" class="collapse-view">Expand View</a>
                                        </div>
									</div>
									<ul class="sub-cat-list-container" id="append_{{cat.id}}">
									{% for subcat in cat.get_category %}
	                                    <li class="sub-cat-list-row" id="div_{{subcat.id}}">
	                                    	<div class="sub-cat-list-row-inner group">
                                                {% if subcat.name != 'Uncategorized' %}
	                                        	<span class="checkbox-wrap">
												<span class="cform-checkbox-container"><input type="checkbox" value="{{subcat.id}}" id="sub{{subcat.id}}" name="category" class="check-overflow"><span class="cform-checkbox-element"></span></span>
												</span>
                                                {% endif %}
	                                            <div class="cat-list-column cat-name">
	                                                <h3>{{subcat}}</h3>
	                                            </div>
	                                            {% if subcat.name != 'Uncategorized' %}
	                                            <div class="cat-list-column action-buttons">
	                                                <div class="group">
	                                                    <!--a title="{% trans 'View Stats' %}" class="tttxt-n" href="#"><span class="icon icon-stats"></span></a-->
		                                                <a href="{% url 'admin_portal_classifieds_category_update' %}?id={{subcat.id}}" title="{% trans 'Update Category' %}" class="tttxt-n bm-add-gadget-clasfied"><span class="icon icon-edit"></span></a>
		                                                <a title="{% trans 'Delete' %}" class="tttxt-n" href="javascript:delete_category({{subcat.id}})"><span class="icon icon-delete"></span></a>
		                                            </div>                                                           
	                                            </div>
	                                            {% endif %}
	                                        </div>                                                    
	                                    </li>
									{% endfor %} 
									</ul>  
								</li>  
								{% endfor %}  
								<li class="cat-list-row ftr-rw" id="sp_price_button" style="{% if not parentcategoryes %}display: none;{% endif %}">
                                    <div class="cat-list-row-inner group">
                                        <div class="cat-list-column cat-name">&nbsp;</div>
                                        <div class="cat-list-column cat-price">
                                           <button role="button" id="price_update" style="display:none;" class="btn-txt-blue small" type="button">
                                           		<span class="btn-txt">Update</span>
										   </button>
										   <button role="button" id="price_change" class="btn-txt-blue small" type="button">
                                           		<span class="btn-txt">Change</span>
										   </button>
                                        </div>
                                    </div>
                                </li>                                            
							</ul>                          
                    	</div>
                	</div>
            	</div>                       
            </div>                            
			{% include 'admin/portal/classifieds/cat-faq.html' %}                          
		</div>                                                    
	</div>
</div>
<script type="text/javascript">
$(document).ready(function(){
	$('#price_change').live("click",function(){
		$('.sp_price').removeAttr('disabled');
		$('#price_change').hide()
		$('#price_update').show()
	});
	$('#price_update').live("click",function(){
		var sp_cost_id=[];
		var dataString='';
		$('input[name=sp_cost_id]').each(function(){
			sp_cost_id.push($(this).val());
		});
		for(i=0;i<sp_cost_id.length;i++){
			dataString+="&sp_price"+sp_cost_id[i]+"="+($('#sp_cost'+sp_cost_id[i]).val());
		}
		$('.sp_price').attr('disabled',true);
		$('#price_update').hide();
		$('#price_change').show();
		$.ajax({
			type: "POST",
			url: "{% url 'admin_portal_classifieds_sponsored_price' %}",
			data: dataString,
			dataType:'JSON',
			success: function(data){show_msg(data.msg,data.mtype);}
			});
	});
});
</script>
{% endblock %}
				
				
				
				
				
				
				
				
				
				