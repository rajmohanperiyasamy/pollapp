{% load i18n %}
<div id="ajax_content_loading" style="display:none;padding-top:96px;text-align:center;">
	<img src="{{STATIC_URL}}ui/images/global/loading-s.gif"><br><p>{% trans 'Saving Hotel API Settings' %}</p>
</div>
<div id="hotel_api_settings_div" class="group">
<script type="text/javascript">
$(document).ready(function(){
	$("#mform").validate({
		highlight: function(element, errorClass){$(element).parent().parent().addClass('field-error');$(element).addClass('error');},
		unhighlight: function(element, errorClass){$(element).parent().parent().removeClass('field-error');$(element).removeClass('error');},
		errorPlacement: function(error, element){},
	   	rules:{
			option: "required",
			city: "required",
			api_key:"required",
			customer_id:"required",
			meta_title:"required",
			meta_description:"required"
	   	}
	});
	$('#url_validate_button').live("click",function(){
		var flag=$("#mform").validate().form();
		if(flag){
			var dataString='city='+$('#id_city').val();
			dataString+='&api_key='+$('#id_api_key').val();
			dataString+='&customer_id='+$('#id_customer_id').val();
			$.ajax({
				type:'post',
				url:'{% url 'admin_validate_hotels_api' %}',
				data:dataString,
				success:function(data){
					if(data=='1'){show_msg('API details specified is valid.','alert-success')}
					else{show_msg('Oops!!! API details specified is invalid.','alert-error')}
				}
			
			})
		}
	});
});
</script>
	{% if form.errors %}
		<div class="messageerror">
			<strong>{% trans 'There is a problem with your submission' %}</strong>
            <ul style="list-style:square;margin-left:20px;">
           		{% for field in form %}
           			{% if  field.errors%}<li>{%for error in field.errors%}{{error}}{%endfor%}</li>{% endif %}
          	 	{% endfor %}
			</ul>
	 	</div>
	{% endif %}
	{% if seoform.errors %}
		<div class="messageerror">
			<strong>{% trans 'There is a problem with your submission' %}</strong>
            <ul style="list-style:square;margin-left:20px;">
           		{% for field in seoform %}
           			{% if  field.errors%}<li>{%for error in field.errors%}{{error}}{%endfor%}</li>{% endif %}
          	 	{% endfor %}
			</ul>
	 	</div>
	{% endif %}
    <form action="{% url 'admin_api_update_hotel_api_settings' %}" name="mform" id="mform" method="post" class="add_category">{% csrf_token %}
    	<div class="fields hform">
				<section id="signin-with-facebook" class="section">
                	<div class="section-head">
						<h3 class="section-title tttxt-e" title="{% trans 'Select' %}">
							<span class="favicon"><img src="http://www.expediaaffiliate.com/sites/default/files/ean_favicon.ico" /></span>
							{% trans 'Expedia' %}
						</h3>
                   	</div>
                    <div class="section-content" >
                    	<div class="section-explanation">
                	<p class="ltxt80">{% trans 'Fill the API Key, Customer ID and Trip Advisor Affiliate ID in the below text box.' %}</p>
               	</div>  
        			<div class="field-group" id="meta-tags">
						<div class="field text-field">	
		                	<div class="label"><label>{% trans 'City' %}<span class="required-field">*</span></label></div>	
		                	<div class="value">{{form.city}}</div>	
		                </div>
						<div class="field text-field">	
		                	<div class="label"><label>{% trans 'API Key' %}<span class="required-field">*</span></label></div>	
		                	<div class="value">{{form.api_key}}</div>	
		                </div>
						<div class="field text-field">	
		                	<div class="label"><label>{% trans 'Customer ID' %}<span class="required-field">*</span></label></div>	
		                	<div class="value">{{form.customer_id}}</div>	
		                </div>
						<div class="field text-field">	
		                	<div class="label"><label>{% trans 'Trip Advisor Affiliate ID' %}</label></div>	
		                	<div class="value">{{form.tripadvisor_key}}</div>	
		                </div>
						<div class="field text-field">	
		                	<div class="label"><label>{% trans 'Meta Title (SEO)' %}<span class="required-field">*</span></label></div>	
		                	<div class="value"><input type="text" id="id_meta_title" {% if form.errors %} value="{{form.meta_title.data}}" {% else %}value="{{seo.seo_title}}" {% endif %} class="fm" placeholder="{% trans 'Enter a short title' %}" maxlength="400"  name="meta_title" autocomplete="off"></div>	
		                </div>
						<div class="field text-field">	
		                	<div class="label"><label>{% trans 'Meta Description (SEO)' %}<span class="required-field">*</span></label></div>	
		                	<div class="value"><textarea onkeyup="txtarealimit(this,400);" class="fm" name="meta_description" id="id_meta_description" rows="4">{% if form.errors %}{{form.meta_description.data}}{% else %}{{seo.seo_description}} {% endif %} </textarea></div>	
		                </div>
        			</div>                 
				</div>                                                                  
    		</section> <!-- end section --> 
		</div>    
    	<div class="modal-base form-submit group trp-bg right" style="padding-right:0;">
			<button role="button" class="cform-button" id="url_validate_button" type="button" style="margin-right:3px;"><span class="cform-button-text">{% trans 'Validate API' %}</span></button>
	  		<button role="button" class="cform-button prime right" type="button" onclick="save_hotel_settings();"><span class="cform-button-text">{% trans 'UPDATE' %}</span></button>
		</div>           
    </form>
</div> 

<script type="text/javascript">
function save_hotel_settings(){
	var success = $('#mform').validate().form();  
	if (success){
		var datastring='option=E&city='+$('#id_city').val()+'&api_key='+$('#id_api_key').val()+'&customer_id='+$('#id_customer_id').val()+'&tripadvisor_key='+$('#id_tripadvisor_key').val();
		datastring+='&meta_title='+$('#id_meta_title').val();
		datastring+='&meta_description='+$('#id_meta_description').val();
		$('#hotel_api_settings_div').hide();
		$('#ajax_content_loading').show();
		var url = $('#mform').attr('action');
		$.ajax({
		type: "POST",
		url: url,
		data: datastring,
		dataType:'JSON',
		success: function(data){
				show_msg(gettext(data.msg),data.mtype);
				$('#ajax_content_loading').hide();
				$('#hotel_api_settings_div').fadeIn(800).html(data.html);
			}
		});
	}
}
</script>    