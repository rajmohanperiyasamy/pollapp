{% load i18n %}
<div id="ajax_content_loading" style="display:none;padding-top:96px;text-align:center;">
	<img src="{{STATIC_URL}}ui/images/global/loading-s.gif"><br><p>{% trans 'Saving Twitter API Settings' %}</p>
</div>
<div id="flower_api_settings_div" class="group">

	<script type="text/javascript">
	$(document).ready(function(){
		$("#mform").validate({
			highlight: function(element, errorClass){$(element).parent().parent().addClass('field-error');$(element).addClass('error');},
			unhighlight: function(element, errorClass){$(element).parent().parent().removeClass('field-error');$(element).removeClass('error');},
			errorPlacement: function(error, element){},
		   	rules:{
				twitter_user:"required",
				twitter_auth_key:"required",
				twitter_auth_secret:"required",
				twitter_consumer_key:"required",
				twitter_consumer_secret:"required",
				meta_title:"required",
				meta_description:"required",
		   	}
		});
	});
	</script>
	{% if form.errors %}
		<div class="messageerror">
			<strong>{% trans 'There is a problem with your submission' %}</strong>
            <ul style="list-style:square;margin-left:20px;">
           		{% for field in form %}
           			{% if  field.errors%}<li>{%for error in field.errors%}{{error}}{%endfor%}</li>{% endif %}
          	 	{% endfor %}
			</ul>
	 	</div>
	{% endif %}
	{% if seoform.errors %}
		<div class="messageerror">
			<strong>{% trans 'There is a problem with your submission' %}</strong>
            <ul style="list-style:square;margin-left:20px;">
           		{% for field in seoform %}
           			{% if  field.errors%}<li>{%for error in field.errors%}{{error}}{%endfor%}</li>{% endif %}
          	 	{% endfor %}
			</ul>
	 	</div>
	{% endif %}
    <form action="{% url 'admin_api_update_twitterapi_settings' %}" name="mform" id="mform" method="post" class="add_category">{% csrf_token %}
    	<ul class="overview-list group">
			<li class="list-item-container group">
            	<div class="col-dt">
                	<div class="col-inner">
                    	<h5>{% trans 'Categories' %}</h5>
                   	</div>
               	</div>
                <div class="col-dd">
                	<div class="col-inner">
                    	<h3>{{buzz_cat}}</h3>
                        <a href="{% url 'adminportal_buzz_categories' %}" class="action edit-icon tttxt start-modal" title="{% trans 'Manage Categories' %}">{% trans 'Manage' %}</a>
                  	</div>                                                    
				</div>
			</li>
			<li class="list-item-container group">
            	<div class="col-dt">
                	<div class="col-inner">
                    	<h5>{% trans 'Twitter Lists' %}</h5>
                   	</div>
               	</div>
                <div class="col-dd">
                	<div class="col-inner">
                    	<h3>{{twitter_list}}</h3>
                        <a href="{% url 'adminportal_buzz_twitter_lists' %}" class="action edit-icon tttxt start-modal" title="{% trans 'Manage Twitter Lists' %}">{% trans 'Manage' %}</a>
                  	</div>                                                    
				</div>
			</li>
        </ul>
		<div class="fields vform no_head"> 
            <div id="meta-tags" class="field-group">
                <div class="fields-head">
                    <h3>{% trans 'Page Title (SEO)' %}</h3>
                    <p class="ltxt80">{% trans 'Write a short page title. This title is used in the search results of search engines like Google.' %}</p> 
                </div>  
                <div class="field text-field">	
                    <div class="value">
                        <input class="fxl" title="{% trans 'Meta Title' %}" name="meta_title" id="id_meta_title" type="text" placeholder="{% trans 'Enter a short title' %}" {% if seo_form.errors %} value="{{seo_form.meta_title.data}}" {% else %}value="{{seo.seo_title}}" {% endif %}  >
                    </div>	
                </div>
            </div>   
        </div> 
        <div class="fields vform no_head"> 
            <div id="meta-tags" class="field-group">
                <div class="fields-head">
                    <h3>{% trans 'Page Description (SEO)' %}</h3>
                    <p class="ltxt80">{% trans 'In one or two short sentences to describe your page. This description is used in the search results of search engines like Google.' %}</p> 
                </div>  
                <div class="field text-field">	
                    <div class="value">
                        <textarea rows="8" id="id_meta_description" name="meta_description" class="fxl" placeholder="{% trans 'Enter description' %}" onkeyUp="txtarealimit(this,400);">{% if seo_form.errors %}{{seo_form.meta_description.data}}{% else %}{{seo.seo_description}} {% endif %}</textarea>
                    </div>	
                </div>
            </div>   
        </div>
		<div class="fields hform">
				<section id="signin-with-facebook" class="section">
                	<div class="section-head">
                    	<label for="doubleclick" class="check-in">
						</label>
						<h3 class="section-title tttxt-e checkbox-left" style="padding-left:10px;">
							{% trans 'Twitter Settings' %}
						</h3>
                   	</div>
                    <div class="section-content" >
                    	<div class="fields hform">
            			<div class="field-group" id="meta-tags">
            				<div class="field text-field">	
			                	<div class="label"><label>{% trans 'Username' %}<span class="required-field">*</span></label></div>	
			                	<div class="value">{{form.twitter_user}}</div>	
			                </div>
							<div class="field text-field">	
			                	<div class="label"><label>{% trans 'Access Token' %}<span class="required-field">*</span></label></div>	
			                	<div class="value">{{form.twitter_auth_key}}</div>	
			                </div>
							<div class="field text-field">	
			                	<div class="label"><label>{% trans 'Access Token Secret' %}<span class="required-field">*</span></label></div>	
			                	<div class="value">{{form.twitter_auth_secret}}</div>	
			                </div>
							<div class="field text-field">	
			                	<div class="label"><label>{% trans 'Consumer Key' %}<span class="required-field">*</span></label></div>	
			                	<div class="value">{{form.twitter_consumer_key}}</div>	
			                </div>
							<div class="field text-field">	
			                	<div class="label"><label>{% trans 'Consumer Secret' %}<span class="required-field">*</span></label></div>	
			                	<div class="value">{{form.twitter_consumer_secret}}</div>	
			                </div>
            			</div>                 
					</div>
					</div>                                                                  
    		</section> <!-- end section --> 
		</div>    
    	<div class="modal-base form-submit group trp-bg">
	  		<button role="button" class="cform-button prime right" type="button" onclick="save_api_settings();"><span class="cform-button-text">{% trans 'UPDATE' %}</span></button>
		</div>           
    </form>
</div> 

<script type="text/javascript">
function save_api_settings(){
	var success = $('#mform').validate().form();  
	if (success){
		var datastring='twitter_user='+$('#id_twitter_user').val();
		datastring+='&twitter_auth_key='+$('#id_twitter_auth_key').val();
		datastring+='&twitter_auth_secret='+$('#id_twitter_auth_secret').val();
		datastring+='&twitter_consumer_key='+$('#id_twitter_consumer_key').val();
		datastring+='&twitter_consumer_secret='+$('#id_twitter_consumer_secret').val();
		datastring+='&meta_title='+$('#id_meta_title').val();
		datastring+='&meta_description='+$('#id_meta_description').val();
		
		var height = $('#flower_api_settings_div').parent('.page-wrap').height();
		$('#flower_api_settings_div').parent('.page-wrap').css('height',height)
		$('#flower_api_settings_div').fadeOut('fast', function() {
			$('#ajax_content_loading').show();
			$("html, body").animate({ scrollTop: 0 }, "slow");
	    });
		
		
		var url = $('#mform').attr('action');
		$.ajax({
		type: "POST",
		url: url,
		data: datastring,
		dataType:'JSON',
		success: function(data){
				show_msg(gettext(data.msg),data.mtype);
				$('#ajax_content_loading').fadeOut('fast', function() {
						$('#flower_api_settings_div').html(data.html);
						$('#flower_api_settings_div').fadeIn();
						$('#flower_api_settings_div').parent('.page-wrap').removeAttr('style');
				  });
				
			}
		});
	}
}
</script>    