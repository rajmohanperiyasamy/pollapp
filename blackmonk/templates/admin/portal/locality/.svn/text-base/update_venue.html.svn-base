{% extends "admin/admin_base.html" %}
{% load tabs %}
{% load upload_tags %}
{% load i18n %}
{% load get_example %}
{% block navigation %}
	{% activetab 'topnav' 'config' %}
	{{ block.super }}
{% endblock %}
{% block pagetitle %}{% trans 'Location/Map Venue' %} {% endblock %}
{% block head %}
<script type="text/javascript">
$(document).ready(function(){
	$('#master-check').click(function(){
		if($("#master-check").is(':checked')){$(".check-overflow").attr('checked',true);}
		else{$(".check-overflow").attr('checked',false);}
	});
});
</script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery.validate.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.common.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/bsn.AutoSuggest_2.0/bsn.AutoSuggest_c_2.0.js"></script>
<link rel="stylesheet" href="{{ STATIC_URL }}js/bsn.AutoSuggest_2.0/autosuggest_inquisitor.css" type="text/css" media="screen" charset="utf-8" />
<script src="http://maps.googleapis.com/maps/api/js?v=3&sensor=false{% if globalsettings.google_map_key %}&key={{ globalsettings.google_map_key }}{% endif %}" type="text/javascript"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/general/google_map.js"></script>
<script type="text/javascript">
function delete_venue(){
	var ids=[];
	$('.check-overflow').each(function(){
		if($(this).is(':checked')){
			ids.push($(this).val());
		}
	});
	if(ids=='' || ids==null){
		alert('Please select Zipcode(s).')
	}
	else{
		if(confirm('Are you sure want to delete seleced Venue(s) ?')){
			window.location.replace("{% url 'admin_portal_locality_venue_delete' %}?id="+ids);
		}
	}
}
</script>
<!--script type="text/javascript" src="{{ STATIC_URL }}js/general/google_map.js"></script-->
<script type="text/javascript">
$(document).ready(function(){
	$("#mform").validate({
		highlight: function(element, errorClass){$(element).parent('div').parent('div').addClass('field-error');$(element).addClass('error');},
		unhighlight: function(element, errorClass){$(element).parent('div').parent('div').removeClass('field-error');$(element).removeClass('error');},
		errorPlacement: function(error, element){},
	   	rules: {
	    	venue:"required",
			address1:"required",
			type:"required",
			zip:"required",
			city:"required",
			type:"required",
			email:{
				email:"true"	
			     },
			website:{
				url:"true"	
			     }    
	   	}
	});
});
function custom_validate(){
	var photo_list=[];
	window.document.mform.lat_lng.value = marker.getPosition();
	window.document.mform.zoom.value = map.getZoom();
	$('.new_pic_uploaded').each(function(){
		if($(this).val()!=""){
			photo_list.push($(this).val());
		}
	});
	$('#id_photo_list').val(photo_list);
	var flag = $('#mform').validate().form()
	var flag1=false;
	if($('#id_type').val()!=""){
		$('#id_type').parent('div').parent('div').removeClass('field-error');
		flag1=true;
	}else{
		$('#id_type').parent('div').parent('div').addClass('field-error');
		flag1=false;
	}
	if(flag==true && flag1==true){
		return true;
	}else{
		return false;
	}
}
</script>
{% endblock %}
{% block content %}
<div id="admin_wrapper">
	<div id="admin-platform" class="group">
    	<div class="header-bar">
        	<div id="nav-roll">
            	<ul>
                	<li id="config-index" class="first"><a href="{% url 'admin_configuration' %}" style="width:120px;z-index:9"><span class="icon"></span>{% trans 'Settings' %}</a></li>
				    <li><a href="{% url 'admin_portal_locality' %}" style="z-index:8">{% trans 'Location/Map' %}</a></li>
				    <li><a href="{% url 'admin_portal_locality_venue' %}" style="z-index:7">{% trans 'Venue' %}</a></li>
					<li><a href="{% if venue %}{% url 'admin_portal_locality_venue_edit' venue.id %}{% else %}{% url 'admin_portal_locality_venue_add' %}{% endif %}" style="z-index:6">{% if venue %}{% trans 'Update' %}{% else %}{% trans 'Add' %}{% endif %}</a></li>
				</ul>
          	</div>
		</div>
		<div id="core-wraper" class="group">
        	<div class="admin-main col_12">
            	<div class="left-nav-list modules col_3">
                	{% block leftnavigation %}
						{% activetab 'topnav' 'config' %}
						{% activetab 'leftnav' 'location' %}
						{% activetab 'leftnavsub' 'loc_venue' %}
						{{ block.super }}
					{% endblock %}
              	</div>
                <div class="left-nav-list-bg"></div>
                <div class="col_9 mr_0">
					<div class="page-wrap">
                    	<div class="page-head br_0">
                        	<h2>Venue</h2>
                        </div>
						<div id="ajax_content_loading" style="display:none;padding-top:250px;text-align:center;">
							<img src="{{STATIC_URL}}ui/images/global/loading-s.gif"><br><p>{% trans 'Saving Venue' %}</p>
						</div>
                        <div id="ajax_content" class="modal-form">
                            {% if form.errors %}
								<div class="messageerror" >
									<strong>{% trans 'There is a problem with your submission' %}</strong>
							        <ul style="list-style:square;margin-left:20px;">
							       		{% for field in form %}
							       			{% if  field.errors%}<li>{%for error in field.errors%}{{error}}{%endfor%}</li>{% endif %}
							      	 	{% endfor %}
									</ul>
							 	</div>
							{% endif %}
							<form action="{% if venue %}{% url 'admin_portal_locality_venue_edit' venue.id %}{% else %}{% url 'admin_portal_locality_venue_add' %}{% endif %}" onsubmit="custom_validate()" name="mform" id="mform" method="post" class="add_category">{% csrf_token %}
								<div class="fields hform">
							        <div class="field-group">              
							            <div class="fields-head">
							            	<h3>Point Location</h3>
							            </div>             
							            <div class="field">
							            	<input type="hidden" value="{% if zipcode %}?id={{zipcode.id}}{% endif %}" id="id_id" name="id"> 
							                <input type="hidden" name="lat_lng" id="lat_lng" value=""/>
											<input type="hidden" name="zoom" id="zoom" value=""/>
											<div id="map" style="width: 500px; height: 180px; margin-bottom:20px; position: relative; background-color: rgb(229, 227, 223);"></div>
							            </div> 
							        </div>          
							        <div id="meta-tags" class="field-group">
										<div class="fields-head">
							            	<h3>Location Info</h3>
										</div>                    
							            <div class="field text-field">	
							            	<div class="label"><label>{% trans 'Venue' %}<span class="required-field">*</span></label></div>	
							            	<div class="value">
							            		{{ form.venue }}
												<input type="hidden" id="id_photo_list" name="photo_list">
												<input type="hidden" class="new_pic_uploaded">
												{% if not venue %}
													<input type="hidden" value="true" name="add_venue">
												{% endif %}
											</div>	
							            </div>
										<div class="field text-field">	
							            	<div class="label"><label>{% trans 'Address' %}<span class="required-field">*</span></label></div>	
							            	<div class="value">{{ form.address1 }}</div>	
							            </div>
										<div class="field text-field">	
							            	<!--div class="label"><label>{% trans 'Zipcode' %}</label></div-->	
							            	<div class="value">{{ form.address2 }}</div>	
							            </div>
                                        <div class="field text-field">	
							            	<div class="label"><label>{% trans 'City' %}<span class="required-field">*</span></label></div>	
							            	<div class="value">{{ form.city }}</div>	
							            </div>
										<div class="field text-field">	
							            	<div class="label"><label>{% trans 'Zip/Postalcode' %}<span class="required-field">*</span></label></div>	
							            	<div class="value">{{ form.zip }}</div>	
							            </div>
										<div class="field select-field">	
							            	<div class="label"><label>{% trans 'Type' %}<span class="required-field">*</span></label></div>	
							            	<div class="value">{{ form.type }}</div>	
							            </div>
										<div class="field text-field">	
							            	<div class="label"><label>{% trans 'Primary Telephone' %}</label></div>	
							            	<div class="value">{{ form.telephone1 }}</div>	
							            </div>
										<div class="field text-field">	
							            	<div class="label"><label>{% trans 'Secondary Telephone' %}</label></div>	
							            	<div class="value">{{ form.telephone2 }}</div>	
							            </div>
										<div class="field text-field">	
							            	<div class="label"><label>{% trans 'Mobile' %}</label></div>	
							            	<div class="value">{{ form.mobile }}</div>	
							            </div>
										<div class="field text-field">	
							            	<div class="label"><label>{% trans 'Email ID' %}</label></div>	
							            	<div class="value">{{ form.email }}</div>	
							            </div>
										<div class="field text-field">	
							            	<div class="label"><label>{% trans 'Website' %}</label></div>	
							            	<div class="value">{{ form.website }}</div>	
							            </div>
										<div class="field text-field">	
							            	<div class="label"><label>{% trans 'Description' %}</label></div>	
							            	<div class="value">{{ form.description }}</div>	
							            </div>
							        </div>  
									<div class="field-group">
										<div class="fields-head">
							            	<h3>Image Upload</h3>
										</div>    
										<div class="field">
											<div id="fileupload">
											 	<div class="fileupload-content" style="padding-left:20px;">
											    	<ul class="files bm-uploader-list"></ul>
												</div>
								    			<div id="bm-dropzone_area" class="dropzone">Drop the files here</div>
								            	{% csrf_token %}
								            	<div class="upload-button-wrapper"  style="padding-left:20px;">
								              		<a class="upload-button">Add Images</a>
								                    <div class="fileinput-button">
								                        <input type="file" name="photo" id="id_photo" multiple=""  accept="image/*" tabindex="-1">
								                    </div>
								                </div>
											</div>
										</div>
							        </div>             
								</div>    
							    <div class="modal-base form-submit group trp-bg" >
								   	<button role="button" class="cform-button {% if venue %}prime{% endif %} right" type="submit"><span class="cform-button-text">{% if venue %}{% trans 'Update' %}{% else %}{% trans 'Done' %}{% endif %}</span></button>
									{% if not venue %}<button role="button" class="cform-button prime right" type="submit" name="addanother" style="margin-right:10px !important;"><span class="cform-button-text">{% trans 'Save &#38; Add Another' %}</span></button>{% endif %}
								</div>  
							</form>
                        </div>
                    </div>
                </div>                       
            </div>     
		</div>                                                    
	</div>
</div>
<script type="text/javascript">
{% if venue %}
	setTimeout(function() {
		load_for_add('map',{{ venue.lat }}, {{ venue.lon }}, {{ venue.zoom }},'{{ venue.venue }}','{{ venue.address1 }}<br>{{ venue.city }} - {{ venue.zip }}');
	}, 500);
{% else %}
	setTimeout(function() {
		load_for_add('map',{{globalsettings.google_map_lat }}, {{ globalsettings.google_map_lon }}, {{ globalsettings.google_map_zoom }},"{{ globalsettings.city }}","select the location");
	}, 1200);
{% endif %}
</script>
{% upload_js %}
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.jfp.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery/bm.fup.appln.js"></script>
<link type="text/css" rel="stylesheet" href="{{STATIC_URL}}css/bm.jfp.ui.css">
<script type="text/javascript">
$(document).ready(function(){
	file_upload('{% url 'admin_locality_ajax_upload_photos' %}?id={{venue.id}}',5);
	$('#id_city').live("keyup",function(){
getPin(getaddress(),$('#id_zip').val());
});
});
function getaddress(){return $('#id_address1').val()+" "+$('#id_address2').val()+" "+$('#id_city').val();}
function fun(){
	var options = {
		minchars:1,
		script:"{% url 'admin_locality_auto_suggest_pin' %}?",
		varname:"input",
		json:true,
		callback: function (obj) { document.getElementById('id_zip').value = obj.value; }
	};
	var as_json = new AutoSuggest('id_zip', options);
}
</script>  
{% endblock %}
				
				
				
				
				
				
				
				
				
				