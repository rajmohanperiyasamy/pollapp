 {% load i18n %}
<div id="ajax_content_loading" style="display:none;padding-top:222px;padding-bottom:350px;text-align:center;">
	<img src="{{STATIC_URL}}ui/images/global/loading-s.gif"><br><p>{% trans 'Saving Zipcode' %}</p>
</div>
<div class="main_col" id="ajax_content">
	<script type="text/javascript">
	$(document).ready(function(){
		$("#mform").validate({
			highlight: function(element, errorClass){$(element).parent('div').parent('div').addClass('field-error');$(element).addClass('error');},
			unhighlight: function(element, errorClass){$(element).parent('div').parent('div').removeClass('field-error');$(element).removeClass('error');},
			errorPlacement: function(error, element){},
		   	rules:{
		    	zip: "required"
		   	}
		});
	});
	function custom_validate(){
		var flag = $('#mform').validate().form()
		var lat_lng = marker.getPosition();
		var zoom = map.getZoom();
		$('#lat_lng').val(lat_lng);
		$('#zoom').val(zoom);
		if(flag){return true;}
		else{return false;}
	}
	</script>
	<div id="add-new-category" class="modal-form">
    <form action="{% url 'admin_portal_locality_zipcode_update' %}{% if zipcode %}?id={{zipcode.id}}{% endif %}" onsubmit="return custom_validate();" name="mform" id="mform" method="post" class="add_category">{% csrf_token %}
    	<div class="fields hform">
            <div class="field-group">              
                <div class="fields-head">
                	<h3>Point Location</h3>
                </div>             
                <div class="field">
                    <input type="hidden" name="lat_lng" id="lat_lng" value=""/>
					<input type="hidden" name="zoom" id="zoom" value=""/>
					<div id="map" style="width: 520px; height: 180px; margin-bottom:20px; position: relative; background-color: rgb(229, 227, 223);"></div>
                </div> 
            </div>          
            <div id="meta-tags" class="field-group">
				<div class="fields-head">
                	<h3>ZipCodes</h3>
				</div>                    
                <div class="field text-field">	
                	<div class="label"><label>{% trans 'Zip/Postalcode' %}</label></div>	
                	<div class="value">
                		{{ form.zip }}
						<input type="hidden" value="{{zipcode.id}}" id="id_id" name="id"> 
					</div>	
                </div>
            </div>            
		</div>    
        <div class="modal-base form-submit group">
		   	<button role="button" class="cform-button {% if zipcode %}prime{% endif %} right" type="button" onclick="save_zipcode(0)"><span class="cform-button-text">{% if zipcode %}{% trans 'Update' %}{% else %}{% trans 'Done' %}{% endif %}</span></button>
			{% if not zipcode %}<button role="button" class="cform-button prime right" type="button" style="margin-right:10px !important;" onclick="save_zipcode(1)"><span class="cform-button-text">{% trans 'Save &#38; Add Another' %}</span></button>{% endif %}
		</div>           
    </form>
    <script type="text/javascript" src="{{STATIC_URL}}ui/js/inline.js"></script>
</div>
<script type="text/javascript">
{% if zipcode %}
	setTimeout(function() {
		load_for_add('map',{{zipcode.latitude }}, {{ zipcode.longitude }}, {{ zipcode.zoom }},"green","{{ zipcode.zip }}","{{ globalsettings.city }}");
	}, 500);
{% else %}
	setTimeout(function() {
		load_for_add('map',{{globalsettings.google_map_lat }}, {{ globalsettings.google_map_lon }}, {{ globalsettings.google_map_zoom }},"{{ globalsettings.city }}","select the location");
	}, 1200);
{% endif %}
</script>
