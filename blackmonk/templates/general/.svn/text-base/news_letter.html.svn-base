{% load i18n %}
<div id="newsletter" class="tellfriend" style="padding:0px;">
	<form id="subscribe_newsletter_form" method="post" action="javascript:send_newsletter()" >	
		<h4><span style="color:#069;font-weight:bold;font-size:14px">{% trans "Subscribe Newsletter" %}</span></h4>
		<h4 id="as_news_heading">{% trans "You will recieve a confirmation mail to subscribe." %}</h4>
		<label for="to_news_number">{% trans "Your Name:" %}</label>
		
		<p>
			<input style="width:200px;" type="text" maxlength="20" autocomplete="off" size="10" name="to_name" id="id_to_name" class="input_text">
			<small class="as_news_isNaN" style="display:block">(Eg:Smith)</small>
    	</p>
		
		<label for="to_number">{% trans "Email Address:" %}</label>
		<p>
			<input  style="width:200px;"  type="text" autocomplete="off" size="10" name="to_news_email" id="to_news_email" class="input_text">
			<small class="as_news_isemail" style="display:block">(Eg:yourname@domain.com)</small>
    	</p>
		<label for="to_number">{% trans "Email Format:" %}</label>
		<p>
			<ul class="group">
				<li style="float:left;margin-right:25px;"><span class="cform-radio-container"><input style="margin: 4px;vertical-align: bottom;" type="radio" value="html" name="EMAILTYPE" id="mce-EMAILTYPE-0" CHECKED><span class="cform-radio-element"></span></span><label for="mce-EMAILTYPE-0">{% trans "HTML" %}</label></li>
				<li style="float:left;margin-right:25px;"><span class="cform-radio-container"><input style="margin: 4px;vertical-align: bottom;" type="radio" value="text" name="EMAILTYPE" id="mce-EMAILTYPE-1"><span class="cform-radio-element"></span></span><label for="mce-EMAILTYPE-1">{% trans "TEXT" %}</label></li>
				<li style="float:left;"><span class="cform-radio-container"><input style="margin: 4px;vertical-align: bottom;" type="radio" value="mobile" name="EMAILTYPE" id="mce-EMAILTYPE-2"><span class="cform-radio-element"></span></span><label for="mce-EMAILTYPE-2">{% trans "MOBILE" %}</label></li>
			</ul>
    	</p>
		
		<div class="form_footer">
			<button type="submit" class="button super green small click_pvnt as_news_submit" onclick="send_newsletter();return false;"><span>{% trans "Subscribe" %}</span></button>
			<p id="news_letter_status"></p>
		</div>
	</form>
</div>
<script type="text/javascript">
	
function send_newsletter(){
	var success = true; 
	success = validate_news_letter_email();		
	if(success){
		var dataString='email='+encodeURIComponent($('#to_news_email').val());
		dataString+='&mailtype='+$('input[name=EMAILTYPE]:checked').val()
		if($('#id_to_name').val()!=''){
			dataString+='&name='+encodeURIComponent($('#id_to_name').val());
		}
		$('.as_news_submit').hide();
		$('#news_letter_status').removeAttr('class').addClass('msg_sending').text(gettext('Saving , please wait...')).show();
		$.ajax({
			type: "POST",
			url: "{% url 'ajax_newsletter_url' %}",
			data: dataString,
			success: function(data){
							if(data=='1'){
								$('#news_letter_status').removeAttr('class').addClass('flash_success_alert').text(gettext('Please check your mail to confirm Subscription.'));
								setTimeout("news_letter_restore()",5000);
							}
							else if(data=='2'){
								$('#news_letter_status').removeAttr('class').addClass('flash_error_alert').text(gettext('You have already been subscribed.'));
								setTimeout("$('#news_letter_status').hide();$('.as_news_submit').show();",5000);
								}
							else{
								$('#news_letter_status').removeAttr('class').addClass('flash_error_alert').text('Unable to save your details.Please try again later.');
								setTimeout("$('#news_letter_status').hide();$('.as_news_submit').show();",5000);
								}
						}
				});
			}
	}	
	
function news_letter_restore(){
	$('#news_letter_status').removeAttr('class').text('');
	$('#as_news_letter_li').removeClass('onPp');
	$('#newsletter_signup').hide(300);
	$('.as_news_submit').show();
}

function validate_news_letter_email(){
	var email = $("#to_news_email").val();
	var email_match = /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/
	if(!email_match.test(email)) {
		$('input#to_news_email').css('border-color', 'red');
		$('.as_news_isemail').html('(Invalid email address)').css('color', 'red');
		$("#to_news_email").focus();
		return false;
	}
	else {
		$('input#to_news_email').css('border-color', '');
		$('.as_news_isemail').html('(Eg:yourname@domain.com)').css('color', '');
		return true;
	}
}
</script>